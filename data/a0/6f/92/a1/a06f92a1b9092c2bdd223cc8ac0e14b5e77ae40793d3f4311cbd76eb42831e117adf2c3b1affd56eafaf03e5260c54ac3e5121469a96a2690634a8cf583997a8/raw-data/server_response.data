<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
<link rel="icon" href="/favicon.png">
<title>#732394 - libvirt-bin: CVE-2013-6456: virsh shutdown does not handle symlinks correctly for LXC - Debian Bug report logs</title>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="/css/bugs.css" type="text/css">

<link rel="canonical" href="&lt;a href=&quot;bugreport.cgi?bug=732394&quot;&gt;732394&lt;/a&gt;">
<script type="text/javascript">
<!--
function toggle_infmessages()
{
        allDivs=document.getElementsByTagName("div");
        for (var i = 0 ; i < allDivs.length ; i++ )
        {
                if (allDivs[i].className == "infmessage")
                {
                        allDivs[i].style.display=(allDivs[i].style.display == 'none' | allDivs[i].style.display == '') ? 'block' : 'none';
                }
        }
}
-->
</script>
</head>
<body>
<h1>Debian Bug report logs - 
<a href="mailto:732394@bugs.debian.org">#732394</a><br>
libvirt-bin: CVE-2013-6456: virsh shutdown does not handle symlinks correctly for LXC</h1>
<div class="versiongraph"><a href="version.cgi?found=libvirt%2F1.0.1~rc1-1;found=libvirt%2F1.1.4-2~bpo70%2B1;fixed=libvirt%2F1.2.3-1;collapse=1;package=libvirt-bin;info=1;absolute=0"><img alt="version graph" src="version.cgi?collapse=1;absolute=0;package=libvirt-bin;found=libvirt%2F1.0.1~rc1-1;found=libvirt%2F1.1.4-2~bpo70%2B1;height=2;width=2;fixed=libvirt%2F1.2.3-1"></a></div>
<div class="pkginfo">
  <p>Package:
     <a class="submitter" href="pkgreport.cgi?package=libvirt-bin">libvirt-bin</a>;
Maintainer for <a href="pkgreport.cgi?package=libvirt-bin">libvirt-bin</a> is <a href="pkgreport.cgi?maint=pkg-libvirt-maintainers%40lists.alioth.debian.org">Debian Libvirt Maintainers &lt;pkg-libvirt-maintainers@lists.alioth.debian.org&gt;</a>; Source for <a href="pkgreport.cgi?package=libvirt-bin">libvirt-bin</a> is <a href="pkgreport.cgi?src=libvirt">src:libvirt</a> (<a href="https://tracker.debian.org/pkg/libvirt">PTS</a>, <a href="https://buildd.debian.org/libvirt">buildd</a>, <a href="https://qa.debian.org/popcon.php?package=libvirt">popcon</a>). </p>

</div>

<div class="buginfo">
  <p>Reported by: <a href="pkgreport.cgi?submitter=recoverym4n%40gmail.com">Reco &lt;recoverym4n@gmail.com&gt;</a></p>
  <p>Date: Tue, 17 Dec 2013 15:42:11 UTC</p>

<p>Severity: important</p>
<p>Tags: security</p>

<p>Found in versions libvirt/1.0.1~rc1-1, libvirt/1.1.4-2~bpo70+1</p>
<p>Fixed in version libvirt/1.2.3-1</p>

<p><strong>Done:</strong> Guido Günther &lt;agx@sigxcpu.org&gt;</p>

<p>Bug is archived. No further changes may be made.<p></div>

<p><a href="javascript:toggle_infmessages();">Toggle useless messages</a></p><div class="msgreceived"><p>View this report as an <a href="bugreport.cgi?bug=732394;mbox=yes">mbox folder</a>, <a href="bugreport.cgi?bug=732394;mbox=yes;mboxstatus=yes">status mbox</a>, <a href="bugreport.cgi?bug=732394;mbox=yes;mboxmaint=yes">maintainer mbox</a></p></div>

<div class="infmessage"><hr><p>
<a name="1"></a>
<!-- request_addr: debian-bugs-dist@lists.debian.org, Debian Libvirt Maintainers &lt;pkg-libvirt-maintainers@lists.alioth.debian.org&gt; -->
<!-- time:1387294935 -->
<strong>Report forwarded</strong>
to <code>debian-bugs-dist@lists.debian.org, Debian Libvirt Maintainers &lt;pkg-libvirt-maintainers@lists.alioth.debian.org&gt;</code>:<br>
<code>Bug#732394</code>; Package <code>libvirt-bin</code>.
 (Tue, 17 Dec 2013 15:42:15 GMT) (<a href="bugreport.cgi?bug=732394;msg=2">full text</a>, <a href="bugreport.cgi?bug=732394;mbox=yes;msg=2">mbox</a>, <a href="#1">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="3"></a>
<!-- request_addr: Reco &lt;recoverym4n@gmail.com&gt; -->
<!-- time:1387294935 -->
<strong>Acknowledgement sent</strong>
to <code>Reco &lt;recoverym4n@gmail.com&gt;</code>:<br>
New Bug report received and forwarded.  Copy sent to <code>Debian Libvirt Maintainers &lt;pkg-libvirt-maintainers@lists.alioth.debian.org&gt;</code>.
 (Tue, 17 Dec 2013 15:42:15 GMT) (<a href="bugreport.cgi?bug=732394;msg=4">full text</a>, <a href="bugreport.cgi?bug=732394;mbox=yes;msg=4">mbox</a>, <a href="#3">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="5"></a><a name="msg5"></a><a href="#5">Message #5</a> received at submit@bugs.debian.org (<a href="bugreport.cgi?bug=732394;msg=5">full text</a>, <a href="bugreport.cgi?bug=732394;mbox=yes;msg=5">mbox</a>, <a href="mailto:732394@bugs.debian.org?References=%3C20131217194130.fa856ae27b0774202a40a525%40gmail.com%3E&amp;subject=Re%3A%20libvirt-bin%3A%20virsh%20shutdown%20does%20not%20handle%20symlinks%20correctly%20for%0A%20LXC&amp;body=On%20Tue%2C%2017%20Dec%202013%2019%3A41%3A30%20%2B0400%20Reco%20%3Crecoverym4n%40gmail.com%3E%20wrote%3A%0A%3E%20%0A%3E%20Package%3A%20libvirt-bin%0A%3E%20Version%3A%201.1.4-2~bpo70%2B1%0A%3E%20Severity%3A%20important%0A%3E%20%0A%3E%20Dear%20Maintainer%2C%0A%3E%20%0A%3E%20As%20of%20versions%201.1.4%20%28current%20backported%20one%29%20and%201.2.0%20%28current%0A%3E%20experimental%20one%29%20libvirt%27s%20implementation%20for%20LXC%20containers%20lacks%0A%3E%20basic%20sanity%20checks%20in%20container%20shutdown%20implementation.%0A%3E%20%0A%3E%20One%20can%20trace%20the%20problem%20to%20virInitctlSetRunLevel%20function%20at%0A%3E%20src%2Futil%2Fvirinitctl.c%20file.%0A%3E%20%0A%3E%20Once%20user%20invokes%20%27virsh%20-c%20lxc%3A%2F%2F%20shutdown%27%2C%20libvirtd%20constructs%20a%0A%3E%20pathname%20to%20%27%2Fdev%2Finitctl%27%20inside%20the%20container%2C%20such%20as%3A%0A%3E%20%0A%3E%20%2Fproc%2F%3Ccontainer_init_pid%3E%2Froot%2F%2Fdev%2Finitctl%0A%3E%20%0A%3E%20opens%20it%20without%20any%20additional%20checking%20and%20writes%20runlevel%20change%0A%3E%20request%20to%20the%20init.%20It%20does%20not%20check%20whenever%20constructed%20pathname%20is%0A%3E%20an%20actual%20pipe%2C%20which%20is%20bad.%20It%20does%20not%20check%20who%20exactly%20is%20on%20the%0A%3E%20other%20side%20of%20this%20pipe%2C%20which%20is%20much%20worse.%0A%3E%20%0A%3E%20Apparently%20this%20code%20was%20tested%20against%20systemd%2C%20which%0A%3E%20creates%20%2Fdev%2Finitctl%20pipe%20and%20listens%20on%20it.%0A%3E%20%0A%3E%20But%2C%20both%20upstart%20and%20sysvinit%20do%20not%20create%20such%20pipe%20%28current%20wheezy%27s%0A%3E%20init%20is%20using%20%2Frun%2Finitctl%29%2C%20which%20leads%20to%20this%20problem.%0A%3E%20%0A%3E%20%0A%3E%20To%20reproduce%20the%20problem%2C%20one%20will%20need%3A%0A%3E%20%0A%3E%201%29%20One%20Debian%20GNU%2FLinux%20installation%2C%20configured%20to%20run%20LXC%20%28cgroups%20and%0A%3E%20stuff%29%2C%20using%20sysvinit%20or%20upstart%20as%20PID%201.%0A%3E%20%0A%3E%202%29%20One%20Debian%20GNU%2FLinux%20container%2C%20running%20sysvinit%20or%20upstart.%0A%3E%20%0A%3E%203%29%20Boot%20the%20container.%0A%3E%20%0A%3E%204%29%20Invoke%20inside%20the%20container%3A%0A%3E%20%0A%3E%20ln%20-s%20%2Frun%2Finitctl%20%2Fdev%2Finitctl%0A%3E%20%0A%3E%205%29%20Invoke%20from%20outside%20the%20container%3A%0A%3E%20%0A%3E%20virsh%20-c%20lxc%3A%2F%2F%20shutdown%20%3Ccontainer%3E%0A%3E%20%0A%3E%206%29%20Observe%20the%20host%20shutting%20down.%0A%3E%20%0A%3E%20--%20System%20Information%3A%0A%3E%20Debian%20Release%3A%207.3%0A%3E%20%20%20APT%20prefers%20stable-updates%0A%3E%20%20%20APT%20policy%3A%20%28500%2C%20%27stable-updates%27%29%2C%20%28500%2C%20%27stable%27%29%0A%3E%20Architecture%3A%20amd64%20%28x86_64%29%0A%3E%20%0A%3E%20Kernel%3A%20Linux%203.11-0.bpo.2-amd64%20%28SMP%20w%2F8%20CPU%20cores%29%0A%3E%20Locale%3A%20LANG%3Den_US.UTF-8%2C%20LC_CTYPE%3Den_US.UTF-8%20%28charmap%3DUTF-8%29%0A%3E%20Shell%3A%20%2Fbin%2Fsh%20linked%20to%20%2Fbin%2Fdash%0A%3E%20%0A&amp;In-Reply-To=%3C20131217194130.fa856ae27b0774202a40a525%40gmail.com%3E">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=recoverym4n%40gmail.com" alt="">
<div class="header"><span class="headerfield">From:</span> Reco &lt;recoverym4n@gmail.com&gt;</div>
<div class="header"><span class="headerfield">To:</span> Debian Bug Tracking System &lt;submit@bugs.debian.org&gt;</div>
<div class="header"><span class="headerfield">Subject:</span> libvirt-bin: virsh shutdown does not handle symlinks correctly for
 LXC</div>
<div class="header"><span class="headerfield">Date:</span> Tue, 17 Dec 2013 19:41:30 +0400</div>
</div>
<pre class="message">
Package: libvirt-bin
Version: 1.1.4-2~bpo70+1
Severity: important

Dear Maintainer,

As of versions 1.1.4 (current backported one) and 1.2.0 (current
experimental one) libvirt&#39;s implementation for LXC containers lacks
basic sanity checks in container shutdown implementation.

One can trace the problem to virInitctlSetRunLevel function at
src/util/virinitctl.c file.

Once user invokes &#39;virsh -c lxc:// shutdown&#39;, libvirtd constructs a
pathname to &#39;/dev/initctl&#39; inside the container, such as:

/proc/&lt;container_init_pid&gt;/root//dev/initctl

opens it without any additional checking and writes runlevel change
request to the init. It does not check whenever constructed pathname is
an actual pipe, which is bad. It does not check who exactly is on the
other side of this pipe, which is much worse.

Apparently this code was tested against systemd, which
creates /dev/initctl pipe and listens on it.

But, both upstart and sysvinit do not create such pipe (current wheezy&#39;s
init is using /run/initctl), which leads to this problem.


To reproduce the problem, one will need:

1) One Debian GNU/Linux installation, configured to run LXC (cgroups and
stuff), using sysvinit or upstart as PID 1.

2) One Debian GNU/Linux container, running sysvinit or upstart.

3) Boot the container.

4) Invoke inside the container:

ln -s /run/initctl /dev/initctl

5) Invoke from outside the container:

virsh -c lxc:// shutdown &lt;container&gt;

6) Observe the host shutting down.

-- System Information:
Debian Release: 7.3
  APT prefers stable-updates
  APT policy: (500, &#39;stable-updates&#39;), (500, &#39;stable&#39;)
Architecture: amd64 (x86_64)

Kernel: Linux 3.11-0.bpo.2-amd64 (SMP w/8 CPU cores)
Locale: LANG=en_US.UTF-8, LC_CTYPE=en_US.UTF-8 (charmap=UTF-8)
Shell: /bin/sh linked to /bin/dash

Versions of packages libvirt-bin depends on:
ii  adduser              3.113+nmu3
ii  gettext-base         0.18.1.1-9
ii  init-system-helpers  1.11~bpo70.1
ii  libaudit0            1:1.7.18-1.1
ii  libavahi-client3     0.6.31-2
ii  libavahi-common3     0.6.31-2
ii  libblkid1            2.20.1-5.3
ii  libc6                2.13-38
ii  libcap-ng0           0.6.6-2
ii  libdbus-1-3          1.6.8-1+deb7u1
ii  libdevmapper1.02.1   2:1.02.74-8
ii  libfuse2             2.9.0-2+deb7u1
ii  libgcrypt11          1.5.0-5+deb7u1
ii  libgnutls26          2.12.20-7
ii  libnetcf1            0.1.9-2
ii  libnl1               1.1-7
ii  libnuma1             2.0.8~rc4-1
ii  libparted0debian1    2.3-12
ii  libpcap0.8           1.3.0-1
ii  libpciaccess0        0.13.1-2
ii  libreadline6         6.2+dfsg-0.1
ii  libsasl2-2           2.1.25.dfsg1-6+deb7u1
ii  libssh2-1            1.4.2-1.1
ii  libudev0             175-7.2
ii  libvirt0             1.1.4-2~bpo70+1
ii  libxenstore3.0       4.1.4-3+deb7u1
ii  libxml2              2.8.0+dfsg1-7+nmu2
ii  libyajl2             2.0.4-2
ii  logrotate            3.8.1-4

Versions of packages libvirt-bin recommends:
ii  bridge-utils     1.5-6
ii  dmidecode        2.11-9
ii  dnsmasq-base     2.62-3+deb7u1
pn  ebtables         &lt;none&gt;
ii  iproute          20120521-3+b3
ii  iptables         1.4.14-3.1
ii  libxml2-utils    2.8.0+dfsg1-7+nmu2
ii  netcat-openbsd   1.105-7
ii  parted           2.3-12
ii  pm-utils         1.4.1-9
pn  qemu-kvm | qemu  &lt;none&gt;

Versions of packages libvirt-bin suggests:
pn  auditd       &lt;none&gt;
pn  policykit-1  &lt;none&gt;
pn  radvd        &lt;none&gt;
pn  systemtap    &lt;none&gt;

-- Configuration Files:
&lt;omitted&gt;

-- no debconf information


</pre>

<div class="infmessage"><hr><p>
<a name="6"></a>
<!-- request_addr: debian-bugs-dist@lists.debian.org, Debian Libvirt Maintainers &lt;pkg-libvirt-maintainers@lists.alioth.debian.org&gt; -->
<!-- time:1387312207 -->
<strong>Information forwarded</strong>
to <code>debian-bugs-dist@lists.debian.org, Debian Libvirt Maintainers &lt;pkg-libvirt-maintainers@lists.alioth.debian.org&gt;</code>:<br>
<code>Bug#732394</code>; Package <code>libvirt-bin</code>.
 (Tue, 17 Dec 2013 20:30:07 GMT) (<a href="bugreport.cgi?bug=732394;msg=7">full text</a>, <a href="bugreport.cgi?bug=732394;mbox=yes;msg=7">mbox</a>, <a href="#6">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="8"></a>
<!-- request_addr: Guido Günther &lt;gg@godiug.net&gt; -->
<!-- time:1387312208 -->
<strong>Acknowledgement sent</strong>
to <code>Guido Günther &lt;gg@godiug.net&gt;</code>:<br>
Extra info received and forwarded to list.  Copy sent to <code>Debian Libvirt Maintainers &lt;pkg-libvirt-maintainers@lists.alioth.debian.org&gt;</code>.
 (Tue, 17 Dec 2013 20:30:08 GMT) (<a href="bugreport.cgi?bug=732394;msg=9">full text</a>, <a href="bugreport.cgi?bug=732394;mbox=yes;msg=9">mbox</a>, <a href="#8">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="10"></a><a name="msg10"></a><a href="#10">Message #10</a> received at 732394@bugs.debian.org (<a href="bugreport.cgi?bug=732394;msg=10">full text</a>, <a href="bugreport.cgi?bug=732394;mbox=yes;msg=10">mbox</a>, <a href="mailto:732394@bugs.debian.org?References=%3C20131217194130.fa856ae27b0774202a40a525%40gmail.com%3E%0A%20%3C20131217202736.GD11955%40bogon.sigxcpu.org%3E&amp;subject=Re%3A%20%5BPkg-libvirt-maintainers%5D%20Bug%23732394%3A%20libvirt-bin%3A%20virsh%0A%20shutdown%20does%20not%20handle%20symlinks%20correctly%20for%20LXC&amp;In-Reply-To=%3C20131217202736.GD11955%40bogon.sigxcpu.org%3E&amp;body=On%20Tue%2C%2017%20Dec%202013%2021%3A27%3A36%20%2B0100%20Guido%20%3D%3Fiso-8859-1%3FQ%3FG%3DFCnther%3F%3D%20%3Cgg%40godiug.net%3E%20wrote%3A%0A%3E%20Hi%20Reco%2C%0A%3E%20On%20Tue%2C%20Dec%2017%2C%202013%20at%2007%3A41%3A30PM%20%2B0400%2C%20Reco%20wrote%3A%0A%3E%20%5B..snip..%5D%20%0A%3E%20%3E%20Apparently%20this%20code%20was%20tested%20against%20systemd%2C%20which%0A%3E%20%3E%20creates%20%2Fdev%2Finitctl%20pipe%20and%20listens%20on%20it.%0A%3E%20I%20won%27t%20get%20around%20to%20check%20myself%20anytime%20soonish%20so%20reporting%20this%0A%3E%20upstream%20to%20%20libvir-list%40redhat.com%20would%20be%20much%20appreciated.%0A%3E%20Cheers%2C%0A%3E%20%20--%20Guido%0A%3E%20%0A%3E%20%0A">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=gg%40godiug.net" alt="">
<div class="header"><span class="headerfield">From:</span> Guido Günther &lt;gg@godiug.net&gt;</div>
<div class="header"><span class="headerfield">To:</span> Reco &lt;recoverym4n@gmail.com&gt;, 732394@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Re: [Pkg-libvirt-maintainers] Bug#732394: libvirt-bin: virsh
 shutdown does not handle symlinks correctly for LXC</div>
<div class="header"><span class="headerfield">Date:</span> Tue, 17 Dec 2013 21:27:36 +0100</div>
</div>
<pre class="message">Hi Reco,
On Tue, Dec 17, 2013 at 07:41:30PM +0400, Reco wrote:
[..snip..] 
&gt; Apparently this code was tested against systemd, which
&gt; creates /dev/initctl pipe and listens on it.
I won&#39;t get around to check myself anytime soonish so reporting this
upstream to  libvir-list@redhat.com would be much appreciated.
Cheers,
 -- Guido


</pre>

<div class="infmessage"><hr><p>
<a name="11"></a>
<!-- request_addr: debian-bugs-dist@lists.debian.org, Debian Libvirt Maintainers &lt;pkg-libvirt-maintainers@lists.alioth.debian.org&gt; -->
<!-- time:1387377364 -->
<strong>Information forwarded</strong>
to <code>debian-bugs-dist@lists.debian.org, Debian Libvirt Maintainers &lt;pkg-libvirt-maintainers@lists.alioth.debian.org&gt;</code>:<br>
<code>Bug#732394</code>; Package <code>libvirt-bin</code>.
 (Wed, 18 Dec 2013 14:36:04 GMT) (<a href="bugreport.cgi?bug=732394;msg=12">full text</a>, <a href="bugreport.cgi?bug=732394;mbox=yes;msg=12">mbox</a>, <a href="#11">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="13"></a>
<!-- request_addr: Reco &lt;recoverym4n@gmail.com&gt; -->
<!-- time:1387377364 -->
<strong>Acknowledgement sent</strong>
to <code>Reco &lt;recoverym4n@gmail.com&gt;</code>:<br>
Extra info received and forwarded to list.  Copy sent to <code>Debian Libvirt Maintainers &lt;pkg-libvirt-maintainers@lists.alioth.debian.org&gt;</code>.
 (Wed, 18 Dec 2013 14:36:04 GMT) (<a href="bugreport.cgi?bug=732394;msg=14">full text</a>, <a href="bugreport.cgi?bug=732394;mbox=yes;msg=14">mbox</a>, <a href="#13">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="15"></a><a name="msg15"></a><a href="#15">Message #15</a> received at 732394@bugs.debian.org (<a href="bugreport.cgi?bug=732394;msg=15">full text</a>, <a href="bugreport.cgi?bug=732394;mbox=yes;msg=15">mbox</a>, <a href="mailto:732394@bugs.debian.org?body=On%20Wed%2C%2018%20Dec%202013%2018%3A33%3A21%20%2B0400%20Reco%20%3Crecoverym4n%40gmail.com%3E%20wrote%3A%0A%3E%20%20Hello%2C%20list.%0A%3E%20%0A%3E%20I%20was%20pointed%20here%20by%20maintainer%20of%20libvirt%20package%20in%20Debian%2C%20Guido%0A%3E%20G%C3%BCnther.%20For%20the%20sake%20of%20completeness%2C%20the%20original%20bug%20report%20can%20be%0A%3E%20viewed%20at%20this%20link%3A%0A%3E%20%0A%3E%20http%3A%2F%2Fbugs.debian.org%2Fcgi-bin%2Fbugreport.cgi%3Fbug%3D732394%0A%3E%20%0A%3E%20To%20sum%20up%20the%20bug%20report%2C%20current%20implementation%20of%0A%3E%20virInitctlSetRunLevel%20function%20%28src%2Futil%2Fvirinitctl.c%29%20lacks%20any%20sanity%0A%3E%20checks%20before%20writing%20to%20container%27s%20%2Fdev%2Finitctl.%20In%20the%20absence%20of%0A%3E%20such%20checks%2C%20libvirtd%20can%20be%20easily%20tricked%20to%20write%20runlevel%20check%0A%3E%20request%20to%20an%20arbitrary%20main%20hosts%27%20file%20%28including%0A%3E%20hosts%27%20%2Frun%2Finitctl%2C%20as%20described%20in%20the%20bug%20report%29.%20All%20it%20takes%20is%0A%3E%20one%20symlink%20in%20place%20of%20containers%27%20%2Fdev%2Finitctl.%0A%3E%20%0A%3E%20I%27ve%20checked%20current%20libvirtd%27s%20git%2C%20and%20it%20seems%20to%20me%20that%20the%0A%3E%20problem%20is%20still%20here.%0A%3E%20%0A%3E%20Attached%20to%20this%20letter%20is%20a%20patch%20which%20tries%20to%20mitigate%20the%20issue%20by%0A%3E%20checking%20whenever%20container%27s%20%2Fdev%2Finitctl%20is%20a%20pipe%20actually.%0A%3E%20%0A%3E%20Sincerely%20yours%2C%20Reco%0A%3E%20%0A%3E%20PS%20I%27m%20not%20subscribed%20to%20this%20list%2C%20in%20case%20of%20further%20questions%20please%0A%3E%20CC%20me.%0A&amp;In-Reply-To=%3C20131218183321.e2b2fd0b11d4e905e7cc6abc%40gmail.com%3E&amp;References=%3C20131218183321.e2b2fd0b11d4e905e7cc6abc%40gmail.com%3E&amp;subject=Re%3A%20Implementation%20deficiency%20in%20virInitctlSetRunLevel">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=recoverym4n%40gmail.com" alt="">
<div class="header"><span class="headerfield">From:</span> Reco &lt;recoverym4n@gmail.com&gt;</div>
<div class="header"><span class="headerfield">To:</span> libvir-list@redhat.com</div>
<div class="header"><span class="headerfield">Cc:</span> 732394@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Implementation deficiency in virInitctlSetRunLevel</div>
<div class="header"><span class="headerfield">Date:</span> Wed, 18 Dec 2013 18:33:21 +0400</div>
</div>
<pre class="mime">[<a href="bugreport.cgi?att=0;bug=732394;msg=15">Message part 1</a> (text/plain, inline)]</pre>
<pre class="message"> Hello, list.

I was pointed here by maintainer of libvirt package in Debian, Guido
Günther. For the sake of completeness, the original bug report can be
viewed at this link:

<a href="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=732394">http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=732394</a>

To sum up the bug report, current implementation of
virInitctlSetRunLevel function (src/util/virinitctl.c) lacks any sanity
checks before writing to container&#39;s /dev/initctl. In the absence of
such checks, libvirtd can be easily tricked to write runlevel check
request to an arbitrary main hosts&#39; file (including
hosts&#39; /run/initctl, as described in the bug report). All it takes is
one symlink in place of containers&#39; /dev/initctl.

I&#39;ve checked current libvirtd&#39;s git, and it seems to me that the
problem is still here.

Attached to this letter is a patch which tries to mitigate the issue by
checking whenever container&#39;s /dev/initctl is a pipe actually.

Sincerely yours, Reco

PS I&#39;m not subscribed to this list, in case of further questions please
CC me.
</pre>
<pre class="mime">[<a href="bugreport.cgi?att=1;bug=732394;filename=Don-t-write-to-non-pipes.patch;msg=15">Don-t-write-to-non-pipes.patch</a> (text/x-diff, attachment)]</pre>

<div class="infmessage"><hr><p>
<a name="16"></a>
<!-- request_addr: debian-bugs-dist@lists.debian.org, Debian Libvirt Maintainers &lt;pkg-libvirt-maintainers@lists.alioth.debian.org&gt; -->
<!-- time:1387387087 -->
<strong>Information forwarded</strong>
to <code>debian-bugs-dist@lists.debian.org, Debian Libvirt Maintainers &lt;pkg-libvirt-maintainers@lists.alioth.debian.org&gt;</code>:<br>
<code>Bug#732394</code>; Package <code>libvirt-bin</code>.
 (Wed, 18 Dec 2013 17:18:07 GMT) (<a href="bugreport.cgi?bug=732394;msg=17">full text</a>, <a href="bugreport.cgi?bug=732394;mbox=yes;msg=17">mbox</a>, <a href="#16">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="18"></a>
<!-- request_addr: Michal Privoznik &lt;mprivozn@redhat.com&gt; -->
<!-- time:1387387087 -->
<strong>Acknowledgement sent</strong>
to <code>Michal Privoznik &lt;mprivozn@redhat.com&gt;</code>:<br>
Extra info received and forwarded to list.  Copy sent to <code>Debian Libvirt Maintainers &lt;pkg-libvirt-maintainers@lists.alioth.debian.org&gt;</code>.
 (Wed, 18 Dec 2013 17:18:07 GMT) (<a href="bugreport.cgi?bug=732394;msg=19">full text</a>, <a href="bugreport.cgi?bug=732394;mbox=yes;msg=19">mbox</a>, <a href="#18">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="20"></a><a name="msg20"></a><a href="#20">Message #20</a> received at 732394@bugs.debian.org (<a href="bugreport.cgi?bug=732394;msg=20">full text</a>, <a href="bugreport.cgi?bug=732394;mbox=yes;msg=20">mbox</a>, <a href="mailto:732394@bugs.debian.org?subject=Re%3A%20%5Blibvirt%5D%20Implementation%20deficiency%20in%20virInitctlSetRunLevel&amp;References=%3C20131218183321.e2b2fd0b11d4e905e7cc6abc%40gmail.com%3E%0A%20%3C52B1D825.2050809%40redhat.com%3E&amp;body=On%20Wed%2C%2018%20Dec%202013%2018%3A15%3A17%20%2B0100%20Michal%20Privoznik%20%3Cmprivozn%40redhat.com%3E%20wrote%3A%0A%3E%20On%2018.12.2013%2015%3A33%2C%20Reco%20wrote%3A%0A%3E%20%3E%20%20Hello%2C%20list.%0A%3E%20%3E%20%0A%3E%20%3E%20I%20was%20pointed%20here%20by%20maintainer%20of%20libvirt%20package%20in%20Debian%2C%20Guido%0A%3E%20%3E%20G%C3%BCnther.%20For%20the%20sake%20of%20completeness%2C%20the%20original%20bug%20report%20can%20be%0A%3E%20%3E%20viewed%20at%20this%20link%3A%0A%3E%20%3E%20%0A%3E%20%3E%20http%3A%2F%2Fbugs.debian.org%2Fcgi-bin%2Fbugreport.cgi%3Fbug%3D732394%0A%3E%20%3E%20%0A%3E%20%3E%20To%20sum%20up%20the%20bug%20report%2C%20current%20implementation%20of%0A%3E%20%3E%20virInitctlSetRunLevel%20function%20%28src%2Futil%2Fvirinitctl.c%29%20lacks%20any%20sanity%0A%3E%20%3E%20checks%20before%20writing%20to%20container%27s%20%2Fdev%2Finitctl.%20In%20the%20absence%20of%0A%3E%20%3E%20such%20checks%2C%20libvirtd%20can%20be%20easily%20tricked%20to%20write%20runlevel%20check%0A%3E%20%3E%20request%20to%20an%20arbitrary%20main%20hosts%27%20file%20%28including%0A%3E%20%3E%20hosts%27%20%2Frun%2Finitctl%2C%20as%20described%20in%20the%20bug%20report%29.%20All%20it%20takes%20is%0A%3E%20%3E%20one%20symlink%20in%20place%20of%20containers%27%20%2Fdev%2Finitctl.%0A%3E%20%3E%20%0A%3E%20%3E%20I%27ve%20checked%20current%20libvirtd%27s%20git%2C%20and%20it%20seems%20to%20me%20that%20the%0A%3E%20%3E%20problem%20is%20still%20here.%0A%3E%20%3E%20%0A%3E%20%3E%20Attached%20to%20this%20letter%20is%20a%20patch%20which%20tries%20to%20mitigate%20the%20issue%20by%0A%3E%20%3E%20checking%20whenever%20container%27s%20%2Fdev%2Finitctl%20is%20a%20pipe%20actually.%0A%3E%20%3E%20%0A%3E%20%3E%20Sincerely%20yours%2C%20Reco%0A%3E%20%3E%20%0A%3E%20%3E%20PS%20I%27m%20not%20subscribed%20to%20this%20list%2C%20in%20case%20of%20further%20questions%20please%0A%3E%20%3E%20CC%20me.%0A%3E%20%3E%20%0A%3E%20%3E%20%0A%3E%20%3E%20%0A%3E%20%3E%20--%0A%3E%20%3E%20libvir-list%20mailing%20list%0A%3E%20%3E%20libvir-list%40redhat.com%0A%3E%20%3E%20https%3A%2F%2Fwww.redhat.com%2Fmailman%2Flistinfo%2Flibvir-list%0A%3E%20%3E%20%0A%3E%20%0A%3E%20%5BPasting%20the%20patch%20here%5D%0A%3E%20%0A%3E%20%3E%20---%20a%2Fsrc%2Futil%2Fvirinitctl.c%202013-12-18%2011%3A13%3A10.078432196%20%2B0400%0A%3E%20%3E%20%2B%2B%2B%20b%2Fsrc%2Futil%2Fvirinitctl.c%202013-12-18%2011%3A26%3A50.000000000%20%2B0400%0A%3E%20%3E%20%40%40%20-24%2C7%20%2B24%2C10%20%40%40%0A%3E%20%3E%20%20%23include%20%3Cconfig.h%3E%0A%3E%20%3E%20%0A%3E%20%3E%20%20%23include%20%3Csys%2Fparam.h%3E%0A%3E%20%3E%20%2B%23include%20%3Csys%2Ftypes.h%3E%0A%3E%20%3E%20%2B%23include%20%3Csys%2Fstat.h%3E%0A%3E%20%3E%20%20%23include%20%3Cfcntl.h%3E%0A%3E%20%3E%20%2B%23include%20%3Cunistd.h%3E%0A%3E%20%3E%20%0A%3E%20%3E%20%20%23include%20%22internal.h%22%0A%3E%20%3E%20%20%23include%20%22virinitctl.h%22%0A%3E%20%3E%20%40%40%20-122%2C6%20%2B125%2C7%20%40%40%0A%3E%20%3E%20%20%20%20%20%20int%20fd%20%3D%20-1%3B%0A%3E%20%3E%20%20%20%20%20%20char%20%2Apath%20%3D%20NULL%3B%0A%3E%20%3E%20%20%20%20%20%20int%20ret%20%3D%20-1%3B%0A%3E%20%3E%20%2B%20%20%20%20struct%20stat%20attrs%3B%0A%3E%20%3E%20%0A%3E%20%3E%20%20%20%20%20%20memset%28%26req%2C%200%2C%20sizeof%28req%29%29%3B%0A%3E%20%3E%20%0A%3E%20%3E%20%40%40%20-139%2C7%20%2B143%2C10%20%40%40%0A&amp;In-Reply-To=%3C52B1D825.2050809%40redhat.com%3E">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=mprivozn%40redhat.com" alt="">
<div class="header"><span class="headerfield">From:</span> Michal Privoznik &lt;mprivozn@redhat.com&gt;</div>
<div class="header"><span class="headerfield">To:</span> Reco &lt;recoverym4n@gmail.com&gt;, libvir-list@redhat.com</div>
<div class="header"><span class="headerfield">Cc:</span> 732394@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Re: [libvirt] Implementation deficiency in virInitctlSetRunLevel</div>
<div class="header"><span class="headerfield">Date:</span> Wed, 18 Dec 2013 18:15:17 +0100</div>
</div>
<pre class="message">On 18.12.2013 15:33, Reco wrote:
&gt;  Hello, list.
&gt; 
&gt; I was pointed here by maintainer of libvirt package in Debian, Guido
&gt; Günther. For the sake of completeness, the original bug report can be
&gt; viewed at this link:
&gt; 
&gt; <a href="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=732394">http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=732394</a>
&gt; 
&gt; To sum up the bug report, current implementation of
&gt; virInitctlSetRunLevel function (src/util/virinitctl.c) lacks any sanity
&gt; checks before writing to container&#39;s /dev/initctl. In the absence of
&gt; such checks, libvirtd can be easily tricked to write runlevel check
&gt; request to an arbitrary main hosts&#39; file (including
&gt; hosts&#39; /run/initctl, as described in the bug report). All it takes is
&gt; one symlink in place of containers&#39; /dev/initctl.
&gt; 
&gt; I&#39;ve checked current libvirtd&#39;s git, and it seems to me that the
&gt; problem is still here.
&gt; 
&gt; Attached to this letter is a patch which tries to mitigate the issue by
&gt; checking whenever container&#39;s /dev/initctl is a pipe actually.
&gt; 
&gt; Sincerely yours, Reco
&gt; 
&gt; PS I&#39;m not subscribed to this list, in case of further questions please
&gt; CC me.
&gt; 
&gt; 
&gt; 
&gt; --
&gt; libvir-list mailing list
&gt; libvir-list@redhat.com
&gt; <a href="https://www.redhat.com/mailman/listinfo/libvir-list">https://www.redhat.com/mailman/listinfo/libvir-list</a>
&gt; 

[Pasting the patch here]

&gt; --- a/src/util/virinitctl.c 2013-12-18 11:13:10.078432196 +0400
&gt; +++ b/src/util/virinitctl.c 2013-12-18 11:26:50.000000000 +0400
&gt; @@ -24,7 +24,10 @@
&gt;  #include &lt;config.h&gt;
&gt; 
&gt;  #include &lt;sys/param.h&gt;
&gt; +#include &lt;sys/types.h&gt;
&gt; +#include &lt;sys/stat.h&gt;
&gt;  #include &lt;fcntl.h&gt;
&gt; +#include &lt;unistd.h&gt;
&gt; 
&gt;  #include &quot;internal.h&quot;
&gt;  #include &quot;virinitctl.h&quot;
&gt; @@ -122,6 +125,7 @@
&gt;      int fd = -1;
&gt;      char *path = NULL;
&gt;      int ret = -1;
&gt; +    struct stat attrs;
&gt; 
&gt;      memset(&amp;req, 0, sizeof(req));
&gt; 
&gt; @@ -139,7 +143,10 @@
&gt;              return -1;
&gt;      }
&gt; 
&gt; -    if ((fd = open(path, O_WRONLY|O_NONBLOCK|O_CLOEXEC|O_NOCTTY)) &lt; 0) {
&gt; +    if (lstat(path, &amp;attrs) == -1)
&gt; +        goto cleanup;

While the part above looks okay, I think we should report error if the /dev/initctl is not a pipe. Moreover, with your approach, if it&#39;s really not a pipe, we don&#39;t call open() and proceed to safewrite(-1, ...) at line 153 which will report EBADF error.

&gt; +
&gt; +    if ((attrs.st_mode &amp; S_IFIFO) &amp;&amp; (fd = open(path, O_WRONLY|O_NONBLOCK|O_CLOEXEC|O_NOCTTY)) &lt; 0) {
&gt;          if (errno == ENOENT) {
&gt;              ret = 0;
&gt;              goto cleanup

Missing &#39;;&#39; at EOL ^^^ - I guess you missed that during copy-paste.

Looking forward to v2.
BTW: consider using git when sending patches. I couldn&#39;t really apply this patch via &#39;git am&#39;.

<a href="http://libvirt.org/hacking.html#patches">http://libvirt.org/hacking.html#patches</a>

Michal


</pre>

<div class="infmessage"><hr><p>
<a name="21"></a>
<!-- request_addr: debian-bugs-dist@lists.debian.org, Debian Libvirt Maintainers &lt;pkg-libvirt-maintainers@lists.alioth.debian.org&gt; -->
<!-- time:1387387630 -->
<strong>Information forwarded</strong>
to <code>debian-bugs-dist@lists.debian.org, Debian Libvirt Maintainers &lt;pkg-libvirt-maintainers@lists.alioth.debian.org&gt;</code>:<br>
<code>Bug#732394</code>; Package <code>libvirt-bin</code>.
 (Wed, 18 Dec 2013 17:27:10 GMT) (<a href="bugreport.cgi?bug=732394;msg=22">full text</a>, <a href="bugreport.cgi?bug=732394;mbox=yes;msg=22">mbox</a>, <a href="#21">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="23"></a>
<!-- request_addr: &quot;Daniel P. Berrange&quot; &lt;berrange@redhat.com&gt; -->
<!-- time:1387387630 -->
<strong>Acknowledgement sent</strong>
to <code>&quot;Daniel P. Berrange&quot; &lt;berrange@redhat.com&gt;</code>:<br>
Extra info received and forwarded to list.  Copy sent to <code>Debian Libvirt Maintainers &lt;pkg-libvirt-maintainers@lists.alioth.debian.org&gt;</code>.
 (Wed, 18 Dec 2013 17:27:10 GMT) (<a href="bugreport.cgi?bug=732394;msg=24">full text</a>, <a href="bugreport.cgi?bug=732394;mbox=yes;msg=24">mbox</a>, <a href="#23">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="25"></a><a name="msg25"></a><a href="#25">Message #25</a> received at 732394@bugs.debian.org (<a href="bugreport.cgi?bug=732394;msg=25">full text</a>, <a href="bugreport.cgi?bug=732394;mbox=yes;msg=25">mbox</a>, <a href="mailto:732394@bugs.debian.org?In-Reply-To=%3C20131218172546.GP29247%40redhat.com%3E&amp;body=On%20Wed%2C%2018%20Dec%202013%2017%3A25%3A46%20%2B0000%20%22Daniel%20P.%20Berrange%22%20%3Cberrange%40redhat.com%3E%20wrote%3A%0A%3E%20On%20Wed%2C%20Dec%2018%2C%202013%20at%2006%3A33%3A21PM%20%2B0400%2C%20Reco%20wrote%3A%0A%3E%20%3E%20%20Hello%2C%20list.%0A%3E%20%3E%20%0A%3E%20%3E%20I%20was%20pointed%20here%20by%20maintainer%20of%20libvirt%20package%20in%20Debian%2C%20Guido%0A%3E%20%3E%20G%C3%BCnther.%20For%20the%20sake%20of%20completeness%2C%20the%20original%20bug%20report%20can%20be%0A%3E%20%3E%20viewed%20at%20this%20link%3A%0A%3E%20%3E%20%0A%3E%20%3E%20http%3A%2F%2Fbugs.debian.org%2Fcgi-bin%2Fbugreport.cgi%3Fbug%3D732394%0A%3E%20%3E%20%0A%3E%20%3E%20To%20sum%20up%20the%20bug%20report%2C%20current%20implementation%20of%0A%3E%20%3E%20virInitctlSetRunLevel%20function%20%28src%2Futil%2Fvirinitctl.c%29%20lacks%20any%20sanity%0A%3E%20%3E%20checks%20before%20writing%20to%20container%27s%20%2Fdev%2Finitctl.%20In%20the%20absence%20of%0A%3E%20%3E%20such%20checks%2C%20libvirtd%20can%20be%20easily%20tricked%20to%20write%20runlevel%20check%0A%3E%20%3E%20request%20to%20an%20arbitrary%20main%20hosts%27%20file%20%28including%0A%3E%20%3E%20hosts%27%20%2Frun%2Finitctl%2C%20as%20described%20in%20the%20bug%20report%29.%20All%20it%20takes%20is%0A%3E%20%3E%20one%20symlink%20in%20place%20of%20containers%27%20%2Fdev%2Finitctl.%0A%3E%20%3E%20%0A%3E%20%3E%20I%27ve%20checked%20current%20libvirtd%27s%20git%2C%20and%20it%20seems%20to%20me%20that%20the%0A%3E%20%3E%20problem%20is%20still%20here.%0A%3E%20%3E%20%0A%3E%20%3E%20Attached%20to%20this%20letter%20is%20a%20patch%20which%20tries%20to%20mitigate%20the%20issue%20by%0A%3E%20%3E%20checking%20whenever%20container%27s%20%2Fdev%2Finitctl%20is%20a%20pipe%20actually.%0A%3E%20%3E%20%0A%3E%20%3E%20Sincerely%20yours%2C%20Reco%0A%3E%20%3E%20%0A%3E%20%3E%20PS%20I%27m%20not%20subscribed%20to%20this%20list%2C%20in%20case%20of%20further%20questions%20please%0A%3E%20%3E%20CC%20me.%0A%3E%20%0A%3E%20%3E%20---%20a%2Fsrc%2Futil%2Fvirinitctl.c%202013-12-18%2011%3A13%3A10.078432196%20%2B0400%0A%3E%20%3E%20%2B%2B%2B%20b%2Fsrc%2Futil%2Fvirinitctl.c%202013-12-18%2011%3A26%3A50.000000000%20%2B0400%0A%3E%20%3E%20%40%40%20-24%2C7%20%2B24%2C10%20%40%40%0A%3E%20%3E%20%20%23include%20%3Cconfig.h%3E%0A%3E%20%3E%20%0A%3E%20%3E%20%20%23include%20%3Csys%2Fparam.h%3E%0A%3E%20%3E%20%2B%23include%20%3Csys%2Ftypes.h%3E%0A%3E%20%3E%20%2B%23include%20%3Csys%2Fstat.h%3E%0A%3E%20%3E%20%20%23include%20%3Cfcntl.h%3E%0A%3E%20%3E%20%2B%23include%20%3Cunistd.h%3E%0A%3E%20%3E%20%0A%3E%20%3E%20%20%23include%20%22internal.h%22%0A%3E%20%3E%20%20%23include%20%22virinitctl.h%22%0A%3E%20%3E%20%40%40%20-122%2C6%20%2B125%2C7%20%40%40%0A%3E%20%3E%20%20%20%20%20%20int%20fd%20%3D%20-1%3B%0A%3E%20%3E%20%20%20%20%20%20char%20%2Apath%20%3D%20NULL%3B%0A%3E%20%3E%20%20%20%20%20%20int%20ret%20%3D%20-1%3B%0A%3E%20%3E%20%2B%20%20%20%20struct%20stat%20attrs%3B%0A%3E%20%3E%20%0A%3E%20%3E%20%20%20%20%20%20memset%28%26req%2C%200%2C%20sizeof%28req%29%29%3B%0A%3E%20%3E%20%0A%3E%20%3E%20%40%40%20-139%2C7%20%2B143%2C10%20%40%40%0A%3E%20%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20-1%3B%0A%3E%20%3E%20%20%20%20%20%20%7D%0A%3E%20%3E%20%0A%3E%20%3E%20-%20%20%20%20if%20%28%28fd%20%3D%20open%28path%2C%20O_WRONLY%7CO_NONBLOCK%7CO_CLOEXEC%7CO_NOCTTY%29%29%20%3C%200%29%20%7B%0A%3E%20%3E%20%2B%20%20%20%20if%20%28lstat%28path%2C%20%26attrs%29%20%3D%3D%20-1%29%0A%3E%20%3E%20%2B%20%20%20%20%20%20%20%20goto%20cleanup%3B%0A%3E%20%3E%20%2B%0A%3E%20%3E%20%2B%20%20%20%20if%20%28%28attrs.st_mode%20%26%20S_IFIFO%29%20%26%26%20%28fd%20%3D%20open%28path%2C%20O_WRONLY%7CO_NONBLOCK%7CO_CLOEXEC%7CO_NOCTTY%29%29%20%3C%200%29%20%7B%0A%3E%20%3E%20%20%20%20%20%20%20%20%20%20if%20%28errno%20%3D%3D%20ENOENT%29%20%7B%0A%3E%20%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20ret%20%3D%200%3B%0A&amp;subject=Re%3A%20%5Blibvirt%5D%20Implementation%20deficiency%20in%20virInitctlSetRunLevel&amp;References=%3C20131218183321.e2b2fd0b11d4e905e7cc6abc%40gmail.com%3E%0A%20%3C20131218172546.GP29247%40redhat.com%3E">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=berrange%40redhat.com" alt="">
<div class="header"><span class="headerfield">From:</span> &quot;Daniel P. Berrange&quot; &lt;berrange@redhat.com&gt;</div>
<div class="header"><span class="headerfield">To:</span> Reco &lt;recoverym4n@gmail.com&gt;</div>
<div class="header"><span class="headerfield">Cc:</span> libvir-list@redhat.com, 732394@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Re: [libvirt] Implementation deficiency in virInitctlSetRunLevel</div>
<div class="header"><span class="headerfield">Date:</span> Wed, 18 Dec 2013 17:25:46 +0000</div>
</div>
<pre class="message">On Wed, Dec 18, 2013 at 06:33:21PM +0400, Reco wrote:
&gt;  Hello, list.
&gt; 
&gt; I was pointed here by maintainer of libvirt package in Debian, Guido
&gt; Günther. For the sake of completeness, the original bug report can be
&gt; viewed at this link:
&gt; 
&gt; <a href="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=732394">http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=732394</a>
&gt; 
&gt; To sum up the bug report, current implementation of
&gt; virInitctlSetRunLevel function (src/util/virinitctl.c) lacks any sanity
&gt; checks before writing to container&#39;s /dev/initctl. In the absence of
&gt; such checks, libvirtd can be easily tricked to write runlevel check
&gt; request to an arbitrary main hosts&#39; file (including
&gt; hosts&#39; /run/initctl, as described in the bug report). All it takes is
&gt; one symlink in place of containers&#39; /dev/initctl.
&gt; 
&gt; I&#39;ve checked current libvirtd&#39;s git, and it seems to me that the
&gt; problem is still here.
&gt; 
&gt; Attached to this letter is a patch which tries to mitigate the issue by
&gt; checking whenever container&#39;s /dev/initctl is a pipe actually.
&gt; 
&gt; Sincerely yours, Reco
&gt; 
&gt; PS I&#39;m not subscribed to this list, in case of further questions please
&gt; CC me.

&gt; --- a/src/util/virinitctl.c 2013-12-18 11:13:10.078432196 +0400
&gt; +++ b/src/util/virinitctl.c 2013-12-18 11:26:50.000000000 +0400
&gt; @@ -24,7 +24,10 @@
&gt;  #include &lt;config.h&gt;
&gt; 
&gt;  #include &lt;sys/param.h&gt;
&gt; +#include &lt;sys/types.h&gt;
&gt; +#include &lt;sys/stat.h&gt;
&gt;  #include &lt;fcntl.h&gt;
&gt; +#include &lt;unistd.h&gt;
&gt; 
&gt;  #include &quot;internal.h&quot;
&gt;  #include &quot;virinitctl.h&quot;
&gt; @@ -122,6 +125,7 @@
&gt;      int fd = -1;
&gt;      char *path = NULL;
&gt;      int ret = -1;
&gt; +    struct stat attrs;
&gt; 
&gt;      memset(&amp;req, 0, sizeof(req));
&gt; 
&gt; @@ -139,7 +143,10 @@
&gt;              return -1;
&gt;      }
&gt; 
&gt; -    if ((fd = open(path, O_WRONLY|O_NONBLOCK|O_CLOEXEC|O_NOCTTY)) &lt; 0) {
&gt; +    if (lstat(path, &amp;attrs) == -1)
&gt; +        goto cleanup;
&gt; +
&gt; +    if ((attrs.st_mode &amp; S_IFIFO) &amp;&amp; (fd = open(path, O_WRONLY|O_NONBLOCK|O_CLOEXEC|O_NOCTTY)) &lt; 0) {
&gt;          if (errno == ENOENT) {
&gt;              ret = 0;
&gt;              goto cleanup

Hmm, using lstat sets up a race condition though. I would suggest we
use O_NOFOLLOW with open() but that only works for the final component
of the path - so if /dev is a symlink in the guest it&#39;ll still cause
problems.

There are also a few other places where we use /proc/$PID/root/dev for
hotplug where we mknod. If the guest setup a bad /dev symlink it could
cause us problems. 

I think we may actually have to instead rely on forking a child which
does setns(/proc/$PID/ns/mnt) to make the changes safely in the container
namespace.

Regards,
Daniel
-- 
|: <a href="http://berrange.com">http://berrange.com</a>      -o-    <a href="http://www.flickr.com/photos/dberrange/">http://www.flickr.com/photos/dberrange/</a> :|
|: <a href="http://libvirt.org">http://libvirt.org</a>              -o-             <a href="http://virt-manager.org">http://virt-manager.org</a> :|
|: <a href="http://autobuild.org">http://autobuild.org</a>       -o-         <a href="http://search.cpan.org/~danberr/">http://search.cpan.org/~danberr/</a> :|
|: <a href="http://entangle-photo.org">http://entangle-photo.org</a>       -o-       <a href="http://live.gnome.org/gtk-vnc">http://live.gnome.org/gtk-vnc</a> :|


</pre>

<div class="msgreceived"><hr><p>
<a name="26"></a>
<!-- command:tag -->
<!-- requester: Salvatore Bonaccorso &lt;carnil@debian.org&gt; -->
<!-- request_addr: control@bugs.debian.org -->
<!-- time:1388210044 -->
<!-- new_data:
$new_data = {
              &#39;keywords&#39; =&gt; &#39;security&#39;
            };
-->
<!-- old_data:
$old_data = {
              &#39;keywords&#39; =&gt; &#39;&#39;
            };
-->
<strong>Added tag(s) security.</strong>
Request was from <code>Salvatore Bonaccorso &lt;carnil@debian.org&gt;</code>
to <code>control@bugs.debian.org</code>.
 (Sat, 28 Dec 2013 05:54:04 GMT) (<a href="bugreport.cgi?bug=732394;msg=27">full text</a>, <a href="bugreport.cgi?bug=732394;mbox=yes;msg=27">mbox</a>, <a href="#26">link</a>).</p></p></div>

<div class="msgreceived"><hr><p>
<a name="28"></a>
<!-- command:title -->
<!-- requester: Salvatore Bonaccorso &lt;carnil@debian.org&gt; -->
<!-- request_addr: control@bugs.debian.org -->
<!-- time:1388726474 -->
<!-- new_data:
$new_data = {
              &#39;subject&#39; =&gt; &#39;libvirt-bin: CVE-2013-6456: virsh shutdown does not handle symlinks correctly for LXC&#39;
            };
-->
<!-- old_data:
$old_data = {
              &#39;subject&#39; =&gt; &#39;libvirt-bin: virsh shutdown does not handle symlinks correctly for LXC&#39;
            };
-->
<strong>Changed Bug title to &#39;libvirt-bin: CVE-2013-6456: virsh shutdown does not handle symlinks correctly for LXC&#39; from &#39;libvirt-bin: virsh shutdown does not handle symlinks correctly for LXC&#39;</strong>
Request was from <code>Salvatore Bonaccorso &lt;carnil@debian.org&gt;</code>
to <code>control@bugs.debian.org</code>.
 (Fri, 03 Jan 2014 05:21:14 GMT) (<a href="bugreport.cgi?bug=732394;msg=29">full text</a>, <a href="bugreport.cgi?bug=732394;mbox=yes;msg=29">mbox</a>, <a href="#28">link</a>).</p></p></div>

<div class="msgreceived"><hr><p>
<a name="30"></a>
<!-- command:found -->
<!-- requester: Salvatore Bonaccorso &lt;carnil@debian.org&gt; -->
<!-- request_addr: control@bugs.debian.org -->
<!-- time:1388750948 -->
<!-- new_data:
$new_data = {
              &#39;found_versions&#39; =&gt; [
                                    &#39;libvirt/1.0.1~rc1-1&#39;,
                                    &#39;libvirt/1.1.4-2~bpo70+1&#39;
                                  ]
            };
-->
<!-- old_data:
$old_data = {
              &#39;found_versions&#39; =&gt; [
                                    &#39;libvirt/1.1.4-2~bpo70+1&#39;
                                  ]
            };
-->
<strong>Marked as found in versions libvirt/1.0.1~rc1-1.</strong>
Request was from <code>Salvatore Bonaccorso &lt;carnil@debian.org&gt;</code>
to <code>control@bugs.debian.org</code>.
 (Fri, 03 Jan 2014 12:09:08 GMT) (<a href="bugreport.cgi?bug=732394;msg=31">full text</a>, <a href="bugreport.cgi?bug=732394;mbox=yes;msg=31">mbox</a>, <a href="#30">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="32"></a>
<!-- request_addr: debian-bugs-dist@lists.debian.org, Debian Libvirt Maintainers &lt;pkg-libvirt-maintainers@lists.alioth.debian.org&gt; -->
<!-- time:1389256753 -->
<strong>Information forwarded</strong>
to <code>debian-bugs-dist@lists.debian.org, Debian Libvirt Maintainers &lt;pkg-libvirt-maintainers@lists.alioth.debian.org&gt;</code>:<br>
<code>Bug#732394</code>; Package <code>libvirt-bin</code>.
 (Thu, 09 Jan 2014 08:39:13 GMT) (<a href="bugreport.cgi?bug=732394;msg=33">full text</a>, <a href="bugreport.cgi?bug=732394;mbox=yes;msg=33">mbox</a>, <a href="#32">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="34"></a>
<!-- request_addr: Guido Günther &lt;agx@sigxcpu.org&gt; -->
<!-- time:1389256753 -->
<strong>Acknowledgement sent</strong>
to <code>Guido Günther &lt;agx@sigxcpu.org&gt;</code>:<br>
Extra info received and forwarded to list.  Copy sent to <code>Debian Libvirt Maintainers &lt;pkg-libvirt-maintainers@lists.alioth.debian.org&gt;</code>.
 (Thu, 09 Jan 2014 08:39:13 GMT) (<a href="bugreport.cgi?bug=732394;msg=35">full text</a>, <a href="bugreport.cgi?bug=732394;mbox=yes;msg=35">mbox</a>, <a href="#34">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="36"></a><a name="msg36"></a><a href="#36">Message #36</a> received at 732394@bugs.debian.org (<a href="bugreport.cgi?bug=732394;msg=36">full text</a>, <a href="bugreport.cgi?bug=732394;mbox=yes;msg=36">mbox</a>, <a href="mailto:732394@bugs.debian.org?References=%3C20140109082826.GA28255%40bogon.sigxcpu.org%3E&amp;subject=Re%3A%20Affected%20versions&amp;body=On%20Thu%2C%209%20Jan%202014%2009%3A28%3A26%20%2B0100%20Guido%20%3D%3Fiso-8859-1%3FQ%3FG%3DFCnther%3F%3D%20%3Cagx%40sigxcpu.org%3E%20wrote%3A%0A%3E%20Just%20for%20completeness%20%28the%20affected%20versions%20and%0A%3E%20https%3A%2F%2Fsecurity-tracker.debian.org%2Ftracker%2FCVE-2013-6456%20indicate%20this%0A%3E%20already%29%3A%0A%3E%20%0A%3E%20squeeze%20and%20wheezy%20are%20not%20affected.%0A%3E%20Cheers%2C%0A%3E%20%20--%20Guido%0A%3E%20%0A%3E%20%0A&amp;In-Reply-To=%3C20140109082826.GA28255%40bogon.sigxcpu.org%3E">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=agx%40sigxcpu.org" alt="">
<div class="header"><span class="headerfield">From:</span> Guido Günther &lt;agx@sigxcpu.org&gt;</div>
<div class="header"><span class="headerfield">To:</span> 732394@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Affected versions</div>
<div class="header"><span class="headerfield">Date:</span> Thu, 9 Jan 2014 09:28:26 +0100</div>
</div>
<pre class="message">Just for completeness (the affected versions and
<a href="https://security-tracker.debian.org/tracker/CVE-2013-6456">https://security-tracker.debian.org/tracker/CVE-2013-6456</a> indicate this
already):

squeeze and wheezy are not affected.
Cheers,
 -- Guido


</pre>

<div class="infmessage"><hr><p>
<a name="37"></a>
<!-- request_addr: debian-bugs-dist@lists.debian.org, Debian Libvirt Maintainers &lt;pkg-libvirt-maintainers@lists.alioth.debian.org&gt; -->
<!-- time:1392812104 -->
<strong>Information forwarded</strong>
to <code>debian-bugs-dist@lists.debian.org, Debian Libvirt Maintainers &lt;pkg-libvirt-maintainers@lists.alioth.debian.org&gt;</code>:<br>
<code>Bug#732394</code>; Package <code>libvirt-bin</code>.
 (Wed, 19 Feb 2014 12:15:04 GMT) (<a href="bugreport.cgi?bug=732394;msg=38">full text</a>, <a href="bugreport.cgi?bug=732394;mbox=yes;msg=38">mbox</a>, <a href="#37">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="39"></a>
<!-- request_addr: Reco &lt;recoverym4n@gmail.com&gt; -->
<!-- time:1392812104 -->
<strong>Acknowledgement sent</strong>
to <code>Reco &lt;recoverym4n@gmail.com&gt;</code>:<br>
Extra info received and forwarded to list.  Copy sent to <code>Debian Libvirt Maintainers &lt;pkg-libvirt-maintainers@lists.alioth.debian.org&gt;</code>.
 (Wed, 19 Feb 2014 12:15:04 GMT) (<a href="bugreport.cgi?bug=732394;msg=40">full text</a>, <a href="bugreport.cgi?bug=732394;mbox=yes;msg=40">mbox</a>, <a href="#39">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="41"></a><a name="msg41"></a><a href="#41">Message #41</a> received at 732394@bugs.debian.org (<a href="bugreport.cgi?bug=732394;msg=41">full text</a>, <a href="bugreport.cgi?bug=732394;mbox=yes;msg=41">mbox</a>, <a href="mailto:732394@bugs.debian.org?subject=Re%3A%20%5BPkg-libvirt-maintainers%5D%20Bug%23732394%3A%20libvirt-bin%3A%20virsh%0A%20shutdown%20does%20not%20handle%20symlinks%20correctly%20for%20LXC&amp;References=%3C20131217194130.fa856ae27b0774202a40a525%40gmail.com%3E%0A%20%3C20131217202736.GD11955%40bogon.sigxcpu.org%3E%0A%20%3C20140219121048.GA2658%40x101h%3E&amp;In-Reply-To=%3C20140219121048.GA2658%40x101h%3E&amp;body=On%20Wed%2C%2019%20Feb%202014%2016%3A10%3A59%20%2B0400%20Reco%20%3Crecoverym4n%40gmail.com%3E%20wrote%3A%0A%3E%20%20Hi.%0A%3E%20%0A%3E%20Today%20the%20problem%20was%20fixed%20in%20this%20upstream%20commit%3A%0A%3E%20%0A%3E%20http%3A%2F%2Flibvirt.org%2Fgit%2F%3Fp%3Dlibvirt.git%3Ba%3Dcommit%3Bh%3D5fc590ad9f4%0A%3E%20%0A%3E%20Please%20consider%20uploading%20fixed%20version%20of%20libvirt%20and%20friends.%0A%3E%20An%20upload%20to%20backports%20would%20be%20appreciated%20too.%0A%3E%20%0A%3E%20Reco%0A%3E%20%0A%3E%20%0A">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=recoverym4n%40gmail.com" alt="">
<div class="header"><span class="headerfield">From:</span> Reco &lt;recoverym4n@gmail.com&gt;</div>
<div class="header"><span class="headerfield">To:</span> Guido Günther &lt;gg@godiug.net&gt;</div>
<div class="header"><span class="headerfield">Cc:</span> 732394@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Re: [Pkg-libvirt-maintainers] Bug#732394: libvirt-bin: virsh
 shutdown does not handle symlinks correctly for LXC</div>
<div class="header"><span class="headerfield">Date:</span> Wed, 19 Feb 2014 16:10:59 +0400</div>
</div>
<pre class="message"> Hi.

Today the problem was fixed in this upstream commit:

<a href="http://libvirt.org/git/?p=libvirt.git;a=commit;h=5fc590ad9f4">http://libvirt.org/git/?p=libvirt.git;a=commit;h=5fc590ad9f4</a>

Please consider uploading fixed version of libvirt and friends.
An upload to backports would be appreciated too.

Reco


</pre>

<div class="infmessage"><hr><p>
<a name="42"></a>
<!-- request_addr: debian-bugs-dist@lists.debian.org, Debian Libvirt Maintainers &lt;pkg-libvirt-maintainers@lists.alioth.debian.org&gt; -->
<!-- time:1392812284 -->
<strong>Information forwarded</strong>
to <code>debian-bugs-dist@lists.debian.org, Debian Libvirt Maintainers &lt;pkg-libvirt-maintainers@lists.alioth.debian.org&gt;</code>:<br>
<code>Bug#732394</code>; Package <code>libvirt-bin</code>.
 (Wed, 19 Feb 2014 12:18:04 GMT) (<a href="bugreport.cgi?bug=732394;msg=43">full text</a>, <a href="bugreport.cgi?bug=732394;mbox=yes;msg=43">mbox</a>, <a href="#42">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="44"></a>
<!-- request_addr: &quot;Daniel P. Berrange&quot; &lt;berrange@redhat.com&gt; -->
<!-- time:1392812284 -->
<strong>Acknowledgement sent</strong>
to <code>&quot;Daniel P. Berrange&quot; &lt;berrange@redhat.com&gt;</code>:<br>
Extra info received and forwarded to list.  Copy sent to <code>Debian Libvirt Maintainers &lt;pkg-libvirt-maintainers@lists.alioth.debian.org&gt;</code>.
 (Wed, 19 Feb 2014 12:18:04 GMT) (<a href="bugreport.cgi?bug=732394;msg=45">full text</a>, <a href="bugreport.cgi?bug=732394;mbox=yes;msg=45">mbox</a>, <a href="#44">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="46"></a><a name="msg46"></a><a href="#46">Message #46</a> received at 732394@bugs.debian.org (<a href="bugreport.cgi?bug=732394;msg=46">full text</a>, <a href="bugreport.cgi?bug=732394;mbox=yes;msg=46">mbox</a>, <a href="mailto:732394@bugs.debian.org?subject=Re%3A%20%5Blibvirt%5D%20Implementation%20deficiency%20in%20virInitctlSetRunLevel&amp;References=%3C20131218183321.e2b2fd0b11d4e905e7cc6abc%40gmail.com%3E%0A%20%3C20140219121409.GA30296%40redhat.com%3E&amp;body=On%20Wed%2C%2019%20Feb%202014%2012%3A14%3A09%20%2B0000%20%22Daniel%20P.%20Berrange%22%20%3Cberrange%40redhat.com%3E%20wrote%3A%0A%3E%20The%20fix%20for%20this%20issue%20is%20now%20available%20in%20libvirt%20repositories.%20See%0A%3E%20this%20security%20notice%20for%20further%20information%20on%20the%20changesets%20that%0A%3E%20need%20to%20be%20backported%0A%3E%20%0A%3E%20%20%20http%3A%2F%2Fsecurity.libvirt.org%2F2013%2F0018.html%0A%3E%20%0A%3E%20Daniel%0A%3E%20--%20%0A%3E%20%7C%3A%20http%3A%2F%2Fberrange.com%20%20%20%20%20%20-o-%20%20%20%20http%3A%2F%2Fwww.flickr.com%2Fphotos%2Fdberrange%2F%20%3A%7C%0A%3E%20%7C%3A%20http%3A%2F%2Flibvirt.org%20%20%20%20%20%20%20%20%20%20%20%20%20%20-o-%20%20%20%20%20%20%20%20%20%20%20%20%20http%3A%2F%2Fvirt-manager.org%20%3A%7C%0A%3E%20%7C%3A%20http%3A%2F%2Fautobuild.org%20%20%20%20%20%20%20-o-%20%20%20%20%20%20%20%20%20http%3A%2F%2Fsearch.cpan.org%2F~danberr%2F%20%3A%7C%0A%3E%20%7C%3A%20http%3A%2F%2Fentangle-photo.org%20%20%20%20%20%20%20-o-%20%20%20%20%20%20%20http%3A%2F%2Flive.gnome.org%2Fgtk-vnc%20%3A%7C%0A%3E%20%0A%3E%20%0A&amp;In-Reply-To=%3C20140219121409.GA30296%40redhat.com%3E">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=berrange%40redhat.com" alt="">
<div class="header"><span class="headerfield">From:</span> &quot;Daniel P. Berrange&quot; &lt;berrange@redhat.com&gt;</div>
<div class="header"><span class="headerfield">To:</span> 732394@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Re: [libvirt] Implementation deficiency in virInitctlSetRunLevel</div>
<div class="header"><span class="headerfield">Date:</span> Wed, 19 Feb 2014 12:14:09 +0000</div>
</div>
<pre class="message">The fix for this issue is now available in libvirt repositories. See
this security notice for further information on the changesets that
need to be backported

  <a href="http://security.libvirt.org/2013/0018.html">http://security.libvirt.org/2013/0018.html</a>

Daniel
-- 
|: <a href="http://berrange.com">http://berrange.com</a>      -o-    <a href="http://www.flickr.com/photos/dberrange/">http://www.flickr.com/photos/dberrange/</a> :|
|: <a href="http://libvirt.org">http://libvirt.org</a>              -o-             <a href="http://virt-manager.org">http://virt-manager.org</a> :|
|: <a href="http://autobuild.org">http://autobuild.org</a>       -o-         <a href="http://search.cpan.org/~danberr/">http://search.cpan.org/~danberr/</a> :|
|: <a href="http://entangle-photo.org">http://entangle-photo.org</a>       -o-       <a href="http://live.gnome.org/gtk-vnc">http://live.gnome.org/gtk-vnc</a> :|


</pre>

<div class="msgreceived"><hr><p>
<a name="47"></a>
<!-- request_addr: Guido Günther &lt;agx@sigxcpu.org&gt; -->
<!-- time:1396872368 -->
<strong>Reply sent</strong>
to <code>Guido Günther &lt;agx@sigxcpu.org&gt;</code>:<br>
You have taken responsibility.
 (Mon, 07 Apr 2014 12:06:08 GMT) (<a href="bugreport.cgi?bug=732394;msg=48">full text</a>, <a href="bugreport.cgi?bug=732394;mbox=yes;msg=48">mbox</a>, <a href="#47">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="49"></a>
<!-- request_addr: Reco &lt;recoverym4n@gmail.com&gt; -->
<!-- time:1396872368 -->
<strong>Notification sent</strong>
to <code>Reco &lt;recoverym4n@gmail.com&gt;</code>:<br>
Bug acknowledged by developer.
 (Mon, 07 Apr 2014 12:06:08 GMT) (<a href="bugreport.cgi?bug=732394;msg=50">full text</a>, <a href="bugreport.cgi?bug=732394;mbox=yes;msg=50">mbox</a>, <a href="#49">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="51"></a><a name="msg51"></a><a href="#51">Message #51</a> received at 732394-close@bugs.debian.org (<a href="bugreport.cgi?bug=732394;msg=51">full text</a>, <a href="bugreport.cgi?bug=732394;mbox=yes;msg=51">mbox</a>, <a href="mailto:732394@bugs.debian.org?In-Reply-To=%3CE1WX8Hc-0008Fa-Ng%40franck.debian.org%3E&amp;body=On%20Mon%2C%2007%20Apr%202014%2012%3A04%3A12%20%2B0000%20%3D%3Futf-8%3Fq%3FGuido_G%3DC3%3DBCnther%3F%3D%20%3Cagx%40sigxcpu.org%3E%20wrote%3A%0A%3E%20Source%3A%20libvirt%0A%3E%20Source-Version%3A%201.2.3-1%0A%3E%20%0A%3E%20We%20believe%20that%20the%20bug%20you%20reported%20is%20fixed%20in%20the%20latest%20version%20of%0A%3E%20libvirt%2C%20which%20is%20due%20to%20be%20installed%20in%20the%20Debian%20FTP%20archive.%0A%3E%20%0A%3E%20A%20summary%20of%20the%20changes%20between%20this%20version%20and%20the%20previous%20one%20is%0A%3E%20attached.%0A%3E%20%0A%3E%20Thank%20you%20for%20reporting%20the%20bug%2C%20which%20will%20now%20be%20closed.%20%20If%20you%0A%3E%20have%20further%20comments%20please%20address%20them%20to%20732394%40bugs.debian.org%2C%0A%3E%20and%20the%20maintainer%20will%20reopen%20the%20bug%20report%20if%20appropriate.%0A%3E%20%0A%3E%20Debian%20distribution%20maintenance%20software%0A%3E%20pp.%0A%3E%20Guido%20G%C3%BCnther%20%3Cagx%40sigxcpu.org%3E%20%28supplier%20of%20updated%20libvirt%20package%29%0A%3E%20%0A%3E%20%28This%20message%20was%20generated%20automatically%20at%20their%20request%3B%20if%20you%0A%3E%20believe%20that%20there%20is%20a%20problem%20with%20it%20please%20contact%20the%20archive%0A%3E%20administrators%20by%20mailing%20ftpmaster%40ftp-master.debian.org%29%0A%3E%20%0A%3E%20%0A%3E%20-----BEGIN%20PGP%20SIGNED%20MESSAGE-----%0A%3E%20Hash%3A%20SHA1%0A%3E%20%0A%3E%20Format%3A%201.8%0A%3E%20Date%3A%20Mon%2C%2007%20Apr%202014%2012%3A15%3A02%20%2B0200%0A%3E%20Source%3A%20libvirt%0A%3E%20Binary%3A%20libvirt-bin%20libvirt0%20libvirt0-dbg%20libvirt-doc%20libvirt-dev%20libvirt-sanlock%0A%3E%20Architecture%3A%20source%20amd64%20all%0A%3E%20Version%3A%201.2.3-1%0A%3E%20Distribution%3A%20experimental%0A%3E%20Urgency%3A%20medium%0A%3E%20Maintainer%3A%20Debian%20Libvirt%20Maintainers%20%3Cpkg-libvirt-maintainers%40lists.alioth.debian.org%3E%0A%3E%20Changed-By%3A%20Guido%20G%C3%BCnther%20%3Cagx%40sigxcpu.org%3E%0A%3E%20Description%3A%20%0A%3E%20%20libvirt-bin%20-%20programs%20for%20the%20libvirt%20library%0A%3E%20%20libvirt-dev%20-%20development%20files%20for%20the%20libvirt%20library%0A%3E%20%20libvirt-doc%20-%20documentation%20for%20the%20libvirt%20library%0A%3E%20%20libvirt-sanlock%20-%20library%20for%20interfacing%20with%20different%20virtualization%20systems%0A%3E%20%20libvirt0%20%20%20-%20library%20for%20interfacing%20with%20different%20virtualization%20systems%0A%3E%20%20libvirt0-dbg%20-%20library%20for%20interfacing%20with%20different%20virtualization%20systems%0A%3E%20Closes%3A%20732394%20739082%20739096%20741276%0A%3E%20Changes%3A%20%0A%3E%20%20libvirt%20%281.2.3-1%29%20experimental%3B%20urgency%3Dmedium%0A%3E%20%20.%0A%3E%20%20%20%20%2A%20%5Baa5cd19%5D%20%2Fetc%2Finit.d%2Flibvirt-guests%3A%20source%20%2Flib%2Flsb%2Finit-function.%0A%3E%20%20%20%20%20%20This%20make%20sure%20we%20redirect%20calls%20to%20systemctl%20correctly%0A%3E%20%20%20%20%20%20Thanks%20to%20Laurent%20Bigonville%20%28Closes%3A%20%23739082%29%0A%3E%20%20%20%20%2A%20%5B9be0bf9%5D%20Remove%20old%20restart%20handling%20code%20from%20postinst.%0A%3E%20%20%20%20%20%20This%20brings%20the%20dh_installinit%20calls%20in%20line%20with%20the%20dh_systemd_start%0A%3E%20%20%20%20%20%20calls.%0A%3E%20%20%20%20%20%20Thanks%20to%20Laurent%20Bigonville%20%28Closes%3A%20%23739096%29%0A%3E%20%20%20%20%2A%20%5B9c408f9%5D%20New%20upstream%20version%201.2.2.%20Fixes%20CVE-2013-6456%0A%3E%20%20%20%20%20%20%28Closes%3A%20%23741276%2C%20%23732394%29%0A%3E%20%20%20%20%2A%20%5Be2f0077%5D%20Bump%20symbols%20versions%0A%3E%20%20%20%20%2A%20%5Bc7bf776%5D%20Update%20patches.%0A%3E%20%20%20%20%20%20Dropped%0A%3E%20%20%20%20%20%20%20%20xen-fix-parsing-xend-http-response.patch%20-%20applied%20upstream%0A%3E%20%20%20%20%2A%20%5Bcca8c1e%5D%20New%20upstream%20version%201.2.3%0A&amp;subject=Re%3A%20Bug%23732394%3A%20fixed%20in%20libvirt%201.2.3-1&amp;References=%3CE1WX8Hc-0008Fa-Ng%40franck.debian.org%3E">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=agx%40sigxcpu.org" alt="">
<div class="header"><span class="headerfield">From:</span> Guido Günther &lt;agx@sigxcpu.org&gt;</div>
<div class="header"><span class="headerfield">To:</span> 732394-close@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Bug#732394: fixed in libvirt 1.2.3-1</div>
<div class="header"><span class="headerfield">Date:</span> Mon, 07 Apr 2014 12:04:12 +0000</div>
</div>
<pre class="message">Source: libvirt
Source-Version: 1.2.3-1

We believe that the bug you reported is fixed in the latest version of
libvirt, which is due to be installed in the Debian FTP archive.

A summary of the changes between this version and the previous one is
attached.

Thank you for reporting the bug, which will now be closed.  If you
have further comments please address them to 732394@bugs.debian.org,
and the maintainer will reopen the bug report if appropriate.

Debian distribution maintenance software
pp.
Guido Günther &lt;agx@sigxcpu.org&gt; (supplier of updated libvirt package)

(This message was generated automatically at their request; if you
believe that there is a problem with it please contact the archive
administrators by mailing ftpmaster@ftp-master.debian.org)


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Format: 1.8
Date: Mon, 07 Apr 2014 12:15:02 +0200
Source: libvirt
Binary: libvirt-bin libvirt0 libvirt0-dbg libvirt-doc libvirt-dev libvirt-sanlock
Architecture: source amd64 all
Version: 1.2.3-1
Distribution: experimental
Urgency: medium
Maintainer: Debian Libvirt Maintainers &lt;pkg-libvirt-maintainers@lists.alioth.debian.org&gt;
Changed-By: Guido Günther &lt;agx@sigxcpu.org&gt;
Description: 
 libvirt-bin - programs for the libvirt library
 libvirt-dev - development files for the libvirt library
 libvirt-doc - documentation for the libvirt library
 libvirt-sanlock - library for interfacing with different virtualization systems
 libvirt0   - library for interfacing with different virtualization systems
 libvirt0-dbg - library for interfacing with different virtualization systems
Closes: <a href="bugreport.cgi?bug=732394">732394</a> <a href="bugreport.cgi?bug=739082">739082</a> <a href="bugreport.cgi?bug=739096">739096</a> <a href="bugreport.cgi?bug=741276">741276</a>
Changes: 
 libvirt (1.2.3-1) experimental; urgency=medium
 .
   * [aa5cd19] /etc/init.d/libvirt-guests: source /lib/lsb/init-function.
     This make sure we redirect calls to systemctl correctly
     Thanks to Laurent Bigonville (Closes: #<a href="bugreport.cgi?bug=739082">739082</a>)
   * [9be0bf9] Remove old restart handling code from postinst.
     This brings the dh_installinit calls in line with the dh_systemd_start
     calls.
     Thanks to Laurent Bigonville (Closes: #<a href="bugreport.cgi?bug=739096">739096</a>)
   * [9c408f9] New upstream version 1.2.2. Fixes <a href="https://security-tracker.debian.org/tracker/CVE-2013-6456">CVE-2013-6456</a>
     (Closes: #<a href="bugreport.cgi?bug=741276">741276</a>, #<a href="bugreport.cgi?bug=732394">732394</a>)
   * [e2f0077] Bump symbols versions
   * [c7bf776] Update patches.
     Dropped
       xen-fix-parsing-xend-http-response.patch - applied upstream
   * [cca8c1e] New upstream version 1.2.3
   * [11ad777] New patch Skip-vircgrouptest.patch.
     Skip vircgrouptest since the sys emulating code isn&#39;t complete and fails
     in our /sys free chroot.
   * [448ab8c] Build-depend on libsystemd-daemon-dev on linux
   * [66f2a93] Refresh patches
   * [3038786] Fix test failures
   * [bbed2fd] Depend on libattr1-dev for selinux tests
   * [659fc63] Bump symbol versions
   * [618b64f] Adjust systemd installation to upstream changes
   * [1850e36] Bump standards version
   * [e934847] libvirt-guests: avoid bashism
Checksums-Sha1: 
 d4e9ba070e7556bd63e8db575760b3f21da1adf8 2618 libvirt_1.2.3-1.dsc
 36763621a430674312fdd08a9c367517e9a2e82e 28605530 libvirt_1.2.3.orig.tar.gz
 128ce0cb4ffcc0d1abb73c4431439b23db823b33 39928 libvirt_1.2.3-1.debian.tar.xz
 dbf2d86052d5016a1f7b39c3713c8751530a1eb2 3912998 libvirt-bin_1.2.3-1_amd64.deb
 82ce42889d670d28f471e469bfc2cc312698b939 2690842 libvirt0_1.2.3-1_amd64.deb
 2e5e11fadf5b989b4c0e4a4a287f5d76f796da9b 8677602 libvirt0-dbg_1.2.3-1_amd64.deb
 8df28eefa7c8fa48d63c6cca19f3b866dc668a05 2903698 libvirt-doc_1.2.3-1_all.deb
 add7772c03c83c17c8177fec1e1c64bdbac06df5 1930636 libvirt-dev_1.2.3-1_amd64.deb
 46e4ce740f456797ebac5d923ce049bbf6131fd7 1862518 libvirt-sanlock_1.2.3-1_amd64.deb
Checksums-Sha256: 
 70ac0bffe12ecb7c53de97168b00a14473e731b2f80414c27266d08f6e3c024e 2618 libvirt_1.2.3-1.dsc
 b489d1a29c6166643d34b72795a89b03c6ac775cdaeadb6aa86fc1a982c02e31 28605530 libvirt_1.2.3.orig.tar.gz
 be3a2ea7264a6966095aa80cbf2eb1d065f0983bdffb200cca9f63a0aff0662e 39928 libvirt_1.2.3-1.debian.tar.xz
 d373b663fdff793ee858993e9625f141cc1fd0f452f61f5aa65ca60de6de5094 3912998 libvirt-bin_1.2.3-1_amd64.deb
 6d45c4f35a433e191a11733a4aed19d8f3cc5fa31f0c7e2f1442715598fbe0f0 2690842 libvirt0_1.2.3-1_amd64.deb
 718eaabf6dd2cbd2d1df8ccafefb98bd002d79ca4ddc6363fc561f3c44544fb2 8677602 libvirt0-dbg_1.2.3-1_amd64.deb
 d1aa9234102b2674e6cd7d699334f7238976c176ab908017b5e543fd1f6959ab 2903698 libvirt-doc_1.2.3-1_all.deb
 dd83dfa2c0aadb152fa0ad7d3e98025f66560abcd4a859781e78b1692c5fd2fc 1930636 libvirt-dev_1.2.3-1_amd64.deb
 2d8c395db277289239230bf7429ac053b54668dcf6a693356b93d9e2f273ece2 1862518 libvirt-sanlock_1.2.3-1_amd64.deb
Files: 
 ccc64cd9827d240308854614f2ba042e 2618 libs optional libvirt_1.2.3-1.dsc
 ad1602a2fcc3609c83b885a28f3eecbd 28605530 libs optional libvirt_1.2.3.orig.tar.gz
 4cd663441955f0603a518804f25b9319 39928 libs optional libvirt_1.2.3-1.debian.tar.xz
 f370c4f18fac71ef7d1e35753f9d10e6 3912998 admin optional libvirt-bin_1.2.3-1_amd64.deb
 d0fd98cd5e9b8ccaf7a3d20ac8c2c4a0 2690842 libs optional libvirt0_1.2.3-1_amd64.deb
 0bfee3ee259b561c4a2668ae597c9770 8677602 debug extra libvirt0-dbg_1.2.3-1_amd64.deb
 62ebf7a21ba2ba2ff427835204d33f09 2903698 doc optional libvirt-doc_1.2.3-1_all.deb
 66c7e525476be8d3c497747b917da1f0 1930636 libdevel optional libvirt-dev_1.2.3-1_amd64.deb
 68ece5437ad863d928a4d9ede0629218 1862518 libs extra libvirt-sanlock_1.2.3-1_amd64.deb

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iD8DBQFTQn7dn88szT8+ZCYRAhZeAJ40PJVtcicI0WXDQ9GadsM6BpHnaACffmg2
s5Yew3d20iIWBIDbAWVqMbY=
=4FO1
-----END PGP SIGNATURE-----



</pre>

<div class="msgreceived"><hr><p>
<a name="52"></a>
<!-- command:archive -->
<!-- requester: Debbugs Internal Request &lt;owner@bugs.debian.org&gt; -->
<!-- request_addr: internal_control@bugs.debian.org -->
<!-- time:1437983418 -->
<!-- new_data:
$new_data = {};
-->
<!-- old_data:
$old_data = {};
-->
<strong>Bug archived.</strong>
Request was from <code>Debbugs Internal Request &lt;owner@bugs.debian.org&gt;</code>
to <code>internal_control@bugs.debian.org</code>.
 (Mon, 27 Jul 2015 07:50:18 GMT) (<a href="bugreport.cgi?bug=732394;msg=53">full text</a>, <a href="bugreport.cgi?bug=732394;mbox=yes;msg=53">mbox</a>, <a href="#52">link</a>).</p></p></div>

<hr>
<p class="msgreceived">Send a report that <a href="https://bugs.debian.org/cgi-bin/bugspam.cgi?bug=732394">this bug log contains spam</a>.</p>
<hr>
<ADDRESS>Debian bug tracking system administrator &lt;<A HREF="mailto:owner@bugs.debian.org">owner@bugs.debian.org</A>&gt;.
Last modified:
<!--timestamp-->Sat Oct 30 18:28:18 2021<!--end timestamp-->; 
Machine Name:
<!--machinename-->buxtehude<!--machinename-->
<P>
<A HREF="https://www.debian.org/Bugs/">Debian Bug tracking system</A>
</p>
<p>
  Debbugs is free software and licensed under the terms of the GNU
  Public License version 2. The current version can be obtained
  from <a href="https://bugs.debian.org/debbugs-source/">https://bugs.debian.org/debbugs-source/</a>.
</p>
<p>
Copyright © 1999 Darren O. Benham,
1997,2003 nCipher Corporation Ltd,
1994-97 Ian Jackson,
2005-2017 Don Armstrong, and many other contributors.
</p>
</ADDRESS>

</body>
</html>
