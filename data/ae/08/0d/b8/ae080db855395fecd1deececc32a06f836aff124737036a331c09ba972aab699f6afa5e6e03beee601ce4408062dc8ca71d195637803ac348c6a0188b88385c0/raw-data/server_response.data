<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Arbitrary code execution from pip's "—extra-index-url" | cowlicks</title>
<link href="../assets/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="../assets/css/baguetteBox.min.css" rel="stylesheet" type="text/css">
<link href="../assets/css/rst_base.css" rel="stylesheet" type="text/css">
<link href="../assets/css/nikola_rst.css" rel="stylesheet" type="text/css">
<link href="../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../assets/css/theme.css" rel="stylesheet" type="text/css">
<link href="../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../rss.xml">
<link rel="canonical" href="https://cowlicks.website/posts/arbitrary-code-execution-from-pips-extra-index-url.html">
<!--[if lt IE 9]><script src="../assets/js/html5.js"></script><![endif]--><meta name="author" content="Blake Griffith">
<link rel="prev" href="a-sketch-of-trusted-wifi-open-authenticated-encrypted.html" title="A Sketch of Trusted WiFi - Open, Authenticated, Encrypted" type="text/html">
<meta property="og:site_name" content="cowlicks">
<meta property="og:title" content="Arbitrary code execution from pip's &quot;—extra-index-url&quot;">
<meta property="og:url" content="https://cowlicks.website/posts/arbitrary-code-execution-from-pips-extra-index-url.html">
<meta property="og:description" content="Once upon a time I made a python library, and gave it a very common name.
Let's say the name was &quot;foo&quot;.
I also created a package that depended on foo, lets call it &quot;bar&quot;.
Both packages were in in my o">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2020-05-08T05:28:56Z">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://cowlicks.website/">

                <span id="blog-title">cowlicks</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../archive.html">Archive</a>
                </li>
<li>
<a href="../categories/index.html">Tags</a>
                </li>
<li>
<a href="../rss.xml">RSS feed</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<li>
    <a href="arbitrary-code-execution-from-pips-extra-index-url.markdown" id="sourcelink">Source</a>
    </li>
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="#" class="u-url">Arbitrary code execution from pip's "—extra-index-url"</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    Blake Griffith
            </span></p>
            <p class="dateline">
            <a href="#" rel="bookmark">
            <time class="published dt-published" datetime="2020-05-08T05:28:56Z" itemprop="datePublished" title="2020-05-08 05:28">2020-05-08 05:28</time></a>
            </p>
                <p class="commentline">            <a href="arbitrary-code-execution-from-pips-extra-index-url.html#disqus_thread" data-disqus-identifier="cache/posts/arbitrary-code-execution-from-pips-extra-index-url.html">Comments</a>


                    </p>
<p class="sourceline"><a href="arbitrary-code-execution-from-pips-extra-index-url.markdown" class="sourcelink">Source</a></p>

        </div>
        
    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<p>Once upon a time I made a python library, and gave it a very common name.
Let's say the name was "<code>foo</code>".
I also created a package that depended on <code>foo</code>, lets call it "<code>bar</code>".
Both packages were in in my own private PyPI server, but something was wrong.
When I installed <code>bar</code> the wrong dependency was being installed for <code>foo</code>.
The package with the name <code>foo</code> from the public PyPI was being installed, not the one from my private PyPI.</p>
<p>I had inadvertently installed a package that could have run arbitrary code on my computer.</p>
<p>The problem occurs when <code>--extra-index-url</code> is used to point to a private PyPI that has packages with names shadowed on the public PyPI.
When then this happens pip is needs to choose which PyPI to take the package from.
It simply chooses the one with the higher version number.</p>
<p>This is a problem when: someone is using a private PyPI, with the <code>--extra-index-url</code>, and they are using a package on the private PyPI with a name they have not claimed on the public PyPI.</p>
<p>Going back to our original scenario, if an attacker controlled the name <code>foo</code> on the public PyPI, they could replace it with a malicious payload.
The attacker could get control of the public <code>foo</code> name if it wasn't taken, or even if it was taken but unused (see <a href="https://www.python.org/dev/peps/pep-0541/">PEP 541</a>).</p>
<p>I think <strong>many people</strong> who have private python packages are vulnerable to having their packages hijacked like this.</p>
<p>I went looking around the internet. Here is one vulnerable PyPI instance I found.</p>
<h2>CERN's vulnerable PyPI</h2>
<p>CERN hosts many of it's own python packages <a href="https://www.python.org/dev/peps/pep-0541/">here</a>.
Many of these packages names were not taken on the public PyPI, so I took them.
Note that they also <a href="https://twiki.cern.ch/twiki/bin/view/LHCb/PythonPyPIServer">provide instructions</a> to their users that they should use <code>--extra-index-url</code>.</p>
<p>I notified CERN that I had taken the names for their packages on the public PyPI and transferred ownership to them.</p>
<p>They offered to give me a tour if I was ever in Geneva :)</p>
<h2>Upstream disclosure</h2>
<p>I disclosed this to the <code>security@python.org</code> list.
Unfortunately they said there is currently no path to fix this.</p>
<p>They recommended using "version-pinning and hash-pinning for deployments" to avoid this.</p>
<p>They also discussed shadowing the names of your own private packages on the public PyPI.
This has problems because it reveals the names of packages you use, and forces you to effectively squat those names.</p>
<h2>CVE-2018-20225</h2>
<p>I reported this as a CVE. The link is <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-20225">here</a>.</p>
</div>
    </div>
    <aside class="postpromonav"><nav><ul class="pager hidden-print">
<li class="previous">
                <a href="a-sketch-of-trusted-wifi-open-authenticated-encrypted.html" rel="prev" title="A Sketch of Trusted WiFi - Open, Authenticated, Encrypted">Previous post</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><h2>Comments</h2>
                        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="cwlcks",
            disqus_url="https://cowlicks.website/posts/arbitrary-code-execution-from-pips-extra-index-url.html",
        disqus_title="Arbitrary code execution from pip's \"\u2014extra-index-url\"",
        disqus_identifier="cache/posts/arbitrary-code-execution-from-pips-extra-index-url.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        </section></article><script>var disqus_shortname="cwlcks";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2020         <a href="mailto:blake.a.griffith@gmail.com">Blake Griffith</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
            
        </footer>
</div>
</div>

            <script src="../assets/js/jquery.min.js"></script><script src="../assets/js/bootstrap.min.js"></script><script src="../assets/js/baguetteBox.min.js"></script><script src="../assets/js/moment-with-locales.min.js"></script><script src="../assets/js/fancydates.min.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script>
</body>
</html>
