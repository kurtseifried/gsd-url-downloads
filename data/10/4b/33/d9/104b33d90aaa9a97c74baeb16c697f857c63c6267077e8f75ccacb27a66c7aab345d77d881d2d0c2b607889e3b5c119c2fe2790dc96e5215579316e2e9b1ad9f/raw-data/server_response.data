<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
<link rel="icon" href="/favicon.png">
<title>#946829 - sa-exim: After upgrade SA: GREYLIST_ISWHITE skipped, insecure dependencies - Debian Bug report logs</title>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="/css/bugs.css" type="text/css">

<link rel="canonical" href="&lt;a href=&quot;bugreport.cgi?bug=946829&quot;&gt;946829&lt;/a&gt;">
<script type="text/javascript">
<!--
function toggle_infmessages()
{
        allDivs=document.getElementsByTagName("div");
        for (var i = 0 ; i < allDivs.length ; i++ )
        {
                if (allDivs[i].className == "infmessage")
                {
                        allDivs[i].style.display=(allDivs[i].style.display == 'none' | allDivs[i].style.display == '') ? 'block' : 'none';
                }
        }
}
-->
</script>
</head>
<body>
<h1>Debian Bug report logs - 
<a href="mailto:946829@bugs.debian.org">#946829</a><br>
sa-exim: After upgrade SA: GREYLIST_ISWHITE skipped, insecure dependencies</h1>
<div class="versiongraph"><a href="version.cgi?absolute=0;found=sa-exim%2F4.2.1-16;package=sa-exim;info=1;fixed=sa-exim%2F4.2.1-19;collapse=1"><img alt="version graph" src="version.cgi?fixed=sa-exim%2F4.2.1-19;absolute=0;package=sa-exim;height=2;width=2;collapse=1;found=sa-exim%2F4.2.1-16"></a></div>
<div class="pkginfo">
  <p>Package:
     <a class="submitter" href="pkgreport.cgi?package=sa-exim">sa-exim</a>;
Maintainer for <a href="pkgreport.cgi?package=sa-exim">sa-exim</a> is <a href="pkgreport.cgi?maint=holmgren%40debian.org">Magnus Holmgren &lt;holmgren@debian.org&gt;</a>; Source for <a href="pkgreport.cgi?package=sa-exim">sa-exim</a> is <a href="pkgreport.cgi?src=sa-exim">src:sa-exim</a> (<a href="https://tracker.debian.org/pkg/sa-exim">PTS</a>, <a href="https://buildd.debian.org/sa-exim">buildd</a>, <a href="https://qa.debian.org/popcon.php?package=sa-exim">popcon</a>). </p>
<p>Affects: <a class="submitter" href="pkgreport.cgi?package=security.debian.org">security.debian.org</a>, <a class="submitter" href="pkgreport.cgi?package=release.debian.org">release.debian.org</a></p>
</div>

<div class="buginfo">
  <p>Reported by: <a href="pkgreport.cgi?submitter=gaio%40sv.lnf.it">Marco Gaiarin &lt;gaio@sv.lnf.it&gt;</a></p>
  <p>Date: Mon, 16 Dec 2019 10:33:05 UTC</p>

<p>Severity: <em class="severity">serious</em></p>
<p>Tags: upstream</p>

<p>Found in version sa-exim/4.2.1-16</p>
<p>Fixed in version sa-exim/4.2.1-19</p>

<p><strong>Done:</strong> Debian FTP Masters &lt;ftpmaster@ftp-master.debian.org&gt;</p>

<p>Bug is archived. No further changes may be made.<p><p>Forwarded to <a href="https://sourceforge.net/p/sa-exim/bugs/3/">https://sourceforge.net/p/sa-exim/bugs/3/</a></p>
</div>

<p><a href="javascript:toggle_infmessages();">Toggle useless messages</a></p><div class="msgreceived"><p>View this report as an <a href="bugreport.cgi?bug=946829;mbox=yes">mbox folder</a>, <a href="bugreport.cgi?bug=946829;mbox=yes;mboxstatus=yes">status mbox</a>, <a href="bugreport.cgi?bug=946829;mbox=yes;mboxmaint=yes">maintainer mbox</a></p></div>

<div class="infmessage"><hr><p>
<a name="1"></a>
<!-- request_addr: debian-bugs-dist@lists.debian.org, Magnus Holmgren &lt;holmgren@debian.org&gt; -->
<!-- time:1576492388 -->
<strong>Report forwarded</strong>
to <code>debian-bugs-dist@lists.debian.org, Magnus Holmgren &lt;holmgren@debian.org&gt;</code>:<br>
<code>Bug#946829</code>; Package <code>sa-exim</code>.
 (Mon, 16 Dec 2019 10:33:08 GMT) (<a href="bugreport.cgi?bug=946829;msg=2">full text</a>, <a href="bugreport.cgi?bug=946829;mbox=yes;msg=2">mbox</a>, <a href="#1">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="3"></a>
<!-- request_addr: Marco Gaiarin &lt;gaio@sv.lnf.it&gt; -->
<!-- time:1576492388 -->
<strong>Acknowledgement sent</strong>
to <code>Marco Gaiarin &lt;gaio@sv.lnf.it&gt;</code>:<br>
New Bug report received and forwarded.  Copy sent to <code>Magnus Holmgren &lt;holmgren@debian.org&gt;</code>.
 (Mon, 16 Dec 2019 10:33:08 GMT) (<a href="bugreport.cgi?bug=946829;msg=4">full text</a>, <a href="bugreport.cgi?bug=946829;mbox=yes;msg=4">mbox</a>, <a href="#3">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="5"></a><a name="msg5"></a><a href="#5">Message #5</a> received at submit@bugs.debian.org (<a href="bugreport.cgi?bug=946829;msg=5">full text</a>, <a href="bugreport.cgi?bug=946829;mbox=yes;msg=5">mbox</a>, <a href="mailto:946829@bugs.debian.org?References=%3C157649173586.18858.2141265999720478989.reportbug%40vdmsv1.ad.fvg.lnf.it%3E&amp;body=On%20Mon%2C%2016%20Dec%202019%2011%3A22%3A15%20%2B0100%20Marco%20Gaiarin%20%3Cgaio%40sv.lnf.it%3E%20wrote%3A%0A%3E%20Package%3A%20sa-exim%0A%3E%20Version%3A%204.2.1-16%0A%3E%20Severity%3A%20normal%0A%3E%20%0A%3E%20Dear%20Maintainer%2C%0A%3E%20%0A%3E%20After%20upgrading%20SA%20%28security%20update%2C%203.4.2-1~deb9u2%29%20i%20got%20on%20logs%20a%20flood%20of%3A%0A%3E%20%0A%3E%20%20Dec%2016%2010%3A04%3A53%20vdmpp1%20spamd%5B15196%5D%3A%20rules%3A%20failed%20to%20run%20GREYLIST_ISWHITE%20test%2C%20skipping%3A%0A%3E%20%20Dec%2016%2010%3A04%3A53%20vdmpp1%20spamd%5B15196%5D%3A%20%20%28Insecure%20dependency%20in%20eval%20while%20running%20with%20-T%20switch%20at%20%2Fusr%2Fshare%2Fperl5%2FMail%2FSpamAssassin%2FPlugin%2FGreylisting.pm%20line%2076.%0A%3E%20%20Dec%2016%2010%3A04%3A53%20vdmpp1%20spamd%5B15196%5D%3A%20%29%0A%3E%20%0A%3E%20probably%2C%20the%20security%20changes%20added%20into%20the%20upgraded%20SA%20%27broke%27%20something%20on%20sa-exim.%0A%3E%20%0A%3E%20--%20System%20Information%3A%0A%3E%20Debian%20Release%3A%209.11%0A%3E%20%20%20APT%20prefers%20oldstable-updates%0A%3E%20%20%20APT%20policy%3A%20%28500%2C%20%27oldstable-updates%27%29%2C%20%28500%2C%20%27oldstable%27%29%0A%3E%20Architecture%3A%20amd64%20%28x86_64%29%0A%3E%20%0A%3E%20Kernel%3A%20Linux%204.9.0-9-amd64%20%28SMP%20w%2F4%20CPU%20cores%29%0A%3E%20Locale%3A%20LANG%3Dit_IT.UTF-8%2C%20LC_CTYPE%3Dit_IT.UTF-8%20%28charmap%3DUTF-8%29%2C%20LANGUAGE%3Dit_IT.UTF-8%20%28charmap%3DUTF-8%29%0A%3E%20Shell%3A%20%2Fbin%2Fsh%20linked%20to%20%2Fbin%2Fdash%0A%3E%20Init%3A%20systemd%20%28via%20%2Frun%2Fsystemd%2Fsystem%29%0A%3E%20%0A%3E%20Versions%20of%20packages%20sa-exim%20depends%20on%3A%0A%3E%20ii%20%20debconf%20%5Bdebconf-2.0%5D%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%201.5.61%0A%3E%20ii%20%20exim4-daemon-heavy%20%5Bexim4-localscanapi-2.0%5D%20%204.89-2%2Bdeb9u6%0A%3E%20ii%20%20libc6%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%202.24-11%2Bdeb9u4%0A%3E%20ii%20%20libnetaddr-ip-perl%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%204.079%2Bdfsg-1%2Bb1%0A%3E%20ii%20%20spamc%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%203.4.2-1~deb9u2%0A%3E%20%0A%3E%20Versions%20of%20packages%20sa-exim%20recommends%3A%0A%3E%20ii%20%20perl%20%205.24.1-3%2Bdeb9u5%0A%3E%20%0A%3E%20Versions%20of%20packages%20sa-exim%20suggests%3A%0A%3E%20ii%20%20spamassassin%20%203.4.2-1~deb9u2%0A%3E%20%0A%3E%20--%20debconf%20information%3A%0A%3E%20%20%20sa-exim%2Fpurge_spool%3A%20false%0A%3E%20%0A%3E%20%0A&amp;subject=Re%3A%20sa-exim%3A%20After%20upgrade%20SA%3A%20GREYLIST_ISWHITE%20skipped%2C%20insecure%20dependencies&amp;In-Reply-To=%3C157649173586.18858.2141265999720478989.reportbug%40vdmsv1.ad.fvg.lnf.it%3E">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=gaio%40sv.lnf.it" alt="">
<div class="header"><span class="headerfield">From:</span> Marco Gaiarin &lt;gaio@sv.lnf.it&gt;</div>
<div class="header"><span class="headerfield">To:</span> Debian Bug Tracking System &lt;submit@bugs.debian.org&gt;</div>
<div class="header"><span class="headerfield">Subject:</span> sa-exim: After upgrade SA: GREYLIST_ISWHITE skipped, insecure dependencies</div>
<div class="header"><span class="headerfield">Date:</span> Mon, 16 Dec 2019 11:22:15 +0100</div>
</div>
<pre class="message">Package: sa-exim
Version: 4.2.1-16
Severity: normal

Dear Maintainer,

After upgrading SA (security update, 3.4.2-1~deb9u2) i got on logs a flood of:

 Dec 16 10:04:53 vdmpp1 spamd[15196]: rules: failed to run GREYLIST_ISWHITE test, skipping:
 Dec 16 10:04:53 vdmpp1 spamd[15196]:  (Insecure dependency in eval while running with -T switch at /usr/share/perl5/Mail/SpamAssassin/Plugin/Greylisting.pm line 76.
 Dec 16 10:04:53 vdmpp1 spamd[15196]: )

probably, the security changes added into the upgraded SA &#39;broke&#39; something on sa-exim.

-- System Information:
Debian Release: 9.11
  APT prefers oldstable-updates
  APT policy: (500, &#39;oldstable-updates&#39;), (500, &#39;oldstable&#39;)
Architecture: amd64 (x86_64)

Kernel: Linux 4.9.0-9-amd64 (SMP w/4 CPU cores)
Locale: LANG=it_IT.UTF-8, LC_CTYPE=it_IT.UTF-8 (charmap=UTF-8), LANGUAGE=it_IT.UTF-8 (charmap=UTF-8)
Shell: /bin/sh linked to /bin/dash
Init: systemd (via /run/systemd/system)

Versions of packages sa-exim depends on:
ii  debconf [debconf-2.0]                        1.5.61
ii  exim4-daemon-heavy [exim4-localscanapi-2.0]  4.89-2+deb9u6
ii  libc6                                        2.24-11+deb9u4
ii  libnetaddr-ip-perl                           4.079+dfsg-1+b1
ii  spamc                                        3.4.2-1~deb9u2

Versions of packages sa-exim recommends:
ii  perl  5.24.1-3+deb9u5

Versions of packages sa-exim suggests:
ii  spamassassin  3.4.2-1~deb9u2

-- debconf information:
  sa-exim/purge_spool: false


</pre>

<div class="infmessage"><hr><p>
<a name="6"></a>
<!-- request_addr: debian-bugs-dist@lists.debian.org, Magnus Holmgren &lt;holmgren@debian.org&gt; -->
<!-- time:1576495264 -->
<strong>Information forwarded</strong>
to <code>debian-bugs-dist@lists.debian.org, Magnus Holmgren &lt;holmgren@debian.org&gt;</code>:<br>
<code>Bug#946829</code>; Package <code>sa-exim</code>.
 (Mon, 16 Dec 2019 11:21:04 GMT) (<a href="bugreport.cgi?bug=946829;msg=7">full text</a>, <a href="bugreport.cgi?bug=946829;mbox=yes;msg=7">mbox</a>, <a href="#6">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="8"></a>
<!-- request_addr: Marco Gaiarin &lt;gaio@sv.lnf.it&gt; -->
<!-- time:1576495265 -->
<strong>Acknowledgement sent</strong>
to <code>Marco Gaiarin &lt;gaio@sv.lnf.it&gt;</code>:<br>
Extra info received and forwarded to list.  Copy sent to <code>Magnus Holmgren &lt;holmgren@debian.org&gt;</code>.
 (Mon, 16 Dec 2019 11:21:05 GMT) (<a href="bugreport.cgi?bug=946829;msg=9">full text</a>, <a href="bugreport.cgi?bug=946829;mbox=yes;msg=9">mbox</a>, <a href="#8">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="10"></a><a name="msg10"></a><a href="#10">Message #10</a> received at 946829@bugs.debian.org (<a href="bugreport.cgi?bug=946829;msg=10">full text</a>, <a href="bugreport.cgi?bug=946829;mbox=yes;msg=10">mbox</a>, <a href="mailto:946829@bugs.debian.org?body=On%20Mon%2C%2016%20Dec%202019%2012%3A09%3A31%20%2B0100%20Marco%20Gaiarin%20%3Cgaio%40sv.lnf.it%3E%20wrote%3A%0A%3E%20%0A%3E%20https%3A%2F%2Fsourceforge.net%2Fp%2Fsa-exim%2Fbugs%2F3%2F%0A%3E%20%0A%3E%20%0A&amp;References=%3C20191216110931.GF3657%40sv.lnf.it%3E&amp;subject=Re%3A%20Added%20upstream.&amp;In-Reply-To=%3C20191216110931.GF3657%40sv.lnf.it%3E">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=gaio%40sv.lnf.it" alt="">
<div class="header"><span class="headerfield">From:</span> Marco Gaiarin &lt;gaio@sv.lnf.it&gt;</div>
<div class="header"><span class="headerfield">To:</span> 946829@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Added upstream.</div>
<div class="header"><span class="headerfield">Date:</span> Mon, 16 Dec 2019 12:09:31 +0100</div>
</div>
<pre class="message">
<a href="https://sourceforge.net/p/sa-exim/bugs/3/">https://sourceforge.net/p/sa-exim/bugs/3/</a>


</pre>

<div class="infmessage"><hr><p>
<a name="11"></a>
<!-- request_addr: debian-bugs-dist@lists.debian.org, Magnus Holmgren &lt;holmgren@debian.org&gt; -->
<!-- time:1576541703 -->
<strong>Information forwarded</strong>
to <code>debian-bugs-dist@lists.debian.org, Magnus Holmgren &lt;holmgren@debian.org&gt;</code>:<br>
<code>Bug#946829</code>; Package <code>sa-exim</code>.
 (Tue, 17 Dec 2019 00:15:03 GMT) (<a href="bugreport.cgi?bug=946829;msg=12">full text</a>, <a href="bugreport.cgi?bug=946829;mbox=yes;msg=12">mbox</a>, <a href="#11">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="13"></a>
<!-- request_addr: Logan Gunthorpe &lt;logang@deltatee.com&gt; -->
<!-- time:1576541704 -->
<strong>Acknowledgement sent</strong>
to <code>Logan Gunthorpe &lt;logang@deltatee.com&gt;</code>:<br>
Extra info received and forwarded to list.  Copy sent to <code>Magnus Holmgren &lt;holmgren@debian.org&gt;</code>.
 (Tue, 17 Dec 2019 00:15:04 GMT) (<a href="bugreport.cgi?bug=946829;msg=14">full text</a>, <a href="bugreport.cgi?bug=946829;mbox=yes;msg=14">mbox</a>, <a href="#13">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="15"></a><a name="msg15"></a><a href="#15">Message #15</a> received at 946829@bugs.debian.org (<a href="bugreport.cgi?bug=946829;msg=15">full text</a>, <a href="bugreport.cgi?bug=946829;mbox=yes;msg=15">mbox</a>, <a href="mailto:946829@bugs.debian.org?In-Reply-To=%3C8c3716a7-93d4-5c10-9414-333170e79787%40deltatee.com%3E&amp;References=%3C20191216110931.GF3657%40sv.lnf.it%3E%0A%20%3C20191216110931.GF3657%40sv.lnf.it%3E%0A%20%3C8c3716a7-93d4-5c10-9414-333170e79787%40deltatee.com%3E&amp;body=On%20Mon%2C%2016%20Dec%202019%2016%3A51%3A23%20-0700%20Logan%20Gunthorpe%20%3Clogang%40deltatee.com%3E%20wrote%3A%0A%3E%20I%27ve%20also%20hit%20this%20issue.%0A%3E%20%0A%3E%20%0A&amp;subject=Re%3A%20Added%20upstream.">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=logang%40deltatee.com" alt="">
<div class="header"><span class="headerfield">From:</span> Logan Gunthorpe &lt;logang@deltatee.com&gt;</div>
<div class="header"><span class="headerfield">To:</span> 946829@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Re: Added upstream.</div>
<div class="header"><span class="headerfield">Date:</span> Mon, 16 Dec 2019 16:51:23 -0700</div>
</div>
<pre class="message wrapping">I&#39;ve also hit this issue.


</pre>

<div class="msgreceived"><hr><p>
<a name="16"></a>
<!-- command:forwarded -->
<!-- requester: Salvatore Bonaccorso &lt;carnil@debian.org&gt; -->
<!-- request_addr: control@bugs.debian.org -->
<!-- time:1576737725 -->
<!-- new_data:
$new_data = {
              &#39;forwarded&#39; =&gt; &#39;<a href="https://sourceforge.net/p/sa-exim/bugs/3/">https://sourceforge.net/p/sa-exim/bugs/3/</a>&#39;
            };
-->
<!-- old_data:
$old_data = {
              &#39;forwarded&#39; =&gt; &#39;&#39;
            };
-->
<strong>Set Bug forwarded-to-address to &#39;<a href="https://sourceforge.net/p/sa-exim/bugs/3/">https://sourceforge.net/p/sa-exim/bugs/3/</a>&#39;.</strong>
Request was from <code>Salvatore Bonaccorso &lt;carnil@debian.org&gt;</code>
to <code>control@bugs.debian.org</code>.
 (Thu, 19 Dec 2019 06:42:05 GMT) (<a href="bugreport.cgi?bug=946829;msg=17">full text</a>, <a href="bugreport.cgi?bug=946829;mbox=yes;msg=17">mbox</a>, <a href="#16">link</a>).</p></p></div>

<div class="msgreceived"><hr><p>
<a name="18"></a>
<!-- command:tag -->
<!-- requester: Salvatore Bonaccorso &lt;carnil@debian.org&gt; -->
<!-- request_addr: control@bugs.debian.org -->
<!-- time:1576737728 -->
<!-- new_data:
$new_data = {
              &#39;keywords&#39; =&gt; &#39;upstream&#39;
            };
-->
<!-- old_data:
$old_data = {
              &#39;keywords&#39; =&gt; &#39;&#39;
            };
-->
<strong>Added tag(s) upstream.</strong>
Request was from <code>Salvatore Bonaccorso &lt;carnil@debian.org&gt;</code>
to <code>control@bugs.debian.org</code>.
 (Thu, 19 Dec 2019 06:42:08 GMT) (<a href="bugreport.cgi?bug=946829;msg=19">full text</a>, <a href="bugreport.cgi?bug=946829;mbox=yes;msg=19">mbox</a>, <a href="#18">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="20"></a>
<!-- request_addr: debian-bugs-dist@lists.debian.org, Magnus Holmgren &lt;holmgren@debian.org&gt; -->
<!-- time:1576740062 -->
<strong>Information forwarded</strong>
to <code>debian-bugs-dist@lists.debian.org, Magnus Holmgren &lt;holmgren@debian.org&gt;</code>:<br>
<code>Bug#946829</code>; Package <code>sa-exim</code>.
 (Thu, 19 Dec 2019 07:21:02 GMT) (<a href="bugreport.cgi?bug=946829;msg=21">full text</a>, <a href="bugreport.cgi?bug=946829;mbox=yes;msg=21">mbox</a>, <a href="#20">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="22"></a>
<!-- request_addr: Henrik Krohns &lt;hege@hege.li&gt; -->
<!-- time:1576740062 -->
<strong>Acknowledgement sent</strong>
to <code>Henrik Krohns &lt;hege@hege.li&gt;</code>:<br>
Extra info received and forwarded to list.  Copy sent to <code>Magnus Holmgren &lt;holmgren@debian.org&gt;</code>.
 (Thu, 19 Dec 2019 07:21:02 GMT) (<a href="bugreport.cgi?bug=946829;msg=23">full text</a>, <a href="bugreport.cgi?bug=946829;mbox=yes;msg=23">mbox</a>, <a href="#22">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="24"></a><a name="msg24"></a><a href="#24">Message #24</a> received at 946829@bugs.debian.org (<a href="bugreport.cgi?bug=946829;msg=24">full text</a>, <a href="bugreport.cgi?bug=946829;mbox=yes;msg=24">mbox</a>, <a href="mailto:946829@bugs.debian.org?subject=Re%3A%20Patch&amp;References=%3C20191219070613.GA11299%40hege.li%3E&amp;body=On%20Thu%2C%2019%20Dec%202019%2009%3A06%3A13%20%2B0200%20Henrik%20Krohns%20%3Chege%40hege.li%3E%20wrote%3A%0A%3E%20%0A%3E%20Hello%2C%0A%3E%20%0A%3E%20This%20was%20really%20a%20vulnerability%20which%20allowed%20running%20any%20perl%20code%20or%0A%3E%20commands%20%28even%20as%20root%29%2C%20for%20anyone%20able%20to%20write%20.cf%20files%2Frules.%0A%3E%20%0A%3E%20The%20bug%20is%20mitigated%20in%20SpamAssassin%203.4.3%2C%20which%20properly%20taints%0A%3E%20configuration%20strings%2C%20and%20results%20in%20Perl%20complaining%20and%20not%20running%0A%3E%20Greylisting.pm%20at%20all.%0A%3E%20%0A%3E%20I%27ve%20made%20a%20proper%20patch%20which%20addresses%20both%20the%20vulnerability%20and%203.4.3%0A%3E%20compatibility.%0A%3E%20%0A%3E%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0A%3E%20---%20Greylisting.pm.orig%202019-12-18%2017%3A49%3A40.351383764%20%2B0200%0A%3E%20%2B%2B%2B%20Greylisting.pm%20%20%20%20%20%202019-12-18%2022%3A30%3A03.745497552%20%2B0200%0A%3E%20%40%40%20-21%2C6%20%2B21%2C7%20%40%40%0A%3E%20%0A%3E%20%20use%20strict%3B%0A%3E%20%20use%20Mail%3A%3ASpamAssassin%3A%3APlugin%3B%0A%3E%20%2Buse%20Mail%3A%3ASpamAssassin%3A%3AUtil%20qw%28untaint_var%29%3B%0A%3E%20%20our%20%40ISA%20%3D%20qw%28Mail%3A%3ASpamAssassin%3A%3APlugin%29%3B%0A%3E%20%0A%3E%20%20sub%20new%0A%3E%20%40%40%20-65%2C9%20%2B66%2C25%20%40%40%0A%3E%20%0A%3E%20%20%20%20%20%20Mail%3A%3ASpamAssassin%3A%3APlugin%3A%3Adbg%28%22GREYLISTING%3A%20called%20function%22%29%3B%0A%3E%20%0A%3E%20-%20%20%20%20%24optionhash%20%20%3D~%20s%2F%3B%2F%2C%2Fg%3B%0A%3E%20%2B%20%20%20%20%23%24optionhash%20%20%3D~%20s%2F%3B%2F%2C%2Fg%3B%0A%3E%20%20%20%20%20%20%23%20This%20is%20safe%2C%20right%3F%20%28users%20shouldn%27t%20be%20able%20to%20set%20it%20in%20their%20config%29%0A%3E%20-%20%20%20%20%25option%3Deval%20%24optionhash%3B%0A%3E%20%2B%20%20%20%20%23%25option%3Deval%20%24optionhash%3B%0A%3E%20%2B%0A%3E%20%2B%20%20%20%20%23%20...%20no%2C%20evaling%20random%20strings%20is%20not%20safe%21%21%21%0A%3E%20%2B%20%20%20%20%23%20Ditch%20eval%20and%20parse%20hash%20string%20manually%20to%20maintain%20backwards%20compatibility%0A%3E%20%2B%20%20%20%20%24optionhash%20%3D~%20s%2F%5E%5Cs%2A%5C%28%5Cs%2A%2F%2F%3B%0A%3E%20%2B%20%20%20%20%24optionhash%20%3D~%20s%2F%5Cs%2A%5C%29%5Cs%2A%24%2F%2F%3B%0A%3E%20%2B%20%20%20%20foreach%20my%20%24opt%20%28split%28%2F%5Cs%2A%3B%5Cs%2A%2F%2C%20%24optionhash%29%29%20%7B%0A%3E%20%2B%20%20%20%20%20%20%20my%20%40vals%20%3D%20split%28%2F%5Cs%2A%3D%3E%5Cs%2A%2F%2C%20%24opt%2C%202%29%3B%0A%3E%20%2B%20%20%20%20%20%20%20next%20unless%20defined%20%24vals%5B1%5D%3B%0A%3E%20%2B%20%20%20%20%20%20%20%23%20Sanitize%20away%20quotes%20and%20any%20unneeded%20characters%2C%20then%20untaint%0A%3E%20%2B%20%20%20%20%20%20%20foreach%20%28%40vals%29%20%7B%0A%3E%20%2B%20%20%20%20%20%20%20%20%20%20%20s%2F%5B%5E%5Cw%5C%2F-%5D%2F%2Fgs%3B%0A%3E%20%2B%20%20%20%20%20%20%20%20%20%20%20%24_%20%3D%20untaint_var%28%24_%29%3B%0A%3E%20%2B%20%20%20%20%20%20%20%7D%0A%3E%20%2B%20%20%20%20%20%20%20%24option%7B%24vals%5B0%5D%7D%20%3D%20%24vals%5B1%5D%3B%0A%3E%20%2B%20%20%20%20%7D%0A%3E%20%2B%0A%3E%20%20%20%20%20%20%24self-%3E%7B%27rangreylisting%27%7D%3D1%3B%0A%3E%20%0A%3E%20%20%20%20%20%20foreach%20my%20%24reqoption%20%28qw%20%28%20method%20greylistsecs%20dontgreylistthreshold%0A%3E%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0A%3E%20%0A%3E%20Cheers%2C%0A%3E%20Henrik%0A%3E%20%0A%3E%20%0A%3E%20%0A&amp;In-Reply-To=%3C20191219070613.GA11299%40hege.li%3E">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=hege%40hege.li" alt="">
<div class="header"><span class="headerfield">From:</span> Henrik Krohns &lt;hege@hege.li&gt;</div>
<div class="header"><span class="headerfield">To:</span> 946829@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Patch</div>
<div class="header"><span class="headerfield">Date:</span> Thu, 19 Dec 2019 09:06:13 +0200</div>
</div>
<pre class="message">
Hello,

This was really a vulnerability which allowed running any perl code or
commands (even as root), for anyone able to write .cf files/rules.

The bug is mitigated in SpamAssassin 3.4.3, which properly taints
configuration strings, and results in Perl complaining and not running
Greylisting.pm at all.

I&#39;ve made a proper patch which addresses both the vulnerability and 3.4.3
compatibility.

=====================================================================
--- Greylisting.pm.orig 2019-12-18 17:49:40.351383764 +0200
+++ Greylisting.pm      2019-12-18 22:30:03.745497552 +0200
@@ -21,6 +21,7 @@

 use strict;
 use Mail::SpamAssassin::Plugin;
+use Mail::SpamAssassin::Util qw(untaint_var);
 our @ISA = qw(Mail::SpamAssassin::Plugin);

 sub new
@@ -65,9 +66,25 @@

     Mail::SpamAssassin::Plugin::dbg(&quot;GREYLISTING: called function&quot;);

-    $optionhash  =~ s/;/,/g;
+    #$optionhash  =~ s/;/,/g;
     # This is safe, right? (users shouldn&#39;t be able to set it in their config)
-    %option=eval $optionhash;
+    #%option=eval $optionhash;
+
+    # ... no, evaling random strings is not safe!!!
+    # Ditch eval and parse hash string manually to maintain backwards compatibility
+    $optionhash =~ s/^\s*\(\s*//;
+    $optionhash =~ s/\s*\)\s*$//;
+    foreach my $opt (split(/\s*;\s*/, $optionhash)) {
+       my @vals = split(/\s*=&gt;\s*/, $opt, 2);
+       next unless defined $vals[1];
+       # Sanitize away quotes and any unneeded characters, then untaint
+       foreach (@vals) {
+           s/[^\w\/-]//gs;
+           $_ = untaint_var($_);
+       }
+       $option{$vals[0]} = $vals[1];
+    }
+
     $self-&gt;{&#39;rangreylisting&#39;}=1;

     foreach my $reqoption (qw ( method greylistsecs dontgreylistthreshold
=====================================================================

Cheers,
Henrik



</pre>

<div class="infmessage"><hr><p>
<a name="25"></a>
<!-- request_addr: debian-bugs-dist@lists.debian.org, Magnus Holmgren &lt;holmgren@debian.org&gt; -->
<!-- time:1576752309 -->
<strong>Information forwarded</strong>
to <code>debian-bugs-dist@lists.debian.org, Magnus Holmgren &lt;holmgren@debian.org&gt;</code>:<br>
<code>Bug#946829</code>; Package <code>sa-exim</code>.
 (Thu, 19 Dec 2019 10:45:09 GMT) (<a href="bugreport.cgi?bug=946829;msg=26">full text</a>, <a href="bugreport.cgi?bug=946829;mbox=yes;msg=26">mbox</a>, <a href="#25">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="27"></a>
<!-- request_addr: Marco Gaiarin &lt;gaio@sv.lnf.it&gt; -->
<!-- time:1576752309 -->
<strong>Acknowledgement sent</strong>
to <code>Marco Gaiarin &lt;gaio@sv.lnf.it&gt;</code>:<br>
Extra info received and forwarded to list.  Copy sent to <code>Magnus Holmgren &lt;holmgren@debian.org&gt;</code>.
 (Thu, 19 Dec 2019 10:45:09 GMT) (<a href="bugreport.cgi?bug=946829;msg=28">full text</a>, <a href="bugreport.cgi?bug=946829;mbox=yes;msg=28">mbox</a>, <a href="#27">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="29"></a><a name="msg29"></a><a href="#29">Message #29</a> received at 946829@bugs.debian.org (<a href="bugreport.cgi?bug=946829;msg=29">full text</a>, <a href="bugreport.cgi?bug=946829;mbox=yes;msg=29">mbox</a>, <a href="mailto:946829@bugs.debian.org?In-Reply-To=%3C20191219104121.GI3624%40sv.lnf.it%3E&amp;subject=Re%3A%20Patch%20works%21&amp;References=%3C20191219104121.GI3624%40sv.lnf.it%3E&amp;body=On%20Thu%2C%2019%20Dec%202019%2011%3A41%3A21%20%2B0100%20Marco%20Gaiarin%20%3Cgaio%40sv.lnf.it%3E%20wrote%3A%0A%3E%20%0A%3E%20I%20can%20confirm%20that%20patch%20works%20as%20expected.%0A%3E%20%0A%3E%20Patch%20does%20not%20apply%20cleanly%20on%20my%20SA%20%283.4.2-1~deb9u2%29%20but%20only%20for%0A%3E%20cosmetic%20differences%2C%20attached%20a%20patch%20that%20wok%20on%20SA%203.4.2-1~deb9u2.%0A%3E%20%0A%3E%20%0A%3E%20Thanks%21%0A%3E%20%0A%3E%20--%20%0A%3E%20dott.%20Marco%20Gaiarin%09%09%09%09%20%20%20%20%20%20%20%20GNUPG%20Key%20ID%3A%20240A3D66%0A%3E%20%20%20Associazione%20%60%60La%20Nostra%20Famiglia%27%27%20%20%20%20%20%20%20%20%20%20http%3A%2F%2Fwww.lanostrafamiglia.it%2F%0A%3E%20%20%20Polo%20FVG%20%20%20-%20%20%20Via%20della%20Bont%C3%A0%2C%207%20-%2033078%20%20%20-%20%20%20San%20Vito%20al%20Tagliamento%20%28PN%29%0A%3E%20%20%20marco.gaiarin%28at%29lanostrafamiglia.it%20%20%20t%20%2B39-0434-842711%20%20%20f%20%2B39-0434-842797%0A%3E%20%0A%3E%20%09%09Dona%20il%205%20PER%20MILLE%20a%20LA%20NOSTRA%20FAMIGLIA%21%0A%3E%20%20%20%20%20%20%20http%3A%2F%2Fwww.lanostrafamiglia.it%2Findex.php%2Fit%2Fsostienici%2F5x1000%0A%3E%20%09%28cf%2000307430132%2C%20categoria%20ONLUS%20oppure%20RICERCA%20SANITARIA%29%0A">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=gaio%40sv.lnf.it" alt="">
<div class="header"><span class="headerfield">From:</span> Marco Gaiarin &lt;gaio@sv.lnf.it&gt;</div>
<div class="header"><span class="headerfield">To:</span> 946829@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Patch works!</div>
<div class="header"><span class="headerfield">Date:</span> Thu, 19 Dec 2019 11:41:21 +0100</div>
</div>
<pre class="mime">[<a href="bugreport.cgi?att=0;bug=946829;msg=29">Message part 1</a> (text/plain, inline)]</pre>
<pre class="message">
I can confirm that patch works as expected.

Patch does not apply cleanly on my SA (3.4.2-1~deb9u2) but only for
cosmetic differences, attached a patch that wok on SA 3.4.2-1~deb9u2.


Thanks!

-- 
dott. Marco Gaiarin				        GNUPG Key ID: 240A3D66
  Associazione ``La Nostra Famiglia&#39;&#39;          <a href="http://www.lanostrafamiglia.it/">http://www.lanostrafamiglia.it/</a>
  Polo FVG   -   Via della Bont√†, 7 - 33078   -   San Vito al Tagliamento (PN)
  marco.gaiarin(at)lanostrafamiglia.it   t +39-0434-842711   f +39-0434-842797

		Dona il 5 PER MILLE a LA NOSTRA FAMIGLIA!
      <a href="http://www.lanostrafamiglia.it/index.php/it/sostienici/5x1000">http://www.lanostrafamiglia.it/index.php/it/sostienici/5x1000</a>
	(cf 00307430132, categoria ONLUS oppure RICERCA SANITARIA)
</pre>
<pre class="mime">[<a href="bugreport.cgi?att=1;bug=946829;filename=Greylisting.pm.diff;msg=29">Greylisting.pm.diff</a> (text/x-diff, attachment)]</pre>

<div class="msgreceived"><hr><p>
<a name="30"></a>
<!-- command:affects -->
<!-- requester: Salvatore Bonaccorso &lt;carnil@debian.org&gt; -->
<!-- request_addr: control@bugs.debian.org -->
<!-- time:1576771745 -->
<!-- new_data:
$new_data = {
              &#39;affects&#39; =&gt; &#39;release.debian.org,security.debian.org&#39;
            };
-->
<!-- old_data:
$old_data = {
              &#39;affects&#39; =&gt; &#39;&#39;
            };
-->
<strong>Added indication that 946829 affects release.debian.org and security.debian.org</strong>
Request was from <code>Salvatore Bonaccorso &lt;carnil@debian.org&gt;</code>
to <code>control@bugs.debian.org</code>.
 (Thu, 19 Dec 2019 16:09:05 GMT) (<a href="bugreport.cgi?bug=946829;msg=31">full text</a>, <a href="bugreport.cgi?bug=946829;mbox=yes;msg=31">mbox</a>, <a href="#30">link</a>).</p></p></div>

<div class="msgreceived"><hr><p>
<a name="32"></a>
<!-- requester: Salvatore Bonaccorso &lt;carnil@debian.org&gt; -->
<!-- request_addr: control@bugs.debian.org -->
<!-- time:1576964706 -->
<strong>Severity set to &#39;serious&#39; from &#39;normal&#39;</strong>
Request was from <code>Salvatore Bonaccorso &lt;carnil@debian.org&gt;</code>
to <code>control@bugs.debian.org</code>.
 (Sat, 21 Dec 2019 21:45:06 GMT) (<a href="bugreport.cgi?bug=946829;msg=33">full text</a>, <a href="bugreport.cgi?bug=946829;mbox=yes;msg=33">mbox</a>, <a href="#32">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="34"></a>
<!-- request_addr: debian-bugs-dist@lists.debian.org, Magnus Holmgren &lt;holmgren@debian.org&gt; -->
<!-- time:1577043735 -->
<strong>Information forwarded</strong>
to <code>debian-bugs-dist@lists.debian.org, Magnus Holmgren &lt;holmgren@debian.org&gt;</code>:<br>
<code>Bug#946829</code>; Package <code>sa-exim</code>.
 (Sun, 22 Dec 2019 19:42:15 GMT) (<a href="bugreport.cgi?bug=946829;msg=35">full text</a>, <a href="bugreport.cgi?bug=946829;mbox=yes;msg=35">mbox</a>, <a href="#34">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="36"></a>
<!-- request_addr: Salvatore Bonaccorso &lt;carnil@debian.org&gt; -->
<!-- time:1577043735 -->
<strong>Acknowledgement sent</strong>
to <code>Salvatore Bonaccorso &lt;carnil@debian.org&gt;</code>:<br>
Extra info received and forwarded to list.  Copy sent to <code>Magnus Holmgren &lt;holmgren@debian.org&gt;</code>.
 (Sun, 22 Dec 2019 19:42:15 GMT) (<a href="bugreport.cgi?bug=946829;msg=37">full text</a>, <a href="bugreport.cgi?bug=946829;mbox=yes;msg=37">mbox</a>, <a href="#36">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="38"></a><a name="msg38"></a><a href="#38">Message #38</a> received at 946829@bugs.debian.org (<a href="bugreport.cgi?bug=946829;msg=38">full text</a>, <a href="bugreport.cgi?bug=946829;mbox=yes;msg=38">mbox</a>, <a href="mailto:946829@bugs.debian.org?In-Reply-To=%3C20191222194051.GA1424052%40eldamar.local%3E&amp;subject=Re%3A%20CVE-2019-19920&amp;References=%3C157649173586.18858.2141265999720478989.reportbug%40vdmsv1.ad.fvg.lnf.it%3E%0A%20%3C20191219070613.GA11299%40hege.li%3E%0A%20%3C20191222194051.GA1424052%40eldamar.local%3E&amp;body=On%20Sun%2C%2022%20Dec%202019%2020%3A40%3A51%20%2B0100%20Salvatore%20Bonaccorso%20%3Ccarnil%40debian.org%3E%20wrote%3A%0A%3E%20Control%3A%20clone%20946829%20-1%0A%3E%20Control%3A%20retitle%20-1%20sa-exim%3A%20CVE-2019-19920%0A%3E%20Control%3A%20tags%20-1%20%2B%20security%0A%3E%20%0A%3E%20Hi%2C%0A%3E%20%0A%3E%20On%20Thu%2C%20Dec%2019%2C%202019%20at%2009%3A06%3A13AM%20%2B0200%2C%20Henrik%20Krohns%20wrote%3A%0A%3E%20%3E%20%0A%3E%20%3E%20Hello%2C%0A%3E%20%3E%20%0A%3E%20%3E%20This%20was%20really%20a%20vulnerability%20which%20allowed%20running%20any%20perl%20code%20or%0A%3E%20%3E%20commands%20%28even%20as%20root%29%2C%20for%20anyone%20able%20to%20write%20.cf%20files%2Frules.%0A%3E%20%0A%3E%20MITRE%20has%20assigned%20CVE-2019-19920%20for%20this%20issue%20itself.%20As%20your%20patch%0A%3E%20adresses%20both%20the%20vulnerability%20and%20the%20compatibility%20I%27m%20still%20just%0A%3E%20for%20distinction%2C%20I%27m%20cloning%20this%20bug%20accordingly%20%28but%20patch%20can%20close%0A%3E%20then%20both%20bugs%29.%0A%3E%20%0A%3E%20https%3A%2F%2Fmarc.info%2F%3Fl%3Dspamassassin-users%26m%3D157668107325768%26w%3D2%0A%3E%20https%3A%2F%2Fmarc.info%2F%3Fl%3Dspamassassin-users%26m%3D157668305026635%26w%3D2%0A%3E%20%0A%3E%20Regards%2C%0A%3E%20Salvatore%0A%3E%20%0A%3E%20%0A">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=carnil%40debian.org" alt="">
<div class="header"><span class="headerfield">From:</span> Salvatore Bonaccorso &lt;carnil@debian.org&gt;</div>
<div class="header"><span class="headerfield">To:</span> Henrik Krohns &lt;hege@hege.li&gt;, 946829@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> CVE-2019-19920</div>
<div class="header"><span class="headerfield">Date:</span> Sun, 22 Dec 2019 20:40:51 +0100</div>
</div>
<pre class="message">Control: clone 946829 -1
Control: retitle -1 sa-exim: <a href="https://security-tracker.debian.org/tracker/CVE-2019-19920">CVE-2019-19920</a>
Control: tags -1 + security

Hi,

On Thu, Dec 19, 2019 at 09:06:13AM +0200, Henrik Krohns wrote:
&gt; 
&gt; Hello,
&gt; 
&gt; This was really a vulnerability which allowed running any perl code or
&gt; commands (even as root), for anyone able to write .cf files/rules.

MITRE has assigned <a href="https://security-tracker.debian.org/tracker/CVE-2019-19920">CVE-2019-19920</a> for this issue itself. As your patch
adresses both the vulnerability and the compatibility I&#39;m still just
for distinction, I&#39;m cloning this bug accordingly (but patch can close
then both bugs).

<a href="https://marc.info/?l=spamassassin-users&amp;m=157668107325768&amp;w=2">https://marc.info/?l=spamassassin-users&amp;m=157668107325768&amp;w=2</a>
<a href="https://marc.info/?l=spamassassin-users&amp;m=157668305026635&amp;w=2">https://marc.info/?l=spamassassin-users&amp;m=157668305026635&amp;w=2</a>

Regards,
Salvatore


</pre>

<div class="msgreceived"><hr><p>
<a name="39"></a>
<!-- requester: Salvatore Bonaccorso &lt;carnil@debian.org&gt; -->
<!-- request_addr: 946829-submit@bugs.debian.org -->
<!-- time:1577043735 -->
<strong>Bug <a href="bugreport.cgi?bug=946829">946829</a> cloned as bug <a href="bugreport.cgi?bug=947198">947198</a></strong>
Request was from <code>Salvatore Bonaccorso &lt;carnil@debian.org&gt;</code>
to <code>946829-submit@bugs.debian.org</code>.
 (Sun, 22 Dec 2019 19:42:15 GMT) (<a href="bugreport.cgi?bug=946829;msg=40">full text</a>, <a href="bugreport.cgi?bug=946829;mbox=yes;msg=40">mbox</a>, <a href="#39">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="41"></a>
<!-- request_addr: debian-bugs-dist@lists.debian.org -->
<!-- time:1578682982 -->
<strong>Information forwarded</strong>
to <code>debian-bugs-dist@lists.debian.org</code>:<br>
<code>Bug#946829</code>; Package <code>sa-exim</code>.
 (Fri, 10 Jan 2020 19:03:02 GMT) (<a href="bugreport.cgi?bug=946829;msg=42">full text</a>, <a href="bugreport.cgi?bug=946829;mbox=yes;msg=42">mbox</a>, <a href="#41">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="43"></a>
<!-- request_addr: Magnus Holmgren &lt;holmgren@debian.org&gt; -->
<!-- time:1578682982 -->
<strong>Acknowledgement sent</strong>
to <code>Magnus Holmgren &lt;holmgren@debian.org&gt;</code>:<br>
Extra info received and forwarded to list.
 (Fri, 10 Jan 2020 19:03:02 GMT) (<a href="bugreport.cgi?bug=946829;msg=44">full text</a>, <a href="bugreport.cgi?bug=946829;mbox=yes;msg=44">mbox</a>, <a href="#43">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="45"></a><a name="msg45"></a><a href="#45">Message #45</a> received at 946829@bugs.debian.org (<a href="bugreport.cgi?bug=946829;msg=45">full text</a>, <a href="bugreport.cgi?bug=946829;mbox=yes;msg=45">mbox</a>, <a href="mailto:946829@bugs.debian.org?References=%3C157649173586.18858.2141265999720478989.reportbug%40vdmsv1.ad.fvg.lnf.it%3E%20%3C20191219104121.GI3624%40sv.lnf.it%3E%0A%20%3C3378389.CmQyi7ecus%40johansson%3E&amp;body=On%20Fri%2C%2010%20Jan%202020%2019%3A36%3A35%20%2B0100%20Magnus%20Holmgren%20%3Cholmgren%40debian.org%3E%20wrote%3A%0A%3E%20torsdag%2019%20december%202019%20kl.%2011%3A41%3A21%20CET%20skrev%20du%3A%0A%3E%20%3E%20I%20can%20confirm%20that%20patch%20works%20as%20expected.%0A%3E%20%3E%20%0A%3E%20%3E%20Patch%20does%20not%20apply%20cleanly%20on%20my%20SA%20%283.4.2-1~deb9u2%29%20but%20only%20for%0A%3E%20%3E%20cosmetic%20differences%2C%20attached%20a%20patch%20that%20wok%20on%20SA%203.4.2-1~deb9u2.%0A%3E%20%3E%20%0A%3E%20%3E%20%0A%3E%20%3E%20Thanks%21%0A%3E%20%0A%3E%20I%20came%20up%20with%20the%20following%20RE%20loop%20to%20parse%20the%20options%20string.%20It%20should%20%0A%3E%20allow%20a%20few%20more%20things%20that%20admins%20might%20potentially%20be%20using%2C%20like%20non-%0A%3E%20integer%20values%20%28for%20dontgreylistthreshold%29%2C%20while%20barfing%20on%20bad%20syntax.%0A%3E%20%0A%3E%20%20%20%20%20while%20%28%24optionhash%20%3D~%20%2F%28%3F%3A%5CG%28%3F%3C%21%5E%29%7C%5E%5Cs%2A%5C%28%29%5Cs%2A%28%3F%3E%28%3F%3Cquot1%3E%5B%27%22%5D%29%28%3F%3Copt%3E.%2A%3F%29%0A%3E%20%5Cg%7Bquot1%7D%29%0A%3E%20%09%20%20%20%5Cs%2A%3D%3E%5Cs%2A%0A%3E%20%09%20%20%20%28%3F%3E%28%3F%3Cquot2%3E%5B%27%22%5D%29%28%3F%3Cval%3E.%2A%3F%29%5Cg%7Bquot2%7D%0A%3E%20%09%20%20%20%20%20%20%7C%0A%3E%20%09%20%20%20%20%20%20%28%3F%3Cval%3E-%3F%28%3F%3A%5Cd%2B%28%3F%3A%5C.%5Cd%2A%29%3F%7C%28%3F%3A%5Cd%2A%5C.%29%3F%5Cd%2B%29%29%0A%3E%20%09%20%20%20%29%5Cs%2A%28%3F%3A%3B%3F%5Cs%2A%5C%29%5Cs%2A%24%7C%3B%28%3F%21%24%29%29%2Fgxc%29%20%7B%0A%3E%20%09%24option%7B%24%2B%7Bopt%7D%7D%20%3D%20%24%2B%7Bval%7D%3B%0A%3E%20%20%20%20%20%7D%0A%3E%20%20%20%20%20if%20%28%28pos%28%24optionhash%29%20%2F%2F%200%29%20%3C%20length%20%24optionhash%29%20%7B%0A%3E%20%09die%20%22Syntax%20error%22%3B%0A%3E%20%20%20%20%20%7D%0A%3E%20%0A%3E%20I%20just%20need%20to%20add%20the%20variable%20untainting.%0A%3E%20%0A%3E%20--%20%0A%3E%20Magnus%20Holmgren%20%20%20%20%20%20%20%20holmgren%40debian.org%0A%3E%20Debian%20Developer%20&amp;subject=Re%3A%20Bug%23946829%3A%20Patch%20works%21&amp;In-Reply-To=%3C3378389.CmQyi7ecus%40johansson%3E">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=holmgren%40debian.org" alt="">
<div class="header"><span class="headerfield">From:</span> Magnus Holmgren &lt;holmgren@debian.org&gt;</div>
<div class="header"><span class="headerfield">To:</span> Marco Gaiarin &lt;gaio@sv.lnf.it&gt;, 946829@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Re: Bug#946829: Patch works!</div>
<div class="header"><span class="headerfield">Date:</span> Fri, 10 Jan 2020 19:36:35 +0100</div>
</div>
<pre class="mime">[<a href="bugreport.cgi?att=0;bug=946829;msg=45">Message part 1</a> (text/plain, inline)]</pre>
<pre class="message">torsdag 19 december 2019 kl. 11:41:21 CET skrev du:
&gt; I can confirm that patch works as expected.
&gt; 
&gt; Patch does not apply cleanly on my SA (3.4.2-1~deb9u2) but only for
&gt; cosmetic differences, attached a patch that wok on SA 3.4.2-1~deb9u2.
&gt; 
&gt; 
&gt; Thanks!

I came up with the following RE loop to parse the options string. It should 
allow a few more things that admins might potentially be using, like non-
integer values (for dontgreylistthreshold), while barfing on bad syntax.

    while ($optionhash =~ /(?:\G(?&lt;!^)|^\s*\()\s*(?&gt;(?&lt;quot1&gt;[&#39;&quot;])(?&lt;opt&gt;.*?)
\g{quot1})
	   \s*=&gt;\s*
	   (?&gt;(?&lt;quot2&gt;[&#39;&quot;])(?&lt;val&gt;.*?)\g{quot2}
	      |
	      (?&lt;val&gt;-?(?:\d+(?:\.\d*)?|(?:\d*\.)?\d+))
	   )\s*(?:;?\s*\)\s*$|;(?!$))/gxc) {
	$option{$+{opt}} = $+{val};
    }
    if ((pos($optionhash) // 0) &lt; length $optionhash) {
	die &quot;Syntax error&quot;;
    }

I just need to add the variable untainting.

-- 
Magnus Holmgren        holmgren@debian.org
Debian Developer </pre>
<pre class="mime">[<a href="bugreport.cgi?att=1;bug=946829;filename=signature.asc;msg=45">signature.asc</a> (application/pgp-signature, inline)]</pre>

<div class="msgreceived"><hr><p>
<a name="46"></a>
<!-- request_addr: Magnus Holmgren &lt;holmgren@debian.org&gt; -->
<!-- time:1581203525 -->
<strong>Reply sent</strong>
to <code>Magnus Holmgren &lt;holmgren@debian.org&gt;</code>:<br>
You have taken responsibility.
 (Sat, 08 Feb 2020 23:12:05 GMT) (<a href="bugreport.cgi?bug=946829;msg=47">full text</a>, <a href="bugreport.cgi?bug=946829;mbox=yes;msg=47">mbox</a>, <a href="#46">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="48"></a>
<!-- request_addr: Marco Gaiarin &lt;gaio@sv.lnf.it&gt; -->
<!-- time:1581203525 -->
<strong>Notification sent</strong>
to <code>Marco Gaiarin &lt;gaio@sv.lnf.it&gt;</code>:<br>
Bug acknowledged by developer.
 (Sat, 08 Feb 2020 23:12:05 GMT) (<a href="bugreport.cgi?bug=946829;msg=49">full text</a>, <a href="bugreport.cgi?bug=946829;mbox=yes;msg=49">mbox</a>, <a href="#48">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="50"></a><a name="msg50"></a><a href="#50">Message #50</a> received at 946829-close@bugs.debian.org (<a href="bugreport.cgi?bug=946829;msg=50">full text</a>, <a href="bugreport.cgi?bug=946829;mbox=yes;msg=50">mbox</a>, <a href="mailto:946829@bugs.debian.org?subject=Re%3A%20Bug%23946829%3A%20fixed%20in%20sa-exim%204.2.1-19&amp;body=On%20Sat%2C%2008%20Feb%202020%2023%3A08%3A24%20%2B0000%20Debian%20FTP%20Masters%20%3Cftpmaster%40ftp-master.debian.org%3E%20wrote%3A%0A%3E%20Source%3A%20sa-exim%0A%3E%20Source-Version%3A%204.2.1-19%0A%3E%20%0A%3E%20We%20believe%20that%20the%20bug%20you%20reported%20is%20fixed%20in%20the%20latest%20version%20of%0A%3E%20sa-exim%2C%20which%20is%20due%20to%20be%20installed%20in%20the%20Debian%20FTP%20archive.%0A%3E%20%0A%3E%20A%20summary%20of%20the%20changes%20between%20this%20version%20and%20the%20previous%20one%20is%0A%3E%20attached.%0A%3E%20%0A%3E%20Thank%20you%20for%20reporting%20the%20bug%2C%20which%20will%20now%20be%20closed.%20%20If%20you%0A%3E%20have%20further%20comments%20please%20address%20them%20to%20946829%40bugs.debian.org%2C%0A%3E%20and%20the%20maintainer%20will%20reopen%20the%20bug%20report%20if%20appropriate.%0A%3E%20%0A%3E%20Debian%20distribution%20maintenance%20software%0A%3E%20pp.%0A%3E%20Magnus%20Holmgren%20%3Cholmgren%40debian.org%3E%20%28supplier%20of%20updated%20sa-exim%20package%29%0A%3E%20%0A%3E%20%28This%20message%20was%20generated%20automatically%20at%20their%20request%3B%20if%20you%0A%3E%20believe%20that%20there%20is%20a%20problem%20with%20it%20please%20contact%20the%20archive%0A%3E%20administrators%20by%20mailing%20ftpmaster%40ftp-master.debian.org%29%0A%3E%20%0A%3E%20%0A%3E%20-----BEGIN%20PGP%20SIGNED%20MESSAGE-----%0A%3E%20Hash%3A%20SHA256%0A%3E%20%0A%3E%20Format%3A%201.8%0A%3E%20Date%3A%20Sat%2C%2008%20Feb%202020%2022%3A53%3A50%20%2B0100%0A%3E%20Source%3A%20sa-exim%0A%3E%20Architecture%3A%20source%0A%3E%20Version%3A%204.2.1-19%0A%3E%20Distribution%3A%20unstable%0A%3E%20Urgency%3A%20medium%0A%3E%20Maintainer%3A%20Magnus%20Holmgren%20%3Cholmgren%40debian.org%3E%0A%3E%20Changed-By%3A%20Magnus%20Holmgren%20%3Cholmgren%40debian.org%3E%0A%3E%20Closes%3A%20946829%20947198%0A%3E%20Changes%3A%0A%3E%20%20sa-exim%20%284.2.1-19%29%20unstable%3B%20urgency%3Dmedium%0A%3E%20%20.%0A%3E%20%20%20%20%2A%20no_eval.patch%3A%20%5BCVE-2019-19920%5D%20Manually%20parse%20option%20string%20in%0A%3E%20%20%20%20%20%20Greylisting%20plugin%2C%20avoiding%20use%20of%20eval%28%29%20%28Closes%3A%20%23946829%2C%20%23947198%29.%0A%3E%20%20%20%20%2A%20Bump%20Standards-Version%20to%204.5.0.%0A%3E%20Checksums-Sha1%3A%0A%3E%20%20c480985df56479605a5ca15ddba034086b805c53%201820%20sa-exim_4.2.1-19.dsc%0A%3E%20%20ce2ef1ce8674a2c8b21e3214722a4e1ea82ac2af%2028216%20sa-exim_4.2.1-19.debian.tar.xz%0A%3E%20%20e4dadc4d7cf301dea1bd5bd78c6e7da56a6b6daf%205904%20sa-exim_4.2.1-19_source.buildinfo%0A%3E%20Checksums-Sha256%3A%0A%3E%20%20e1bba78dc7f8aa47ca64897878acf269d084d2d4f2a8fdccefc735a63308a982%201820%20sa-exim_4.2.1-19.dsc%0A%3E%20%20f36f013da6d4069625b4c4d8d19683ee386eee141e6689b4a2c2eed3b338b26e%2028216%20sa-exim_4.2.1-19.debian.tar.xz%0A%3E%20%202abd7efa5da3d95ac496faa3ae99301393e7daa865624a91ed73d76ff9d3ef2c%205904%20sa-exim_4.2.1-19_source.buildinfo%0A%3E%20Files%3A%0A%3E%20%20e1914000ea76aa178d729ac33b8d5b0d%201820%20mail%20optional%20sa-exim_4.2.1-19.dsc%0A%3E%20%207b0e4562dda375436bdcd7a0eb35cf46%2028216%20mail%20optional%20sa-exim_4.2.1-19.debian.tar.xz%0A%3E%20%206f0fdeaa29ada1fd8b356e09324fd925%205904%20mail%20optional%20sa-exim_4.2.1-19_source.buildinfo%0A%3E%20%0A%3E%20-----BEGIN%20PGP%20SIGNATURE-----%0A%3E%20%0A%3E%20iQIzBAEBCAAdFiEEzSoHOzhhVBcKQILo1PIZv%2ByZhIkFAl4%2FNQkACgkQ1PIZv%2ByZ%0A%3E%20hInJyQ%2F9FTRIK0QHRD%2F77bE2tlgIyk2YYuJkWXbsd9IIOkmXO2J8n%2Br0xOpRyQs%2F%0A%3E%203dcdfE4sbTUGpFkjbQsH9JBpNdY19EXUKnq559BphNroFLhe9wlRHsh5L%2BXnkzaY%0A%3E%20N9auZAsLi2PEqLMYFJ61fPTdVAMr%2FTGaCIkDdILLuIJnUaIjT0HdoOr8sqiV8L5t%0A&amp;References=%3CE1j0ZD6-000Aii-Qn%40fasolo.debian.org%3E&amp;In-Reply-To=%3CE1j0ZD6-000Aii-Qn%40fasolo.debian.org%3E">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=ftpmaster%40ftp-master.debian.org" alt="">
<div class="header"><span class="headerfield">From:</span> Debian FTP Masters &lt;ftpmaster@ftp-master.debian.org&gt;</div>
<div class="header"><span class="headerfield">To:</span> 946829-close@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Bug#946829: fixed in sa-exim 4.2.1-19</div>
<div class="header"><span class="headerfield">Date:</span> Sat, 08 Feb 2020 23:08:24 +0000</div>
</div>
<pre class="message">Source: sa-exim
Source-Version: 4.2.1-19

We believe that the bug you reported is fixed in the latest version of
sa-exim, which is due to be installed in the Debian FTP archive.

A summary of the changes between this version and the previous one is
attached.

Thank you for reporting the bug, which will now be closed.  If you
have further comments please address them to 946829@bugs.debian.org,
and the maintainer will reopen the bug report if appropriate.

Debian distribution maintenance software
pp.
Magnus Holmgren &lt;holmgren@debian.org&gt; (supplier of updated sa-exim package)

(This message was generated automatically at their request; if you
believe that there is a problem with it please contact the archive
administrators by mailing ftpmaster@ftp-master.debian.org)


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256

Format: 1.8
Date: Sat, 08 Feb 2020 22:53:50 +0100
Source: sa-exim
Architecture: source
Version: 4.2.1-19
Distribution: unstable
Urgency: medium
Maintainer: Magnus Holmgren &lt;holmgren@debian.org&gt;
Changed-By: Magnus Holmgren &lt;holmgren@debian.org&gt;
Closes: <a href="bugreport.cgi?bug=946829">946829</a> <a href="bugreport.cgi?bug=947198">947198</a>
Changes:
 sa-exim (4.2.1-19) unstable; urgency=medium
 .
   * no_eval.patch: [<a href="https://security-tracker.debian.org/tracker/CVE-2019-19920">CVE-2019-19920</a>] Manually parse option string in
     Greylisting plugin, avoiding use of eval() (Closes: #<a href="bugreport.cgi?bug=946829">946829</a>, #<a href="bugreport.cgi?bug=947198">947198</a>).
   * Bump Standards-Version to 4.5.0.
Checksums-Sha1:
 c480985df56479605a5ca15ddba034086b805c53 1820 sa-exim_4.2.1-19.dsc
 ce2ef1ce8674a2c8b21e3214722a4e1ea82ac2af 28216 sa-exim_4.2.1-19.debian.tar.xz
 e4dadc4d7cf301dea1bd5bd78c6e7da56a6b6daf 5904 sa-exim_4.2.1-19_source.buildinfo
Checksums-Sha256:
 e1bba78dc7f8aa47ca64897878acf269d084d2d4f2a8fdccefc735a63308a982 1820 sa-exim_4.2.1-19.dsc
 f36f013da6d4069625b4c4d8d19683ee386eee141e6689b4a2c2eed3b338b26e 28216 sa-exim_4.2.1-19.debian.tar.xz
 2abd7efa5da3d95ac496faa3ae99301393e7daa865624a91ed73d76ff9d3ef2c 5904 sa-exim_4.2.1-19_source.buildinfo
Files:
 e1914000ea76aa178d729ac33b8d5b0d 1820 mail optional sa-exim_4.2.1-19.dsc
 7b0e4562dda375436bdcd7a0eb35cf46 28216 mail optional sa-exim_4.2.1-19.debian.tar.xz
 6f0fdeaa29ada1fd8b356e09324fd925 5904 mail optional sa-exim_4.2.1-19_source.buildinfo

-----BEGIN PGP SIGNATURE-----

iQIzBAEBCAAdFiEEzSoHOzhhVBcKQILo1PIZv+yZhIkFAl4/NQkACgkQ1PIZv+yZ
hInJyQ/9FTRIK0QHRD/77bE2tlgIyk2YYuJkWXbsd9IIOkmXO2J8n+r0xOpRyQs/
3dcdfE4sbTUGpFkjbQsH9JBpNdY19EXUKnq559BphNroFLhe9wlRHsh5L+XnkzaY
N9auZAsLi2PEqLMYFJ61fPTdVAMr/TGaCIkDdILLuIJnUaIjT0HdoOr8sqiV8L5t
iMPcd4wca3mYhNWZqUrKkJ71ECEh/LvyhoYbV4HL7grmm8XawwzAyHd5GB8QRTjW
3cewBw6ZmWLGrtGZUkZCtH9BKz5GeV8jSxv+qvs73S1GdcZJaJ6WU36R38uCXFPi
IKYrLcfNAoK9kFQIkkGYoD2Nu7OLJ6RkW9YCTIQj+ftD6jQuq1Cd4J5C2Vt42+8k
xHjN7keX5YJ+ecfniHTCnEZHg+A6OY6IbSbzUiMnRzlzpZeo5az/YzggzfwQ49wA
TildWCM4KVsr8+8Wa5d6YdfGF+Z6ZLYbmDtjd7+Ubb4gh1SAwLJX4lyjuLtG1Gaa
UVmGk8tfg0AXs1rKyG0FOmsTt/rANKN/qv/E2WcLgbvQ2RJZ0xVDUkzcL76FppEn
sRytBWD/Gl4Rs4+XtsNxyZALqkcWBcklhlD8i1HUQxIlzXKMbM0/xXeSoZlXywBV
Hef90PJnISxyn9xcFsaVlaT42B0AUrqUYlWik2dDeWqzqHu0rfE=
=288w
-----END PGP SIGNATURE-----



</pre>

<div class="msgreceived"><hr><p>
<a name="51"></a>
<!-- command:archive -->
<!-- requester: Debbugs Internal Request &lt;owner@bugs.debian.org&gt; -->
<!-- request_addr: internal_control@bugs.debian.org -->
<!-- time:1631431933 -->
<!-- new_data:
$new_data = {};
-->
<!-- old_data:
$old_data = {};
-->
<strong>Bug archived.</strong>
Request was from <code>Debbugs Internal Request &lt;owner@bugs.debian.org&gt;</code>
to <code>internal_control@bugs.debian.org</code>.
 (Sun, 12 Sep 2021 07:32:13 GMT) (<a href="bugreport.cgi?bug=946829;msg=52">full text</a>, <a href="bugreport.cgi?bug=946829;mbox=yes;msg=52">mbox</a>, <a href="#51">link</a>).</p></p></div>

<hr>
<p class="msgreceived">Send a report that <a href="https://bugs.debian.org/cgi-bin/bugspam.cgi?bug=946829">this bug log contains spam</a>.</p>
<hr>
<ADDRESS>Debian bug tracking system administrator &lt;<A HREF="mailto:owner@bugs.debian.org">owner@bugs.debian.org</A>&gt;.
Last modified:
<!--timestamp-->Sat Oct 30 18:21:40 2021<!--end timestamp-->; 
Machine Name:
<!--machinename-->bembo<!--machinename-->
<P>
<A HREF="https://www.debian.org/Bugs/">Debian Bug tracking system</A>
</p>
<p>
  Debbugs is free software and licensed under the terms of the GNU
  Public License version 2. The current version can be obtained
  from <a href="https://bugs.debian.org/debbugs-source/">https://bugs.debian.org/debbugs-source/</a>.
</p>
<p>
Copyright ¬© 1999 Darren O. Benham,
1997,2003 nCipher Corporation Ltd,
1994-97 Ian Jackson,
2005-2017 Don Armstrong, and many other contributors.
</p>
</ADDRESS>

</body>
</html>
