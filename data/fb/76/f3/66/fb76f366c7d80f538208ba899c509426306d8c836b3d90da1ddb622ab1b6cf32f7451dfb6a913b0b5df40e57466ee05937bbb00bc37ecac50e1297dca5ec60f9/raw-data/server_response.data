<!DOCTYPE html>
<html lang="en">
  <head>
      <meta charset="UTF-8">
<meta property="og:type" content="website">
<meta property="og:title" content="1193038 - UAF in Telemetry::Accumulate(); code appears to not be thread-safe">
<meta property="og:url" content="https://bugzilla.mozilla.org/show_bug.cgi?id=1193038">
<meta property="og:description"
      content="RESOLVED (rjesup) in Toolkit - Telemetry. Last updated 2016-07-02.">
<meta name="twitter:label1" value="Type">
<meta name="twitter:data1" value="defect">
<meta name="twitter:label2" value="Priority">
<meta name="twitter:data2" value="--">

    <meta name="viewport" content="width=1024">
    <meta name="color-scheme" content="dark light">
    <meta name="generator" content="Bugzilla 20211025.1">
    <meta name="bugzilla-global" content="dummy"
        id="bugzilla-global" data-bugzilla="{&quot;api_token&quot;:&quot;&quot;,&quot;config&quot;:{&quot;basepath&quot;:&quot;\/&quot;},&quot;constant&quot;:{&quot;COMMENT_COLS&quot;:80},&quot;param&quot;:{&quot;maxattachmentsize&quot;:&quot;10240&quot;,&quot;maxusermatches&quot;:&quot;50&quot;,&quot;splinter_base&quot;:&quot;\/page.cgi?id=splinter.html&amp;ignore=\/&quot;},&quot;string&quot;:{&quot;bug_type_required&quot;:&quot;You must select a Type for this bug&quot;,&quot;component_required&quot;:&quot;You must select a Component for this bug&quot;,&quot;description_required&quot;:&quot;You must enter a Description for this bug&quot;,&quot;short_desc_required&quot;:&quot;You must enter a Summary for this bug&quot;,&quot;version_required&quot;:&quot;You must select a Version for this bug&quot;},&quot;user&quot;:{&quot;is_new&quot;:1,&quot;login&quot;:&quot;&quot;}}">
    <title>1193038 - UAF in Telemetry::Accumulate(); code appears to not be thread-safe</title>

<link rel="Top" href="/">

  


  
    <link rel="Show" title="Dependency Tree"
          href="/showdependencytree.cgi?id=1193038&amp;hide_resolved=1">
      <link rel="Show" title="Dependency Graph"
            href="/showdependencygraph.cgi?id=1193038">

      <link rel="Show" title="Bug Activity"
            href="/show_activity.cgi?id=1193038">

<link href="/static/v20211025.1/skins/yui.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/skins/standard/global.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/extensions/BugModal/web/bug_modal.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/js/jquery/plugins/contextMenu/contextMenu.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/extensions/BMO/web/styles/bug_modal.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/extensions/EditComments/web/styles/inline-editor.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/js/jquery/ui/jquery-ui-min.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/js/jquery/ui/jquery-ui-structure-min.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/js/jquery/ui/jquery-ui-theme-min.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/skins/lib/prism.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/extensions/Needinfo/web/styles/needinfo.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/extensions/Review/web/styles/badge.css" rel="stylesheet" type="text/css">



    
<script nonce="EjgdwqwhM2zYuwqrvf7DR3rGsiV0tO03ydmpb05xM3JTYBFn" src="/static/v20211025.1/js/jquery/jquery-min.js"></script><script nonce="EjgdwqwhM2zYuwqrvf7DR3rGsiV0tO03ydmpb05xM3JTYBFn" src="/static/v20211025.1/js/jquery/ui/jquery-ui-min.js"></script><script nonce="EjgdwqwhM2zYuwqrvf7DR3rGsiV0tO03ydmpb05xM3JTYBFn" src="/static/v20211025.1/js/yui.js"></script><script nonce="EjgdwqwhM2zYuwqrvf7DR3rGsiV0tO03ydmpb05xM3JTYBFn" src="/static/v20211025.1/js/jquery/plugins/contextMenu/contextMenu-min.js"></script><script nonce="EjgdwqwhM2zYuwqrvf7DR3rGsiV0tO03ydmpb05xM3JTYBFn" src="/static/v20211025.1/js/jquery/plugins/devbridgeAutocomplete/devbridgeAutocomplete-min.js"></script><script nonce="EjgdwqwhM2zYuwqrvf7DR3rGsiV0tO03ydmpb05xM3JTYBFn" src="/static/v20211025.1/js/global.js"></script><script nonce="EjgdwqwhM2zYuwqrvf7DR3rGsiV0tO03ydmpb05xM3JTYBFn" src="/static/v20211025.1/js/util.js"></script><script nonce="EjgdwqwhM2zYuwqrvf7DR3rGsiV0tO03ydmpb05xM3JTYBFn" src="/static/v20211025.1/js/dropdown.js"></script>

      <script nonce="EjgdwqwhM2zYuwqrvf7DR3rGsiV0tO03ydmpb05xM3JTYBFn">
          YAHOO.namespace('bugzilla');
          if ( "onpagehide" in window || YAHOO.env.ua.gecko) {
              YAHOO.util.Event._simpleRemove(window, "unload",
                                             YAHOO.util.Event._unload);
          }BUGZILLA.value_descs = JSON.parse('{\"bug_status\":{},\"resolution\":{\"\":\"---\"}}');

  
    var tracking_flags_str = "{\"flags\":{\"tracking\":{\"cf_tracking_firefox43\":\"+\",\"cf_status_firefox_esr38\":\"fixed\",\"cf_tracking_firefox41\":\"+\",\"cf_status_firefox42\":\"fixed\",\"cf_status_firefox41\":\"wontfix\",\"cf_status_firefox94\":\"---\",\"cf_tracking_thunderbird_esr78\":\"---\",\"cf_status_firefox_esr91\":\"---\",\"cf_status_firefox39\":\"wontfix\",\"cf_tracking_firefox93\":\"---\",\"cf_tracking_firefox95\":\"---\",\"cf_tracking_firefox42\":\"+\",\"cf_tracking_thunderbird_esr91\":\"---\",\"cf_status_firefox93\":\"---\",\"cf_status_thunderbird_esr78\":\"---\",\"cf_status_thunderbird_esr91\":\"---\",\"cf_tracking_firefox_esr78\":\"---\",\"cf_status_firefox40\":\"wontfix\",\"cf_status_firefox_esr78\":\"---\",\"cf_tracking_firefox_esr91\":\"---\",\"cf_tracking_firefox_relnote\":\"---\",\"cf_status_firefox95\":\"---\",\"cf_tracking_firefox94\":\"---\",\"cf_status_firefox43\":\"fixed\"},\"project\":{\"cf_root_cause\":\"---\",\"cf_tracking_firefox_sumo\":\"---\",\"cf_fission_milestone\":\"---\",\"cf_a11y_review_project_flag\":\"---\",\"cf_webcompat_priority\":\"---\"}},\"types\":[\"tracking\"],\"comments\":{\"cf_tracking_firefox41\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_tracking_firefox_sumo\":{\"none-needed\":\"Release Note Request (optional, but appreciated)\\n[Why is this notable]:\\n[Affects Firefox for Android]:\\n[Suggested wording]:\\n[Links (documentation, blog post, etc)]:\"},\"cf_tracking_firefox43\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_tracking_firefox42\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_tracking_firefox_esr78\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_tracking_firefox_esr91\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_tracking_firefox_relnote\":{\"?\":\"Release Note Request (optional, but appreciated)\\n[Why is this notable]:\\n[Affects Firefox for Android]:\\n[Suggested wording]:\\n[Links (documentation, blog post, etc)]:\"},\"cf_tracking_firefox93\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_tracking_firefox95\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_tracking_firefox94\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_a11y_review_project_flag\":{\"requested\":\"Description:\\nPlease provide an explanation of the feature or change. Include a description of the user scenario in which it would be used and how the user would complete the task(s).\\nScreenshots and visual UI specs are welcome, but please include sufficient accompanying explanation so that blind members of the accessibility team are able to understand the feature\/change.\\n\\nHow do we test this?\\nIf there is an implementation to test, please provide instructions for testing it; e.g. setting preferences, other preparation, how to trigger the UI, etc.\\n\\nWhen will this ship?\\nTracking bug\/issue:\\nDesign documents (e.g. Product Requirements Document, UI spec):\\nEngineering lead:\\nProduct manager:\\n\\nThe accessibility team has developed the Mozilla Accessibility Release Guidelines which outline what is needed to make user interfaces accessible:\\nhttps:\/\/wiki.mozilla.org\/Accessibility\/Guidelines\\nPlease describe the accessibility guidelines you considered and what steps you\'ve taken to address them:\\n\\nDescribe any areas of concern to which you want the accessibility team to give special attention:\"}}}";
    var TrackingFlags = $.parseJSON(tracking_flags_str);

  

  
  BUGZILLA.bug_id = 1193038;
  BUGZILLA.bug_title = '1193038 - UAF in Telemetry::Accumulate(); code appears to not be thread-safe';
  BUGZILLA.bug_summary = 'UAF in Telemetry::Accumulate(); code appears to not be thread-safe';
  BUGZILLA.bug_url = 'https:\/\/bugzilla.mozilla.org\/show_bug.cgi?id=1193038';
  BUGZILLA.bug_keywords = 'crash, csectype-race, csectype-uaf, sec-high',
  BUGZILLA.user = {
    id: 0,
    login: '',
    is_insider: false,
    is_timetracker: false,
    can_tag: false,
    timezone: 'America\/Los_Angeles',
    settings: {
      quote_replies: 'quoted_reply',
      zoom_textareas: true,
      remember_collapsed: true,
      inline_attachments: true,
      autosize_comments: false
    }
  };

  BUGZILLA.bug_secure = false;
      </script>
<script nonce="EjgdwqwhM2zYuwqrvf7DR3rGsiV0tO03ydmpb05xM3JTYBFn" src="/static/v20211025.1/extensions/BugModal/web/autosize.min.js"></script><script nonce="EjgdwqwhM2zYuwqrvf7DR3rGsiV0tO03ydmpb05xM3JTYBFn" src="/static/v20211025.1/extensions/ProdCompSearch/web/js/prod_comp_search.js"></script><script nonce="EjgdwqwhM2zYuwqrvf7DR3rGsiV0tO03ydmpb05xM3JTYBFn" src="/static/v20211025.1/extensions/BugModal/web/bug_modal.js"></script><script nonce="EjgdwqwhM2zYuwqrvf7DR3rGsiV0tO03ydmpb05xM3JTYBFn" src="/static/v20211025.1/extensions/BugModal/web/comments.js"></script><script nonce="EjgdwqwhM2zYuwqrvf7DR3rGsiV0tO03ydmpb05xM3JTYBFn" src="/static/v20211025.1/extensions/ComponentWatching/web/js/overlay.js"></script><script nonce="EjgdwqwhM2zYuwqrvf7DR3rGsiV0tO03ydmpb05xM3JTYBFn" src="/static/v20211025.1/js/bugzilla-readable-status-min.js"></script><script nonce="EjgdwqwhM2zYuwqrvf7DR3rGsiV0tO03ydmpb05xM3JTYBFn" src="/static/v20211025.1/js/field.js"></script><script nonce="EjgdwqwhM2zYuwqrvf7DR3rGsiV0tO03ydmpb05xM3JTYBFn" src="/static/v20211025.1/js/comments.js"></script><script nonce="EjgdwqwhM2zYuwqrvf7DR3rGsiV0tO03ydmpb05xM3JTYBFn" src="/static/v20211025.1/extensions/TrackingFlags/web/js/flags.js"></script><script nonce="EjgdwqwhM2zYuwqrvf7DR3rGsiV0tO03ydmpb05xM3JTYBFn" src="/static/v20211025.1/extensions/BMO/web/js/firefox-crash-table.js"></script><script nonce="EjgdwqwhM2zYuwqrvf7DR3rGsiV0tO03ydmpb05xM3JTYBFn" src="/static/v20211025.1/extensions/MozChangeField/web/js/severity-s1-priority-p1.js"></script><script nonce="EjgdwqwhM2zYuwqrvf7DR3rGsiV0tO03ydmpb05xM3JTYBFn" src="/static/v20211025.1/extensions/MozChangeField/web/js/clear-tracking-priority-s1.js"></script><script nonce="EjgdwqwhM2zYuwqrvf7DR3rGsiV0tO03ydmpb05xM3JTYBFn" src="/static/v20211025.1/extensions/MozChangeField/web/js/set-tracking-severity-s1.js"></script><script nonce="EjgdwqwhM2zYuwqrvf7DR3rGsiV0tO03ydmpb05xM3JTYBFn" src="/static/v20211025.1/js/lib/prism.js"></script><script nonce="EjgdwqwhM2zYuwqrvf7DR3rGsiV0tO03ydmpb05xM3JTYBFn" src="/static/v20211025.1/extensions/GoogleAnalytics/web/js/analytics.js"></script><script nonce="EjgdwqwhM2zYuwqrvf7DR3rGsiV0tO03ydmpb05xM3JTYBFn" src="/static/v20211025.1/js/lib/md5.min.js"></script><script nonce="EjgdwqwhM2zYuwqrvf7DR3rGsiV0tO03ydmpb05xM3JTYBFn" src="/static/v20211025.1/extensions/Review/web/js/badge.js"></script>

    

    
    <link rel="search" type="application/opensearchdescription+xml"
                       title="Bugzilla@Mozilla" href="/search_plugin.cgi"><link rel="shortcut icon" href="/extensions/BMO/web/images/favicon.ico">
<link rel="canonical" href="https://bugzilla.mozilla.org/show_bug.cgi?id=1193038">
<link rel="shorturl" href="https://bugzilla.mozilla.org/1193038"><meta name="google-analytics" content="UA-36116321-3" data-location="https://bugzilla.mozilla.org/bug/show-modal" data-title="1193038 - UAF in Telemetry::Accumulate(); code appears to not be thread-safe">
<script async src="https://www.google-analytics.com/analytics.js"></script><meta name="robots" content="noarchive">
  </head>



  <body
        class="bugzilla-mozilla-org
               skin-standard bug_modal yui-skin-sam">



<div id="wrapper">

<header id="header" role="banner">
  <div class="inner">
    <h1 id="header-title" class="title"><a href="https://bugzilla.mozilla.org/home" title="Go to home page">Bugzilla</a></h1>
    <form role="search" id="header-search" class="quicksearch" action="/buglist.cgi" data-no-csrf>
      <section class="searchbox-outer dropdown" role="combobox" aria-expanded="false" aria-haspopup="listbox"
               aria-labelledby="header-search-label" aria-owns="header-search-dropdown">
        <h2 id="header-search-label">Quick Search</h2>
        <span class="icon" aria-hidden="true"></span>
        <input role="searchbox" id="quicksearch_top" class="dropdown-button" name="quicksearch" autocomplete="off"
               value="" placeholder="Search Bugs"
               title="Enter a bug number or some search terms" aria-controls="header-search-dropdown"
               aria-label="Quick Search"><div id="header-search-dropdown" class="dropdown-content right" role="listbox" style="display: none;">
  <div id="header-search-dropdown-wrapper">
  </div>
</div>
      </section>
    </form>
    <nav id="header-nav">
      <ul class="links">
        <li class="link-browse">
          <a href="/describecomponents.cgi" title="Browse bugs by component">
            <span class="icon" aria-hidden="true"></span>
            <span class="label">Browse</span>
          </a>
        </li>
        <li class="link-search">
          <a href="/query.cgi?format=advanced" title="Search bugs using various criteria">
            <span class="icon" aria-hidden="true"></span>
            <span class="label">Advanced Search</span>
          </a>
        </li>
      </ul>
      <div class="dropdown">
        <button type="button" id="header-tools-menu-button" class="dropdown-button minor" title="More tools…"
                aria-label="More tools…" aria-expanded="false" aria-haspopup="true" aria-controls="header-tools-menu">
          <span class="icon" aria-hidden="true"></span>
        </button>
        <ul class="dropdown-content left" id="header-tools-menu" role="menu" style="display:none;">
          <li role="presentation">
            <a href="/report.cgi" role="menuitem" tabindex="-1">Reports</a>
          </li>
            <li role="separator"></li>
            <li role="presentation">
              <a href="https://bmo.readthedocs.io/en/latest/" role="menuitem" tabindex="-1">Documentation</a>
            </li>
        </ul>
      </div>
    </nav>
      <ul id="header-login" class="links">
          <li id="moz_new_account_container_top"><a href="/createaccount.cgi">New Account</a></li><li id="mini_login_container_top">
  <a id="login_link_top" href="/index.cgi?GoAheadAndLogIn=1"
     class='show_mini_login_form' data-qs-suffix="_top">Log In</a>

  <div id="mini_login_top" class="mini-popup mini_login bz_default_hidden"><span id="github_mini_login_top" class="mini_login_top">
    <form method="post" action="/github.cgi">
      <input type="hidden" name="github_secret" value="RLv02fGT8gRbxV9pROB1xGz8GpmFJC8iSqEiGaPgS6OFPZ6Ptz4Wz0SNjxtyI4tXZzATBO9wuTDIPjW349WM1Hfu4MDK5WfuzL6PrtVuwfhPKOKA7tsWMhukGCHoKRiDfAG59XDNLUMkvPfDqGp1I2b2ZBVAz4c77MDGWsQW2ZkMI60eeSi0q5oJDGeHdDhW5EG9T0CvyWjuzmrFyLdSrfqHFY1JYENman4VdijK0Z46stXi2v99o4h9Es1mPXV8">
      <input type="hidden" name="target_uri" value="https://bugzilla.mozilla.org/show_bug.cgi">
      <input type="image" src="/extensions/GitHubAuth/web/images/sign_in.png" height="22" width="75" align="absmiddle"
             alt="Sign in with GitHub"
             title="Sign in with GitHub"> or
    </form>
  </span>

  <form action="/show_bug.cgi?id=1193038" method="POST"
        data-qs-suffix="_top">

    <input id="Bugzilla_login_top"
           class="bz_login"
           name="Bugzilla_login"
           title="Login"
           placeholder="Email"
           aria-label="Email"
           type="email"
           required
    >
    <input class="bz_password"
           id="Bugzilla_password_top"
           name="Bugzilla_password"
           type="password"
           title="Password"
           placeholder="Password"
           aria-label="Password"
           required
    >
    <input class="bz_password bz_default_hidden bz_mini_login_help" type="text"
           id="Bugzilla_password_dummy_top" value="password"
           title="Password"
    >
      <input type="checkbox" id="Bugzilla_remember_top"
             name="Bugzilla_remember" value="on" class="bz_remember"
                 checked>
      <label for="Bugzilla_remember_top">Remember</label>
    <input type="hidden" name="Bugzilla_login_token"
           value="">
    <input type="submit" name="GoAheadAndLogIn" value="Log in"
           class="check_mini_login_fields"
            id="log_in_top">
    <a href="#" id="hide_mini_login_top" aria-label="Close"
       class="close-button hide_mini_login_form" data-qs-suffix="_top">
      <span class="icon" aria-hidden="true"></span>
    </a>
  </form>
  </div>
</li>
<li id="forgot_container_top">
  <a id="forgot_link_top" href="/index.cgi?GoAheadAndLogIn=1#forgot"
     class='show_forgot_form'
     data-qs-suffix="_top">Forgot Password</a>
  <div id="forgot_form_top" class="mini-popup mini_forgot bz_default_hidden">
  <form action="/token.cgi" method="post">
    <input type="email" name="loginname" size="20" placeholder="Email" aria-label="Email" required>
    <input id="forgot_button_top" value="Reset Password"
           type="submit">
    <input type="hidden" name="a" value="reqpw">
    <input type="hidden" id="token_top" name="token" value="1635622737-KVaQv12ZQZHGittwDGDh9KEFc9QbEwFMPeIB0nd1-ho">
    <a href="#" class="close-button hide_forgot_form" aria-label="Close" data-qs-suffix="_top">
      <span class="icon" aria-hidden="true"></span>
    </a>
  </form>
  </div>
</li>
      </ul><div id="header-external-links" class="dropdown first">
  <button type="button" id="header-external-menu-button" class="dropdown-button minor" title="Mozilla"
          aria-label="Mozilla" aria-expanded="false" aria-haspopup="true" aria-controls="header-external-menu">
    <img src="/static/v20211025.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg" width="32" height="32" alt="">
  </button>
  <ul class="dropdown-content right" id="header-external-menu" role="menu" style="display:none;">
    <li role="presentation">
      <a href="https://www.mozilla.org/" role="menuitem" tabindex="-1">Mozilla Home</a>
    </li>
    <li role="separator"></li>
    <li role="presentation">
      <a href="https://www.mozilla.org/privacy/websites/" role="menuitem" tabindex="-1">Privacy</a>
    </li>
    <li role="presentation">
      <a href="https://www.mozilla.org/privacy/websites/#cookies" role="menuitem" tabindex="-1">Cookies</a>
    </li>
    <li role="presentation">
      <a href="https://www.mozilla.org/about/legal/" role="menuitem" tabindex="-1">Legal</a>
    </li>
  </ul>
</div>
  </div>
</header> 


<main id="bugzilla-body" tabindex="-1">

<aside id="message-container" role="complementary">
  <noscript>
    <div class="noscript">
      <div class="inner">
        <p>Please enable JavaScript in your browser to use all the features on this site.</p>
      </div>
    </div>
  </noscript>
</aside>

<div id="main-inner">




<div role="toolbar" id="page-toolbar">
  <div role="group" class="buttons">
    <button type="button" id="copy-summary" class="secondary"
      title="Copy bug number and summary to your clipboard">Copy Summary</button>
    <div id="clip-container" style="display:none"><input type="text" id="clip"></div>
    <div class="dropdown">
      <button type="button" id="action-menu-btn" aria-haspopup="true" aria-label="View"
        aria-expanded="false" aria-controls="action-menu" class="dropdown-button secondary">View &#9662;</button>
      <ul class="dropdown-content left" id="action-menu" role="menu" style="display:none;">
        <li role="presentation">
          <a id="action-reset" role="menuitem" tabindex="-1">Reset Sections</a>
        </li>
        <li role="presentation">
          <a id="action-expand-all" role="menuitem" tabindex="-1">Expand All Sections</a>
        </li>
        <li role="presentation">
          <a id="action-collapse-all" role="menuitem" tabindex="-1">Collapse All Sections</a>
        </li>
        <li role="separator"></li>
        <li role="presentation">
          <a id="action-history" role="menuitem" tabindex="-1">History</a>
        </li>
        <li role="separator"></li>
        <li role="presentation">
          <a href="/rest/bug/1193038" role="menuitem" tabindex="-1">JSON</a>
        </li>
        <li role="presentation">
          <a href="/show_bug.cgi?ctype=xml&amp;id=1193038" role="menuitem" tabindex="-1">XML</a>
        </li>
      </ul>
    </div>
  </div>
</div>



<div role="status" id="io-error" style="display:none"></div>
<div role="status" id="floating-message" style="display:none">
  <div id="floating-message-text"></div>
</div>
<section class="module"
>
  <div class="module-content"
  >
  <div id="summary-container">
    <div class="field indent" id="field-status_summary"
>


  
    <div class=" container">
        <span id="field-value-status_summary">
      <span class="bug-status-label text" data-status="closed">Closed</span>
      <span id="field-value-bug_id">
        <a href="/show_bug.cgi?id=1193038">Bug 1193038</a>
      </span>
      <span>
        <span class="bug-time-label">Opened <span class="rel-time" title="2015-08-10 14:36 PDT" data-time="1439242606">6 years ago</span></span>
          <span class="bug-time-label">Closed <span class="rel-time" title="2015-09-14 17:19 PDT" data-time="1442276367">6 years ago</span></span>
      </span>
        </span>
    </div>

  
</div>
<div class="field indent edit-hide"
>


  
    <div class=" container">
      

      <h1 id="field-value-short_desc">UAF in Telemetry::Accumulate(); code appears to not be thread-safe</h1>
    </div>

  
</div>

    <div class="field edit-show" id="field-short_desc" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc" id="short_desc-help-link" class="help">Summary:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-short_desc">
            UAF in Telemetry::Accumulate(); code appears to not be thread-safe

        </span>
    </div>

  
</div>
  </div>
  </div>
</section>


<section class="module" id="module-categories"
>
    <header id="module-categories-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse Categories section"
           data-label-collapsed="Expand Categories section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-categories-content"
             aria-expanded="true"
             aria-labeledby="module-categories-title"
             aria-describedby="module-categories-subtitle"></div>
        <h2 class="module-title" id="module-categories-title">Categories</h2>
          <h3 class="module-subtitle" id="module-categories-subtitle">
            (Toolkit :: Telemetry, defect)
          </h3>
      </div>
    </header>
  <div class="module-content" id="module-categories-content"
  ><div class="fields-lhs">

    <div class="field" id="field-product"
>
    <div class="name">
        <a href="/describecomponents.cgi?product=Toolkit" id="product-help-link" class="help">Product:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-product">
      <div class="name-info-outer dropdown">
        <span id="product-name" class="dropdown-button" tabindex="0" role="button"
             aria-haspopup="menu" aria-controls="product-info">Toolkit
          <span class="icon" aria-hidden="true">&#x25BE;</span>
        </span>
        <aside id="product-info" class="name-info-popup dropdown-content right hover-display" hidden role="menu"
               aria-label="Product description and actions">
          <header>
            <div class="title">Toolkit</div>
            <div class="description">The Mozilla Toolkit is a set of APIs, built on top of Gecko, which provide advanced services to XUL applications. These services include Profile Management, Chrome Registration, Browsing History, Extension and Theme Management, Application Update Service, and Safe Mode. (<a href="https://wiki.mozilla.org/Modules/Toolkit">More info</a>)</div>
          </header>
          <li role="separator"></li>
          <div class="actions">
            <div><a href="/buglist.cgi?product=Toolkit&amp;bug_status=__open__"
                    target="_blank" role="menuitem" tabindex="-1">See Open Bugs in This Product</a></div>
            <div><a href="/enter_bug.cgi?product=Toolkit"
                    target="_blank" role="menuitem" tabindex="-1">File New Bug in This Product</a></div>
            <div><button disabled type="button" class="secondary component-watching" role="menuitem" tabindex="-1"
                         data-product="Toolkit"
                         data-label-watch="Watch This Product" data-label-unwatch="Unwatch This Product"
                         data-source="BugModal">Watch This Product</button></div>
          </div>
        </aside>
      </div>
        </span>
    </div>

  
</div>

    <div class="field" id="field-component"
>
    <div class="name">
        <a href="/describecomponents.cgi?product=Toolkit&component=Telemetry#Telemetry" id="component-help-link" class="help">Component:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-component">
      <div class="name-info-outer dropdown">
        <span id="component-name" class="dropdown-button" tabindex="0" role="button"
             aria-haspopup="menu" aria-controls="component-info">Telemetry
          <span class="icon" aria-hidden="true">&#x25BE;</span>
        </span>
        <aside id="component-info" class="name-info-popup dropdown-content right hover-display" hidden role="menu"
               aria-label="Component description and actions">
          <header>
            <div class="title">Toolkit :: Telemetry</div>
            <div class="description">Telemetry allows Engineering to receive aggregate data of browser health in the field.</div>
          </header>
          <li role="separator"></li>
          <div class="actions">
            <div><a href="/buglist.cgi?product=Toolkit&amp;component=Telemetry&amp;bug_status=__open__"
                    target="_blank" role="menuitem" tabindex="-1">See Open Bugs in This Component</a></div>
            <div><a href="/buglist.cgi?product=Toolkit&amp;component=Telemetry&amp;chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__"
                    target="_blank" role="menuitem" tabindex="-1">Recently Fixed Bugs in This Component</a></div>
            <div><a href="/enter_bug.cgi?product=Toolkit&amp;component=Telemetry"
                    target="_blank" role="menuitem" tabindex="-1">File New Bug in This Component</a></div>
            <div><button disabled type="button" class="secondary component-watching" role="menuitem" tabindex="-1"
                         data-product="Toolkit" data-component="Telemetry"
                         data-label-watch="Watch This Component" data-label-unwatch="Unwatch This Component"
                         data-source="BugModal">Watch This Component</button></div>
          </div>
        </aside>
      </div>
        </span>
    </div>

  
</div>

    <div class="field edit-show" id="field-version" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#version" id="version-help-link" class="help">Version:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-version">
            Trunk

        </span>
    </div>

  
</div>

    <div class="field edit-show" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform" id="-help-link" class="help">Platform:
        </a>
    </div>


  
    <div class=" container"><div class="field inline" id="field-rep_platform"
>


  
    <div class="value">
        <span id="field-value-rep_platform">
            Unspecified

        </span>
    </div>

  
</div><div class="field indent inline" id="field-op_sys"
>


  
    <div class="value">
        <span id="field-value-op_sys">
            Unspecified

        </span>
    </div>

  
</div><div class="field indent inline"
>


  
    <div class=" container">
    </div>

  
</div>
    </div>

  
</div>
</div><div class="fields-rhs">

    <div class="field contains-buttons" id="field-bug_type"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type" id="bug_type-help-link" class="help">Type:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-bug_type">
      <span class="bug-type-label iconic-text" data-type="defect">
        <span class="icon" aria-hidden="true"></span>defect</span>
        </span>
    </div>

  
</div>

    <div class="field" id="field-importance"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority" id="importance-help-link" class="help">Priority:
        </a>
    </div>


  
    <div class=" container">
        <span id="field-value-importance"><div class="field inline" id="field-priority"
>


  
    <div class="value">
        <span id="field-value-priority">
          <em>Not set</em>
        </span>
    </div>

  
</div><div class="field inline" id="field-bug_severity"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity" id="bug_severity-help-link" class="help">Severity:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-bug_severity">
            critical

        </span>
    </div>

  
</div>
        </span>
    </div>

  
</div>

    <div class="field edit-show" id="field-cf_fx_points" style="display:none"
>
    <div class="name">Points:
    </div>


  
    <div class="value">
        <span id="field-value-cf_fx_points">
            ---

        </span>
    </div>

  
</div>
</div>
  </div>
</section>


<section class="module" id="module-tracking"
>
    <header id="module-tracking-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse Tracking section"
           data-label-collapsed="Expand Tracking section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-tracking-content"
             aria-expanded="true"
             aria-labeledby="module-tracking-title"
             aria-describedby="module-tracking-subtitle"></div>
        <h2 class="module-title" id="module-tracking-title">Tracking</h2>
          <h3 class="module-subtitle" id="module-tracking-subtitle">
            (<span id="readable-bug-status" data-readable-bug-status="{&quot;cf_status_thunderbird_esr78&quot;:&quot;---&quot;,&quot;cf_status_thunderbird_esr91&quot;:&quot;---&quot;,&quot;cf_tracking_firefox_esr78&quot;:&quot;---&quot;,&quot;cf_tracking_firefox42&quot;:&quot;+&quot;,&quot;cf_tracking_thunderbird_esr91&quot;:&quot;---&quot;,&quot;target_milestone&quot;:&quot;mozilla43&quot;,&quot;keywords&quot;:[&quot;crash&quot;,&quot;csectype-race&quot;,&quot;csectype-uaf&quot;,&quot;sec-high&quot;],&quot;cf_root_cause&quot;:&quot;---&quot;,&quot;status&quot;:&quot;RESOLVED&quot;,&quot;cf_status_firefox93&quot;:&quot;---&quot;,&quot;cf_status_firefox95&quot;:&quot;---&quot;,&quot;cf_fission_milestone&quot;:&quot;---&quot;,&quot;dupe_of&quot;:null,&quot;cf_tracking_firefox94&quot;:&quot;---&quot;,&quot;cf_status_firefox43&quot;:&quot;fixed&quot;,&quot;cf_status_firefox40&quot;:&quot;wontfix&quot;,&quot;cf_status_firefox_esr78&quot;:&quot;---&quot;,&quot;cf_tracking_firefox_esr91&quot;:&quot;---&quot;,&quot;cf_tracking_firefox_relnote&quot;:&quot;---&quot;,&quot;priority&quot;:&quot;--&quot;,&quot;resolution&quot;:&quot;FIXED&quot;,&quot;cf_status_firefox42&quot;:&quot;fixed&quot;,&quot;cf_tracking_firefox43&quot;:&quot;+&quot;,&quot;cf_status_firefox_esr38&quot;:&quot;fixed&quot;,&quot;cf_webcompat_priority&quot;:&quot;---&quot;,&quot;cf_tracking_firefox_sumo&quot;:&quot;---&quot;,&quot;cf_tracking_firefox41&quot;:&quot;+&quot;,&quot;flags&quot;:[],&quot;cf_status_firefox39&quot;:&quot;wontfix&quot;,&quot;cf_a11y_review_project_flag&quot;:&quot;---&quot;,&quot;cf_tracking_firefox95&quot;:&quot;---&quot;,&quot;cf_tracking_firefox93&quot;:&quot;---&quot;,&quot;id&quot;:1193038,&quot;cf_status_firefox41&quot;:&quot;wontfix&quot;,&quot;cf_status_firefox94&quot;:&quot;---&quot;,&quot;cf_status_firefox_esr91&quot;:&quot;---&quot;,&quot;cf_tracking_thunderbird_esr78&quot;:&quot;---&quot;}"></span>)
          </h3>
      </div>
    </header>
  <div class="module-content" id="module-tracking-content"
  ><div class="fields-lhs">

    <div class="field edit-hide" id="field-status-view"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugStatuses" id="status-view-help-link" class="help">Status:
        </a>
    </div>


  
    <div class=" container">
        <span id="field-value-status-view">RESOLVED
        FIXED
        </span>
    </div>

  
</div>

    <div class="field edit-show" id="field-status-edit" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugStatuses" id="status-edit-help-link" class="help">Status:
        </a>
    </div>


  
    <div class=" container">
        <span id="field-value-status-edit"><div class="field inline" id="field-bug_status"
>


  
    <div class="value">
        <span id="field-value-bug_status">
            RESOLVED

        </span>
    </div>

  
</div><div class="field indent inline" id="field-resolution"
>


  
    <div class="value">
        <span id="field-value-resolution">
            FIXED

        </span>
    </div>

  
</div>
  <div id="status-action-buttons">
      <div id="assigned-container" style="display:none">
        <button type="button" class="secondary" id="mark-as-assigned-btn">
          Mark as Assigned
        </button>
      </div>
  </div>
        </span>
    </div>

  
</div>

    <div class="field" id="field-target_milestone"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone" id="target_milestone-help-link" class="help">Milestone:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-target_milestone">
            mozilla43

        </span>
    </div>

  
</div>

    <div class="field edit-show" id="field-cf_fx_iteration" style="display:none"
>
    <div class="name">Iteration:
    </div>


  
    <div class="value">
        <span id="field-value-cf_fx_iteration">
            ---

        </span>
    </div>

  
</div>


      <div class="field edit-show" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags" id="-help-link" class="help">Project Flags:
        </a>
    </div>


  
    <div class=" container"><div class="flags edit-show" style="display:none">
  <table class="layout-table tracking-flags">
      <tr>
        <td class="tracking-flag-name">a11y-review</td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_a11y_review_project_flag-dirty">
  <select id="cf_a11y_review_project_flag" name="cf_a11y_review_project_flag">
        <option value="---"
          id="v4876_cf_a11y_review_project_flag" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">Webcompat Priority</td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_webcompat_priority-dirty">
  <select id="cf_webcompat_priority" name="cf_webcompat_priority">
        <option value="---"
          id="v4274_cf_webcompat_priority" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">Root Cause</td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_root_cause-dirty">
  <select id="cf_root_cause" name="cf_root_cause">
        <option value="---"
          id="v4701_cf_root_cause" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">user-doc-firefox</td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_tracking_firefox_sumo-dirty">
  <select id="cf_tracking_firefox_sumo" name="cf_tracking_firefox_sumo">
        <option value="---"
          id="v4660_cf_tracking_firefox_sumo" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">Fission Milestone</td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_fission_milestone-dirty">
  <select id="cf_fission_milestone" name="cf_fission_milestone">
        <option value="---"
          id="v4222_cf_fission_milestone" selected
        >---
        </option>
  </select></td>
      </tr>
  </table>
</div>
    </div>

  
</div>
</div><div class="fields-rhs">

      <div class="field"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags" id="-help-link" class="help">Tracking Flags:
        </a>
    </div>


  
    <div class=" container"><div class="flags edit-hide">
    <table class="layout-table tracking-flags">
        <tr>
          <th></th>
          <th>Tracking</th>
          <th>Status</th>
        </tr>
        <tr>
          <td class="tracking-flag-name">firefox39</td>
            <td class="tracking-flag-tracking">---
            </td>
          <td class="tracking-flag-status">
              <a href="/buglist.cgi?f1=cf_status_firefox39&amp;o1=equals&amp;v1=wontfix">wontfix</a>
          </td>
        </tr>
        <tr>
          <td class="tracking-flag-name">firefox40</td>
            <td class="tracking-flag-tracking">---
            </td>
          <td class="tracking-flag-status">
              <a href="/buglist.cgi?f1=cf_status_firefox40&amp;o1=equals&amp;v1=wontfix">wontfix</a>
          </td>
        </tr>
        <tr>
          <td class="tracking-flag-name">firefox41</td>
            <td class="tracking-flag-tracking">
                <a href="/buglist.cgi?f1=cf_tracking_firefox41&amp;o1=equals&amp;v1=%2B">+</a>
            </td>
          <td class="tracking-flag-status">
              <a href="/buglist.cgi?f1=cf_status_firefox41&amp;o1=equals&amp;v1=wontfix">wontfix</a>
          </td>
        </tr>
        <tr>
          <td class="tracking-flag-name">firefox42</td>
            <td class="tracking-flag-tracking">
                <a href="/buglist.cgi?f1=cf_tracking_firefox42&amp;o1=equals&amp;v1=%2B">+</a>
            </td>
          <td class="tracking-flag-status">
              <a href="/buglist.cgi?f1=cf_status_firefox42&amp;o1=equals&amp;v1=fixed">fixed</a>
          </td>
        </tr>
        <tr>
          <td class="tracking-flag-name">firefox43</td>
            <td class="tracking-flag-tracking">
                <a href="/buglist.cgi?f1=cf_tracking_firefox43&amp;o1=equals&amp;v1=%2B">+</a>
            </td>
          <td class="tracking-flag-status">
              <a href="/buglist.cgi?f1=cf_status_firefox43&amp;o1=equals&amp;v1=fixed">fixed</a>
          </td>
        </tr>
        <tr>
          <td class="tracking-flag-name">firefox-esr38</td>
            <td class="tracking-flag-tracking">---
            </td>
          <td class="tracking-flag-status">
              <a href="/buglist.cgi?f1=cf_status_firefox_esr38&amp;o1=equals&amp;v1=fixed">fixed</a>
          </td>
        </tr>
    </table>
  </div>


<div class="flags edit-show" style="display:none">
  <table class="layout-table tracking-flags">
      <tr>
        <th></th>
        <th>Tracking</th>
        <th>Status</th>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox39</td>
          <td class="tracking-flag-tracking"></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox39-dirty">
  <select id="cf_status_firefox39" name="cf_status_firefox39">
        <option value="wontfix"
          id="v2164_cf_status_firefox39" selected
        >wontfix
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox40</td>
          <td class="tracking-flag-tracking"></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox40-dirty">
  <select id="cf_status_firefox40" name="cf_status_firefox40">
        <option value="wontfix"
          id="v2201_cf_status_firefox40" selected
        >wontfix
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox41</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox41-dirty">
  <select id="cf_tracking_firefox41" name="cf_tracking_firefox41">
        <option value="+"
          id="v2253_cf_tracking_firefox41" selected
        >+
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox41-dirty">
  <select id="cf_status_firefox41" name="cf_status_firefox41">
        <option value="wontfix"
          id="v2260_cf_status_firefox41" selected
        >wontfix
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox42</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox42-dirty">
  <select id="cf_tracking_firefox42" name="cf_tracking_firefox42">
        <option value="+"
          id="v2305_cf_tracking_firefox42" selected
        >+
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox42-dirty">
  <select id="cf_status_firefox42" name="cf_status_firefox42">
        <option value="fixed"
          id="v2311_cf_status_firefox42" selected
        >fixed
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox43</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox43-dirty">
  <select id="cf_tracking_firefox43" name="cf_tracking_firefox43">
        <option value="+"
          id="v2365_cf_tracking_firefox43" selected
        >+
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox43-dirty">
  <select id="cf_status_firefox43" name="cf_status_firefox43">
        <option value="fixed"
          id="v2371_cf_status_firefox43" selected
        >fixed
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox-esr38</td>
          <td class="tracking-flag-tracking"></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox_esr38-dirty">
  <select id="cf_status_firefox_esr38" name="cf_status_firefox_esr38">
        <option value="fixed"
          id="v2149_cf_status_firefox_esr38" selected
        >fixed
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">relnote-firefox</td>
          <td class="tracking-flag-tracking"></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_tracking_firefox_relnote-dirty">
  <select id="cf_tracking_firefox_relnote" name="cf_tracking_firefox_relnote">
        <option value="---"
          id="v539_cf_tracking_firefox_relnote" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">thunderbird_esr78</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_thunderbird_esr78-dirty">
  <select id="cf_tracking_thunderbird_esr78" name="cf_tracking_thunderbird_esr78">
        <option value="---"
          id="v4823_cf_tracking_thunderbird_esr78" selected
        >---
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_thunderbird_esr78-dirty">
  <select id="cf_status_thunderbird_esr78" name="cf_status_thunderbird_esr78">
        <option value="---"
          id="v4829_cf_status_thunderbird_esr78" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">thunderbird_esr91</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_thunderbird_esr91-dirty">
  <select id="cf_tracking_thunderbird_esr91" name="cf_tracking_thunderbird_esr91">
        <option value="---"
          id="v5236_cf_tracking_thunderbird_esr91" selected
        >---
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_thunderbird_esr91-dirty">
  <select id="cf_status_thunderbird_esr91" name="cf_status_thunderbird_esr91">
        <option value="---"
          id="v5242_cf_status_thunderbird_esr91" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox-esr78</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox_esr78-dirty">
  <select id="cf_tracking_firefox_esr78" name="cf_tracking_firefox_esr78">
        <option value="---"
          id="v4808_cf_tracking_firefox_esr78" selected
        >---
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox_esr78-dirty">
  <select id="cf_status_firefox_esr78" name="cf_status_firefox_esr78">
        <option value="---"
          id="v4813_cf_status_firefox_esr78" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox-esr91</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox_esr91-dirty">
  <select id="cf_tracking_firefox_esr91" name="cf_tracking_firefox_esr91">
        <option value="---"
          id="v5194_cf_tracking_firefox_esr91" selected
        >---
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox_esr91-dirty">
  <select id="cf_status_firefox_esr91" name="cf_status_firefox_esr91">
        <option value="---"
          id="v5199_cf_status_firefox_esr91" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox93</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox93-dirty">
  <select id="cf_tracking_firefox93" name="cf_tracking_firefox93">
        <option value="---"
          id="v5266_cf_tracking_firefox93" selected
        >---
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox93-dirty">
  <select id="cf_status_firefox93" name="cf_status_firefox93">
        <option value="---"
          id="v5271_cf_status_firefox93" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox94</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox94-dirty">
  <select id="cf_tracking_firefox94" name="cf_tracking_firefox94">
        <option value="---"
          id="v5284_cf_tracking_firefox94" selected
        >---
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox94-dirty">
  <select id="cf_status_firefox94" name="cf_status_firefox94">
        <option value="---"
          id="v5289_cf_status_firefox94" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox95</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox95-dirty">
  <select id="cf_tracking_firefox95" name="cf_tracking_firefox95">
        <option value="---"
          id="v5311_cf_tracking_firefox95" selected
        >---
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox95-dirty">
  <select id="cf_status_firefox95" name="cf_status_firefox95">
        <option value="---"
          id="v5316_cf_status_firefox95" selected
        >---
        </option>
  </select></td>
      </tr>
  </table>
</div>
    </div>

  
</div>

</div>
  </div>
</section>



<section class="module" id="module-people"
>
    <header id="module-people-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse People section"
           data-label-collapsed="Expand People section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-people-content"
             aria-expanded="false"
             aria-labeledby="module-people-title"
             aria-describedby="module-people-subtitle"></div>
        <h2 class="module-title" id="module-people-title">People</h2>
          <h3 class="module-subtitle" id="module-people-subtitle">
            (Reporter: jesup, Assigned: jesup)
          </h3>
      </div>
    </header>
  <div class="module-content" id="module-people-content" style="display:none"
  ><div class="fields-lhs">

    <div class="field edit-hide" id="field-assigned_to"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to" id="assigned_to-help-link" class="help">Assignee:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-assigned_to"><div class="vcard vcard_11539" ><img src="https://secure.gravatar.com/avatar/ae002109ba1cfbb7f5ad990cc5d9fbaf?d=mm&size=40" class="gravatar" width="20" height="20"> <a class="email " href="/user_profile?user_id=11539" > <span class="fna">jesup</span></a>
</div>
        </span>
    </div>

  
</div><div class="field edit-show" id="field-assigned_to" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to" id="assigned_to-help-link" class="help">Assignee:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-assigned_to">
      <div class="set-default-container" style="display:none">
        <input type="checkbox" id="set-default-assignee" name="set_default_assignee" class="set-default"
          value="1" data-for="assigned_to">
        <label for="set-default-assignee">Reset Assignee to default</label>
      </div>
        </span>
    </div>

  
</div>

    <div class="field edit-show" id="field-bug_mentors" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor" id="bug_mentors-help-link" class="help">Mentors:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-bug_mentors">---
        </span>
    </div>

  
</div>

    <div class="field edit-show" id="field-qa_contact" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact" id="qa_contact-help-link" class="help">QA Contact:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-qa_contact">
      <div class="set-default-container" style="display:none">
        <input type="checkbox" id="set-default-qa-contact" name="set_default_qa_contact" class="set-default"
          value="1" data-for="qa_contact">
        <label for="set-default-qa-contact">Reset QA Contact to default</label>
      </div>
        </span>
    </div>

  
</div>
</div><div class="fields-rhs">

    <div class="field" id="field-reporter"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter" id="reporter-help-link" class="help">Reporter:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-reporter">
            <div class="vcard vcard_11539" ><img src="https://secure.gravatar.com/avatar/ae002109ba1cfbb7f5ad990cc5d9fbaf?d=mm&size=40" class="gravatar" width="20" height="20"> <a class="email " href="/user_profile?user_id=11539" > <span class="fna">jesup</span></a>
</div>

        </span>
    </div>

  
</div>

    <div class="field" id="field-triage_owner"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner" id="triage_owner-help-link" class="help">Triage Owner:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-triage_owner">
            <div class="vcard vcard_553004" ><img src="https://secure.gravatar.com/avatar/5043f3d055047e33f78e537ded657aca?d=mm&size=40" class="gravatar" width="20" height="20"> <a class="email " href="/user_profile?user_id=553004" > <span class="fna">chutten|PTO</span></a>
</div>

        </span>
    </div>

  
</div>

    

    <div class="field"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc" id="-help-link" class="help">CC:
        </a>
    </div>


  
    <div class=" container">


        <span aria-owns="cc-summary cc-latch">
          <span role="button" tabindex="0" id="cc-summary" data-count="26">26 people
          </span>
        </span>


        <div id="cc-list" style="display:none"></div>
    </div>

  
</div>
</div>
  </div>
</section>


<section class="module" id="module-references"
>
    <header id="module-references-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse References section"
           data-label-collapsed="Expand References section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-references-content"
             aria-expanded="false"
             aria-labeledby="module-references-title"
             aria-describedby="module-references-subtitle"></div>
        <h2 class="module-title" id="module-references-title">References</h2>
      </div>
    </header>
  <div class="module-content" id="module-references-content" style="display:none"
  ><div class="fields-lhs">

    <div class="field bug-list edit-show" id="field-dependson" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson" id="dependson-help-link" class="help">Depends on:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-dependson">
        ---
        </span>
    </div>

  
</div><div class="field bug-list" id="field-blocked"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks" id="blocked-help-link" class="help">Blocks:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-blocked">
            <div class="bug-list">
        <span class="bug-type-label iconic" title="defect"
              aria-label="defect" data-type="defect">
          <span class="icon" aria-hidden="true"></span>
        </span><a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - nsHostResolver thread is still running late in shutdown"
   href="/show_bug.cgi?id=1196237">1196237</a>
      </div>

        </span>
    </div>

  
</div><div class="field" id="field-dependencytree"
>
    <div class="name">
    </div>


  
    <div class=" container">
        <span id="field-value-dependencytree">
        Dependency <a href="/showdependencytree.cgi?id=1193038&amp;hide_resolved=1">tree</a>
        / <a href="/showdependencygraph.cgi?id=1193038">graph</a>
        </span>
    </div>

  
</div>

    <div class="field bug-list edit-show" id="field-regresses" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses" id="regresses-help-link" class="help">Regressions:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-regresses">
        ---
        </span>
    </div>

  
</div><div class="field bug-list edit-show" id="field-regressed_by" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by" id="regressed_by-help-link" class="help">Regressed by:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-regressed_by">
        ---
        </span>
    </div>

  
</div>

    
</div><div class="fields-rhs">

    <div class="field edit-show" id="field-bug_file_loc" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc" id="bug_file_loc-help-link" class="help">URL:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-bug_file_loc"><div class="link">
    <a href="" target="_blank"
      rel="noreferrer" title=""
      class="bug-url" data-safe="0"></a>
  </div>
        </span>
    </div>

  
</div>

    <div class="field" id="field-see_also"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also" id="see_also-help-link" class="help">See Also:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-see_also">
            <div class="bug-list">
        <span class="bug-type-label iconic" title="defect"
              aria-label="defect" data-type="defect">
          <span class="icon" aria-hidden="true"></span>
        </span><a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED DUPLICATE - crash (on write, non-shutdown) in mozilla::Telemetry::Accumulate(mozilla::Telemetry::ID, unsigned int)"
   href="/show_bug.cgi?id=1197616">1197616</a>
      </div>

        </span>
    </div>

  
</div>
</div>
  </div>
</section>


<section class="module" id="module-details"
>
    <header id="module-details-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse Details section"
           data-label-collapsed="Expand Details section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-details-content"
             aria-expanded="false"
             aria-labeledby="module-details-title"
             aria-describedby="module-details-subtitle"></div>
        <h2 class="module-title" id="module-details-title">Details</h2>
          <h3 class="module-subtitle" id="module-details-subtitle">
            (4 keywords, Whiteboard: [post-critsmash-triage][adv-main42+][adv-esr38.4+])
          </h3>
      </div>
    </header>
  <div class="module-content" id="module-details-content" style="display:none"
  ><div class="fields-lhs">

    <div class="field edit-show" id="field-alias" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias" id="alias-help-link" class="help">Alias:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-alias">
        ---
        </span>
    </div>

  
</div>

    <div class="field" id="field-keywords"
>
    <div class="name">
        <a href="/describekeywords.cgi" id="keywords-help-link" class="help">Keywords:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-keywords">
          <a href="/buglist.cgi?keywords=crash&amp;resolution=---">crash</a>, 
          <a href="/buglist.cgi?keywords=csectype-race&amp;resolution=---">csectype-race</a>, 
          <a href="/buglist.cgi?keywords=csectype-uaf&amp;resolution=---">csectype-uaf</a>, 
          <a href="/buglist.cgi?keywords=sec-high&amp;resolution=---">sec-high</a>
        </span>
    </div>

  
</div>

    <div class="field" id="field-status_whiteboard"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/Whiteboard" id="status_whiteboard-help-link" class="help">Whiteboard:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-status_whiteboard">[post-critsmash-triage][adv-main42+][adv-esr38.4+]
        </span>
    </div>

  
</div><div class="field edit-show" id="field-cf_qa_whiteboard" style="display:none"
>
    <div class="name">QA Whiteboard:
    </div>


  
    <div class="value">
        <span id="field-value-cf_qa_whiteboard">
        ---
        </span>
    </div>

  
</div>

    

    <div class="field edit-show" id="field-cf_has_regression_range" style="display:none"
>
    <div class="name">Has Regression Range:
    </div>


  
    <div class="value">
        <span id="field-value-cf_has_regression_range">
            ---

        </span>
    </div>

  
</div><div class="field edit-show" id="field-cf_has_str" style="display:none"
>
    <div class="name">Has STR:
    </div>


  
    <div class="value">
        <span id="field-value-cf_has_str">
            ---

        </span>
    </div>

  
</div>

    <div class="field" id="field-votes"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes" id="votes-help-link" class="help">Votes:
        </a>
    </div>


  
    <div class=" container">
        <span id="field-value-votes">0
        </span>
    </div>

  
</div>
</div><div class="fields-rhs">

    <div class="field edit-show" id="field-bug_flags" style="display:none"
>
    <div class="name">Bug Flags:
    </div>


  
    <div class=" container">
        <span id="field-value-bug_flags"><div id="bug-flags" class="flags">
  <table class="layout-table">
    <tbody class="edit-show" style="display:none"><tr>
    <td class="flag-setter">
    </td>

    <td class="flag-name">
      <label title="Is this bug/feature enabled in a release by a pref flag (see https://github.com/mozilla/bug-handling/blob/master/policy/feature-flags.md)?" for="flag_type-930">behind-pref</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag_type-930-dirty">
      <select id="flag_type-930" name="flag_type-930"
        title="Is this bug/feature enabled in a release by a pref flag (see https://github.com/mozilla/bug-handling/blob/master/policy/feature-flags.md)?"
        class="bug-flag">
          <option value="X"></option>
            <option value="+" >+</option>
            <option value="-" >-</option>
      </select>
    </td>


  </tr><tr>
    <td class="flag-setter">
    </td>

    <td class="flag-name">
      <label title="Flag tracking inclusion in the desktop Firefox product backlog." for="flag_type-846">firefox-backlog</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag_type-846-dirty">
      <select id="flag_type-846" name="flag_type-846"
        title="Flag tracking inclusion in the desktop Firefox product backlog."
          disabled
        class="bug-flag">
          <option value="X"></option>
      </select>
    </td>


  </tr><tr>
    <td class="flag-setter">
    </td>

    <td class="flag-name">
      <label title="Flag is used to track security bug bounty nominations. Mail security(at)mozilla.org to nominate a bug." for="flag_type-803">sec-bounty</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag_type-803-dirty">
      <select id="flag_type-803" name="flag_type-803"
        title="Flag is used to track security bug bounty nominations. Mail security(at)mozilla.org to nominate a bug."
        class="bug-flag">
          <option value="X"></option>
            <option value="?" >?</option>
      </select>
    </td>


  </tr><tr>
    <td class="flag-setter">
    </td>

    <td class="flag-name">
      <label title="Flag is used to track whether the bug report is eligible for inclusion in the Bug Bounty Hall of Fame." for="flag_type-913">sec-bounty-hof</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag_type-913-dirty">
      <select id="flag_type-913" name="flag_type-913"
        title="Flag is used to track whether the bug report is eligible for inclusion in the Bug Bounty Hall of Fame."
          disabled
        class="bug-flag">
          <option value="X"></option>
      </select>
    </td>


  </tr><tr>
    <td class="flag-setter">
    </td>

    <td class="flag-name">
      <label title="Whether the bug has a testcase in the qa test suite or not. Set it to &quot;in-qa-testsuite?&quot; if the bug needs a testcase (only set this if the bug actually *needs* a testcase - not all bugs do, even layout bugs!), set it to &quot;in-qa-testsuite+&quot; if the bug has an appropriate testcase, and set it to &quot;in-qa-testsuite-&quot; if the bug doesn't need an explicit testcase (e.g. for code cleanup bugs). Only QA actively working on test cases in the component should use this keyword." for="flag_type-787">in-qa-testsuite</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag_type-787-dirty">
      <select id="flag_type-787" name="flag_type-787"
        title="Whether the bug has a testcase in the qa test suite or not. Set it to &quot;in-qa-testsuite?&quot; if the bug needs a testcase (only set this if the bug actually *needs* a testcase - not all bugs do, even layout bugs!), set it to &quot;in-qa-testsuite+&quot; if the bug has an appropriate testcase, and set it to &quot;in-qa-testsuite-&quot; if the bug doesn't need an explicit testcase (e.g. for code cleanup bugs). Only QA actively working on test cases in the component should use this keyword."
        class="bug-flag">
          <option value="X"></option>
            <option value="?" >?</option>
            <option value="+" >+</option>
            <option value="-" >-</option>
      </select>
    </td>

      <td class="flag-requestee">
        <div id="requestee_type-787-container" style="display:none"><input
    name="requestee_type-787"
    value="" class="requestee bz_autocomplete_user"  id="requestee_type-787" 
  >
        </div>
      <td>

  </tr><tr>
    <td class="flag-setter">
    </td>

    <td class="flag-name">
      <label title="Whether the bug has a testcase in the test suite or not. Set it to &quot;in-testsuite?&quot; if the bug needs a testcase (only set this if the bug actually *needs* a testcase - not all bugs do, even layout bugs!), set it to &quot;in-testsuite+&quot; if the bug has an appropriate testcase, and set it to &quot;in-testsuite-&quot; if the bug doesn't need an explicit testcase (e.g. for code cleanup bugs). Only QA actively working on test cases in the component should use this keyword." for="flag_type-37">in-testsuite</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag_type-37-dirty">
      <select id="flag_type-37" name="flag_type-37"
        title="Whether the bug has a testcase in the test suite or not. Set it to &quot;in-testsuite?&quot; if the bug needs a testcase (only set this if the bug actually *needs* a testcase - not all bugs do, even layout bugs!), set it to &quot;in-testsuite+&quot; if the bug has an appropriate testcase, and set it to &quot;in-testsuite-&quot; if the bug doesn't need an explicit testcase (e.g. for code cleanup bugs). Only QA actively working on test cases in the component should use this keyword."
        class="bug-flag">
          <option value="X"></option>
            <option value="?" >?</option>
            <option value="+" >+</option>
            <option value="-" >-</option>
      </select>
    </td>


  </tr><tr>
    <td class="flag-setter">
    </td>

    <td class="flag-name">
      <label title="qe-verify: ? ➜ request to assess whether the bug should be tested manually
qe-verify: + ➜ request to verify the bug manually
qe-verify: – ➜ the bug will not/can not be verified manually" for="flag_type-864">qe-verify</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag_type-864-dirty">
      <select id="flag_type-864" name="flag_type-864"
        title="qe-verify: ? ➜ request to assess whether the bug should be tested manually
qe-verify: + ➜ request to verify the bug manually
qe-verify: – ➜ the bug will not/can not be verified manually"
          disabled
        class="bug-flag">
          <option value="X"></option>
      </select>
    </td>


  </tr>
    </tbody>
  </table>
</div>
        </span>
    </div>

  
</div>
</div>

  
  </div>
</section>


<section class="module edit-show" style="display:none" id="module-crash-data"
>
    <header id="module-crash-data-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse Crash Data section"
           data-label-collapsed="Expand Crash Data section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-crash-data-content"
             aria-expanded="false"
             aria-labeledby="module-crash-data-title"
             aria-describedby="module-crash-data-subtitle"></div>
        <h2 class="module-title" id="module-crash-data-title">Crash Data</h2>
      </div>
    </header>
  <div class="module-content" id="module-crash-data-content" style="display:none"
  ><div class="field edit-show" id="field-cf_crash_signature" style="display:none"
>
    <div class="name">Signature:
    </div>


  
    <div class="value">
        <span id="field-value-cf_crash_signature">
        </span>
    </div>

  
</div>
  </div>
</section>


<section class="module edit-show" style="display:none" id="module-security"
>
    <header id="module-security-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse Security section"
           data-label-collapsed="Expand Security section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-security-content"
             aria-expanded="false"
             aria-labeledby="module-security-title"
             aria-describedby="module-security-subtitle"></div>
        <h2 class="module-title" id="module-security-title">Security</h2>
          <h3 class="module-subtitle" id="module-security-subtitle">
            (public)
          </h3>
      </div>
    </header>
  <div class="module-content" id="module-security-content" style="display:none"
  ><div class="groups edit-hide">
    This bug is publicly visible.
</div>

<div class="groups edit-show" style="display:none">


</div>
  </div>
</section>


<section class="module edit-show" style="display:none" id="module-user-story" data-non-stick="1"
>
    <header id="module-user-story-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse User Story section"
           data-label-collapsed="Expand User Story section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-user-story-content"
             aria-expanded="false"
             aria-labeledby="module-user-story-title"
             aria-describedby="module-user-story-subtitle"></div>
        <h2 class="module-title" id="module-user-story-title">User Story</h2>
      </div>
    </header>
  <div class="module-content" id="module-user-story-content" style="display:none"
  >
    <pre id="user-story"></pre>
  </div>
</section>







<section class="module" id="module-attachments"
>
    <header id="module-attachments-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse Attachments section"
           data-label-collapsed="Expand Attachments section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-attachments-content"
             aria-expanded="true"
             aria-labeledby="module-attachments-title"
             aria-describedby="module-attachments-subtitle"></div>
        <h2 class="module-title" id="module-attachments-title">Attachments</h2>
          <h3 class="module-subtitle" id="module-attachments-subtitle">
            (3 files, 3 obsolete files)
          </h3>
      </div>
    </header>
  <div class="module-content" id="module-attachments-content"
  ><table role="table" class="layout-table" id="attachments">
    <tr class=" attach-patch
    " >
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8656664">Move StatisticsRecorder cleanup after app relaunch</a>
        </div>
        <div>
            <a href="#c34" class="attach-time activity-ref"><span class="rel-time" title="2015-09-03 09:55 PDT" data-time="1441299355">6 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_439671" ><a class="email disabled" href="/user_profile?user_id=439671" > <span class="fna">Georg Fritzsche [:gfritzsche]</span></a>
</div></span>
        </div>
        <div class="attach-info">1.51 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_11539" ><span class="fn">jesup</span>
</div>:
              <a href="#c37"
                  class="flag-name-status rel-time-title activity-ref"
                  title="6 years ago"
              data-time="1441299355"
            >
              review+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8656664&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8656664&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1193038&attachment=8656664">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8659078">Purposely leak StatisticsReport object and suppress the leak report</a>
        </div>
        <div>
            <a href="#c42" class="attach-time activity-ref"><span class="rel-time" title="2015-09-10 00:08 PDT" data-time="1441868896">6 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_11539" ><a class="email " href="/user_profile?user_id=11539" > <span class="fna">Randell Jesup [:jesup] (needinfo me)</span></a>
</div></span>
        </div>
        <div class="attach-info">2.80 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_11539" ><span class="fn">jesup</span>
</div>:
              <a href="#c42"
                  class="flag-name-status rel-time-title activity-ref"
                  title="6 years ago"
              data-time="1441868896"
            >
              review+</a>
          </div>
          <div class="attach-flag"><div class="vcard vcard_406194" ><span class="fn">mccr8</span>
</div>:
              <a href="#a2654981_406194"
                  class="flag-name-status rel-time-title activity-ref"
                  title="6 years ago"
              data-time="1441869357"
            >
              review-</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8659078&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8659078&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1193038&attachment=8659078">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8659095">Purposely leak StatisticsReport object and suppress the leak report</a>
        </div>
        <div>
            <a href="#c45" class="attach-time activity-ref"><span class="rel-time" title="2015-09-10 00:52 PDT" data-time="1441871544">6 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_11539" ><a class="email " href="/user_profile?user_id=11539" > <span class="fna">Randell Jesup [:jesup] (needinfo me)</span></a>
</div></span>
        </div>
        <div class="attach-info">3.48 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_47192" ><span class="fn">glandium</span>
</div>:
              <a href="#c46"
                  class="flag-name-status rel-time-title activity-ref"
                  title="6 years ago"
              data-time="1441871544"
            >
              review+</a>
          </div>
          <div class="attach-flag"><div class="vcard vcard_406194" ><span class="fn">mccr8</span>
</div>:
              <a href="#a2654973_406194"
                  class="flag-name-status rel-time-title activity-ref"
                  title="6 years ago"
              data-time="1441871544"
            >
              review-</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8659095&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8659095&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1193038&attachment=8659095">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8659304">fooPurposely leak StatisticsReport object and suppress the leak report</a>
        </div>
        <div>
            <a href="#c48" class="attach-time activity-ref"><span class="rel-time" title="2015-09-10 08:33 PDT" data-time="1441899194">6 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_11539" ><a class="email " href="/user_profile?user_id=11539" > <span class="fna">Randell Jesup [:jesup] (needinfo me)</span></a>
</div></span>
        </div>
        <div class="attach-info">3.08 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_406194" ><span class="fn">mccr8</span>
</div>:
              <a href="#c49"
                  class="flag-name-status rel-time-title activity-ref"
                  title="6 years ago"
              data-time="1441899194"
            >
              review+</a>
          </div>
          <div class="attach-flag"><div class="vcard vcard_1689" ><span class="fn">dveditz</span>
</div>:
              <a href="#c51"
                  class="flag-name-status rel-time-title activity-ref"
                  title="6 years ago"
              data-time="1441903607"
            >
              approval-mozilla-aurora+</a>
          </div>
          <div class="attach-flag"><div class="vcard vcard_1689" ><span class="fn">dveditz</span>
</div>:
              <a href="#c51"
                  class="flag-name-status rel-time-title activity-ref"
                  title="6 years ago"
              data-time="1441903607"
            >
              sec-approval+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8659304&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8659304&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1193038&attachment=8659304">Splinter Review</a>
    </tr>
    <tr class=" attach-patch
    " >
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8660398">Suppress leak in valgrind as well</a>
        </div>
        <div>
            <a href="#c56" class="attach-time activity-ref"><span class="rel-time" title="2015-09-12 22:47 PDT" data-time="1442123239">6 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_11539" ><a class="email " href="/user_profile?user_id=11539" > <span class="fna">Randell Jesup [:jesup] (needinfo me)</span></a>
</div></span>
        </div>
        <div class="attach-info">967 bytes,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_334849" ><span class="fn">n.nethercote</span>
</div>:
              <a href="#a2962812_334849"
                  class="flag-name-status rel-time-title activity-ref"
                  title="6 years ago"
              data-time="1442205418"
            >
              review+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8660398&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8660398&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1193038&attachment=8660398">Splinter Review</a>
    </tr>
    <tr class=" attach-patch
    " >
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8660399">Purposely leak StatisticsReport object and suppress the leak report</a>
        </div>
        <div>
            <a href="#c57" class="attach-time activity-ref"><span class="rel-time" title="2015-09-12 22:49 PDT" data-time="1442123391">6 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_11539" ><a class="email " href="/user_profile?user_id=11539" > <span class="fna">Randell Jesup [:jesup] (needinfo me)</span></a>
</div></span>
        </div>
        <div class="attach-info">3.66 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_11539" ><span class="fn">jesup</span>
</div>:
              <a href="#c57"
                  class="flag-name-status rel-time-title activity-ref"
                  title="6 years ago"
              data-time="1442123391"
            >
              review+</a>
          </div>
          <div class="attach-flag"><div class="vcard vcard_495955" ><span class="fn">Sylvestre</span>
</div>:
              <a href="#c68"
                  class="flag-name-status rel-time-title activity-ref"
                  title="6 years ago"
              data-time="1443518671"
            >
              approval-mozilla-beta+</a>
          </div>
          <div class="attach-flag"><div class="vcard vcard_451704" ><span class="fn">lizzard</span>
</div>:
              <a href="#c72"
                  class="flag-name-status rel-time-title activity-ref"
                  title="6 years ago"
              data-time="1445675978"
            >
              approval-mozilla-esr38+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8660399&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8660399&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1193038&attachment=8660399">Splinter Review</a>
    </tr>
</table>

<footer id="attachments-footer">
  <div id="attachments-actions">
      <button type="button" id="attachments-obsolete-btn" class="secondary">Show Obsolete</button>
  </div>
  
</footer>
  </div>
</section>



<script nonce="EjgdwqwhM2zYuwqrvf7DR3rGsiV0tO03ydmpb05xM3JTYBFn">
  init_module_visibility();
</script>



<meta name="firefox-versions" content="{&quot;FIREFOX_AURORA&quot;:&quot;&quot;,&quot;FIREFOX_DEVEDITION&quot;:&quot;94.0b9&quot;,&quot;FIREFOX_ESR&quot;:&quot;78.15.0esr&quot;,&quot;FIREFOX_ESR_NEXT&quot;:&quot;91.2.0esr&quot;,&quot;FIREFOX_NIGHTLY&quot;:&quot;95.0a1&quot;,&quot;FIREFOX_PINEBUILD&quot;:&quot;&quot;,&quot;LAST_MERGE_DATE&quot;:&quot;2021-10-04&quot;,&quot;LAST_RELEASE_DATE&quot;:&quot;2021-10-05&quot;,&quot;LAST_SOFTFREEZE_DATE&quot;:&quot;2021-09-30&quot;,&quot;LATEST_FIREFOX_DEVEL_VERSION&quot;:&quot;94.0b9&quot;,&quot;LATEST_FIREFOX_OLDER_VERSION&quot;:&quot;3.6.28&quot;,&quot;LATEST_FIREFOX_RELEASED_DEVEL_VERSION&quot;:&quot;94.0b9&quot;,&quot;LATEST_FIREFOX_VERSION&quot;:&quot;93.0&quot;,&quot;NEXT_MERGE_DATE&quot;:&quot;2021-11-01&quot;,&quot;NEXT_RELEASE_DATE&quot;:&quot;2021-11-02&quot;,&quot;NEXT_SOFTFREEZE_DATE&quot;:&quot;2021-10-28&quot;}">


<div id="comment-actions">
    <button type="button" id="bottom-btn" class="secondary" aria-label="Go to Page Bottom">Bottom &darr;</button>
  <div class="dropdown">
    <button type="button" id="comment-tags-btn" aria-haspopup="true" aria-label="Tags"
      aria-expanded="false" aria-controls="comment-tags-menu" class="dropdown-button minor">Tags &#9662;</button>
    <ul id="comment-tags-menu" role="menu" tabindex="0" class="dropdown-content left" style="display:none">
      <li role="presentation">
        <a role="menuitem" tabindex="-1" data-comment-tag="">Reset</a>
      </li>
    </ul>
  </div>
  <div class="dropdown">
    <button type="button" id="view-menu-btn" aria-haspopup="true" aria-label="Timeline"
      aria-expanded="false" aria-controls="view-menu" class="dropdown-button minor">Timeline &#9662;</button>
    <ul id="view-menu" role="menu" tabindex="0" class="dropdown-content left" style="display:none">
      <li role="presentation">
        <a id="view-reset" role="menuitem" tabindex="-1">Reset</a>
      </li>
      <li role="separator"></li>
      <li role="presentation">
        <a id="view-collapse-all" role="menuitem" tabindex="-1">Collapse All</a>
      </li>
      <li role="presentation">
        <a id="view-expand-all" role="menuitem" tabindex="-1">Expand All</a>
      </li>
      <li role="presentation">
        <a id="view-comments-only" role="menuitem" tabindex="-1">Comments Only</a>
      </li>
    </ul>
   </div>
</div>
<div class="change-set" id="c0"><div class="comment" data-id="10600600" data-no="0"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-0" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_11539" ><img src="https://secure.gravatar.com/avatar/ae002109ba1cfbb7f5ad990cc5d9fbaf?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_11539" ><a class="email " href="/user_profile?user_id=11539" > <span class="fna">Randell Jesup [:jesup] (needinfo me)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-0"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-0" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c0">Description</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-08-10 14:36 PDT" data-time="1439242606">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-0">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-0" data-comment-id="10600600">Repeated crashes in the field with 0x5a signatures.  
Called from
Telemetry::Accumulate(Telemetry::DNS_FAILED_LOOKUP_TIME, millis);

<a rel="nofollow" href="https://crash-stats.mozilla.com/report/index/aabb2399-64d7-4ec7-a888-027b02150805">https://crash-stats.mozilla.com/report/index/aabb2399-64d7-4ec7-a888-027b02150805</a>

There is no obvious mention anywhere in the Telemetry code/includes about the thread-safety aspects; thus one should presume it's callable from any thread (and in this case is, from a DNS resolver thread, STS thread, etc).  However, I see no locking around access to shared telemetry structures, which presumably led to this set of crashes.  I would imagine it's also prone to TSAN issues.

The only good thing is that few of the crashes are on Release since most telemetry is disabled on Release (IIRC).  But not all....

Others include  Telemetry::Accumulate(Telemetry::STS_NUMBER_OF_ONSOCKETREADY_CALLS, numberOfOnSocketReadyCalls)
(<a rel="nofollow" href="https://crash-stats.mozilla.com/report/index/c77f5b7c-cc39-44d3-9664-030ff2150807">https://crash-stats.mozilla.com/report/index/c77f5b7c-cc39-44d3-9664-030ff2150807</a>)

More crashes, all ugly:
<a rel="nofollow" href="https://crash-stats.mozilla.com/report/list?product=Firefox&amp;signature=mozilla%3A%3ATelemetry%3A%3AAccumulate%28mozilla%3A%3ATelemetry%3A%3AID%2C+unsigned+int%29">https://crash-stats.mozilla.com/report/list?product=Firefox&amp;signature=mozilla%3A%3ATelemetry%3A%3AAccumulate%28mozilla%3A%3ATelemetry%3A%3AID%2C+unsigned+int%29</a></pre></div><div class="change-set" id="a26_11539"><div class="change" id="aa26_11539">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_11539" id="a26_11539"><img src="https://secure.gravatar.com/avatar/ae002109ba1cfbb7f5ad990cc5d9fbaf?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_11539" id="a26_11539"><a class="email " href="/user_profile?user_id=11539" > <span class="fna">Randell Jesup [:jesup] (needinfo me)</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a26_11539"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a26_11539">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#a26_11539">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-08-10 14:37 PDT" data-time="1439242632">6 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Component: Untriaged &rarr; Telemetry</div><div class="change">Product: Core &rarr; Toolkit</div></div></div><div class="change-set" id="c1"><div class="comment" data-id="10601310" data-no="1"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-1" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_417288" id="a26_11539"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_417288" id="a26_11539"><a class="email " href="/user_profile?user_id=417288" > <span class="fna">Nathan Froyd [:froydnj]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-1"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-1" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c1">Comment 1</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-08-10 17:36 PDT" data-time="1439253381">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-1">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-1" data-comment-id="10601310">Just to confirm: this sort of thing does show up in TSan, cf <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - TSan: data race ipc/chromium/src/base/histogram.cc:730 Accumulate"
   href="/show_bug.cgi?id=1141565">bug 1141565</a>.

That sounds like we're calling into Telemetry *really* late, though; histograms aren't freed until very very late in the shutdown process...or at least they didn't used to be...</pre></div><div class="change-set" id="c2"><div class="comment" data-id="10601505" data-no="2"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-2" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_11539" id="a26_11539"><img src="https://secure.gravatar.com/avatar/ae002109ba1cfbb7f5ad990cc5d9fbaf?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_11539" id="a26_11539"><a class="email " href="/user_profile?user_id=11539" > <span class="fna">Randell Jesup [:jesup] (needinfo me)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-2"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-2" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c2">Comment 2</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-08-10 18:53 PDT" data-time="1439257985">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-2">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-2" data-comment-id="10601505">(In reply to Nathan Froyd [:froydnj][:nfroyd] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - UAF in Telemetry::Accumulate(); code appears to not be thread-safe"
   href="/show_bug.cgi?id=1193038#c1">comment #1</a>)
<span class="quote">&gt; Just to confirm: this sort of thing does show up in TSan, cf <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - TSan: data race ipc/chromium/src/base/histogram.cc:730 Accumulate"
   href="/show_bug.cgi?id=1141565">bug 1141565</a>.
&gt; 
&gt; That sounds like we're calling into Telemetry *really* late, though;
&gt; histograms aren't freed until very very late in the shutdown process...or at
&gt; least they didn't used to be...</span >


The first one looks to be *early*, perhaps profilemanager?  thread 0 is in XRE_main() /LaunchChild()/WinLoanchChild()/CreasteProcessW()/CreateProcessInternalW()/NtCreateUserProcess().

The second one I link to is crashing in Add() to the array (and has &gt;70 active threads).

Most of the crashes (especially the 0x5a5a5a8e ones) are similar to the first - in LaunchChild(), with a smallish number of threads active, and short uptimes (6, 24, etc).  There are some others like the second (which had uptime = 15519)

Hmmmm I wonder if it *is* the switch to the real profile</pre></div><div class="change-set" id="c3"><div class="comment" data-id="10601513" data-no="3"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-3" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_11539" id="a26_11539"><img src="https://secure.gravatar.com/avatar/ae002109ba1cfbb7f5ad990cc5d9fbaf?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_11539" id="a26_11539"><a class="email " href="/user_profile?user_id=11539" > <span class="fna">Randell Jesup [:jesup] (needinfo me)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-3"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-3" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c3">Comment 3</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-08-10 18:56 PDT" data-time="1439258196">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-3">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-3" data-comment-id="10601513">Also, <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - crash in &#64;0x0 | mozilla::Telemetry::Accumulate(mozilla::Telemetry::ID, unsigned int)"
   href="/show_bug.cgi?id=1142079">bug 1142079</a> smells like wallpapering over a race like the Add() race (second example above).</pre></div><div class="change-set" id="c4"><div class="comment" data-id="10603187" data-no="4"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-4" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_439671" id="a26_11539"><img src="https://secure.gravatar.com/avatar/2a3dc7395cc192553d9a8c56fd6c358b?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_439671" id="a26_11539"><a class="email disabled" href="/user_profile?user_id=439671" > <span class="fna">Georg Fritzsche [:gfritzsche]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-4"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-4" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c4">Comment 4</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-08-11 06:06 PDT" data-time="1439298403">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-4">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-4" data-comment-id="10603187">(In reply to Randell Jesup [:jesup] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - UAF in Telemetry::Accumulate(); code appears to not be thread-safe"
   href="/show_bug.cgi?id=1193038#c0">comment #0</a>)
<span class="quote">&gt; The only good thing is that few of the crashes are on Release since most
&gt; telemetry is disabled on Release (IIRC).  But not all....</span >

Telemetry will default to enabled on release soon (41 or 42), but we will only record from a limited set of probes.</pre></div><div class="change-set" id="c5"><div class="comment" data-id="10603211" data-no="5"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-5" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_439671" id="a26_11539"><img src="https://secure.gravatar.com/avatar/2a3dc7395cc192553d9a8c56fd6c358b?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_439671" id="a26_11539"><a class="email disabled" href="/user_profile?user_id=439671" > <span class="fna">Georg Fritzsche [:gfritzsche]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-5"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-5" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c5">Comment 5</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-08-11 06:16 PDT" data-time="1439299018">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-5">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-5" data-comment-id="10603211">(In reply to Georg Fritzsche [:gfritzsche] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - UAF in Telemetry::Accumulate(); code appears to not be thread-safe"
   href="/show_bug.cgi?id=1193038#c4">comment #4</a>)
<span class="quote">&gt; (In reply to Randell Jesup [:jesup] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - UAF in Telemetry::Accumulate(); code appears to not be thread-safe"
   href="/show_bug.cgi?id=1193038#c0">comment #0</a>)
&gt; &gt; The only good thing is that few of the crashes are on Release since most
&gt; &gt; telemetry is disabled on Release (IIRC).  But not all....
&gt; 
&gt; Telemetry will default to enabled on release soon (41 or 42), but we will
&gt; only record from a limited set of probes.</span >

Meaning that default-on on release should be not - or much less - affected.

The breakdown for the uptime range here puts about half of the crashes in the first minute:
<a rel="nofollow" href="https://crash-stats.mozilla.com/report/list?product=Firefox&amp;range_unit=days&amp;range_value=28&amp;signature=mozilla%3A%3ATelemetry%3A%3AAccumulate%28mozilla%3A%3ATelemetry%3A%3AID%2C+unsigned+int%29">https://crash-stats.mozilla.com/report/list?product=Firefox&amp;range_unit=days&amp;range_value=28&amp;signature=mozilla%3A%3ATelemetry%3A%3AAccumulate%28mozilla%3A%3ATelemetry%3A%3AID%2C+unsigned+int%29</a>

Note that in absolute numbers per release, it is not ranking particularly high.</pre></div><div class="change-set" id="a62489_406194"><div class="change" id="aa62489_406194">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_406194" id="a62489_406194"><img src="https://secure.gravatar.com/avatar/0a70c84cd33dba0151fe15f2f8773137?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_406194" id="a62489_406194"><a class="email " href="/user_profile?user_id=406194" > <span class="fna">Andrew McCreight [:mccr8]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a62489_406194"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a62489_406194">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#a62489_406194">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-08-11 07:58 PDT" data-time="1439305095">6 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Keywords: <a href="/buglist.cgi?keywords=csectype-race&amp;resolution=---">csectype-race</a></div></div></div><div class="change-set" id="c6"><div class="comment" data-id="10605400" data-no="6"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-6" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_11539" id="a62489_406194"><img src="https://secure.gravatar.com/avatar/ae002109ba1cfbb7f5ad990cc5d9fbaf?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_11539" id="a62489_406194"><a class="email " href="/user_profile?user_id=11539" > <span class="fna">Randell Jesup [:jesup] (needinfo me)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-6"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-6" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c6">Comment 6</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-08-11 12:10 PDT" data-time="1439320239">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-6">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-6" data-comment-id="10605400">(In reply to Randell Jesup [:jesup] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - UAF in Telemetry::Accumulate(); code appears to not be thread-safe"
   href="/show_bug.cgi?id=1193038#c2">comment #2</a>)
<span class="quote">&gt; (In reply to Nathan Froyd [:froydnj][:nfroyd] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - UAF in Telemetry::Accumulate(); code appears to not be thread-safe"
   href="/show_bug.cgi?id=1193038#c1">comment #1</a>)
&gt; &gt; Just to confirm: this sort of thing does show up in TSan, cf <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - TSan: data race ipc/chromium/src/base/histogram.cc:730 Accumulate"
   href="/show_bug.cgi?id=1141565">bug 1141565</a>.
&gt; &gt; 
&gt; &gt; That sounds like we're calling into Telemetry *really* late, though;
&gt; &gt; histograms aren't freed until very very late in the shutdown process...or at
&gt; &gt; least they didn't used to be...
&gt; 
&gt; 
&gt; The first one looks to be *early*, perhaps profilemanager?  thread 0 is in
&gt; XRE_main()
&gt; /LaunchChild()/WinLoanchChild()/CreasteProcessW()/CreateProcessInternalW()/
&gt; NtCreateUserProcess().
&gt; 
&gt; The second one I link to is crashing in Add() to the array (and has &gt;70
&gt; active threads).
&gt; 
&gt; Most of the crashes (especially the 0x5a5a5a8e ones) are similar to the
&gt; first - in LaunchChild(), with a smallish number of threads active, and
&gt; short uptimes (6, 24, etc).  There are some others like the second (which
&gt; had uptime = 15519)
&gt; 
&gt; Hmmmm I wonder if it *is* the switch to the real profile</span >

The call sequence seen in at least half these (and most of the 0x5a's) is LaunchChild() called within &quot;if (appInitiatedRestart) {&quot;

So, this would correlate strongly with installing updates and restarting.

This gets set if XRE_mainRun() returns a &quot;please restart&quot; result, so at this point most or all threads should be shut down (and certainly all nsThreads).  Clearly, however, this is not the case.  We're launching a new child, but haven't exited yet, and in the meantime other threads may still be doing stuff.  And clearly a bunch of threads are still running.  Some are OS things (darn, can't see the thread names).  Some are not:

thread 11 was XPCJSRuntime.cpp in WatchdogMain() - and interestingly, it's in a Sleep() (really a CondVar wait) inside an if (!self-&gt;ShuttingDown).

Also the sandbox broker service, the toolkit nsTerminator (which may make sense).  There are ~19 threads though; most unclear what they are.

So at a minimum we'd want to either not clear out the telemetry array ever or block usage of it after it's freed (which likely would involve a lock/etc).  We also need to figure out why the DNS Host Resolver is still running in shutdown.  And the other crashes strongly imply the lack of locking here is causing Add() to fail due to (presumed) races and crash with randomish addresses (not 0x5a, but not null ptrs, and a number are EXEC crashes)

cc: mcmanus &amp; jduell because the HostResolver is part of the problem here.

(In reply to Georg Fritzsche [:gfritzsche] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - UAF in Telemetry::Accumulate(); code appears to not be thread-safe"
   href="/show_bug.cgi?id=1193038#c5">comment #5</a>)
<span class="quote">&gt; (In reply to Georg Fritzsche [:gfritzsche] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - UAF in Telemetry::Accumulate(); code appears to not be thread-safe"
   href="/show_bug.cgi?id=1193038#c4">comment #4</a>)
&gt; &gt; (In reply to Randell Jesup [:jesup] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - UAF in Telemetry::Accumulate(); code appears to not be thread-safe"
   href="/show_bug.cgi?id=1193038#c0">comment #0</a>)
&gt; &gt; &gt; The only good thing is that few of the crashes are on Release since most
&gt; &gt; &gt; telemetry is disabled on Release (IIRC).  But not all....
&gt; &gt; 
&gt; &gt; Telemetry will default to enabled on release soon (41 or 42), but we will
&gt; &gt; only record from a limited set of probes.
&gt; 
&gt; Meaning that default-on on release should be not - or much less - affected.</span >

Sure, but it'd be hard to be sure none of them can trigger the UAFs.  Also, as mentioned, some of these are EXEC crashes not-at-shutdown, which can be especially dangerous.

<span class="quote">&gt; The breakdown for the uptime range here puts about half of the crashes in
&gt; the first minute:
&gt; <a rel="nofollow" href="https://crash-stats.mozilla.com/report/">https://crash-stats.mozilla.com/report/</a>
&gt; list?product=Firefox&amp;range_unit=days&amp;range_value=28&amp;signature=mozilla%3A%3ATe
&gt; lemetry%3A%3AAccumulate%28mozilla%3A%3ATelemetry%3A%3AID%2C+unsigned+int%29
&gt; 
&gt; Note that in absolute numbers per release, it is not ranking particularly
&gt; high.</span >

Sure, but if made exploitable that doesn't matter (much).  The restart one would likely be very hard to exploit, though.  The other 1/2 are more worrying.</pre></div><div class="change-set" id="c7"><div class="comment" data-id="10620551" data-no="7"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-7" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_11539" id="a62489_406194"><img src="https://secure.gravatar.com/avatar/ae002109ba1cfbb7f5ad990cc5d9fbaf?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_11539" id="a62489_406194"><a class="email " href="/user_profile?user_id=11539" > <span class="fna">Randell Jesup [:jesup] (needinfo me)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-7"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-7" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c7">Comment 7</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-08-14 12:15 PDT" data-time="1439579756">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-7">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-7" data-comment-id="10620551">Who owns this code and can dig down (especially on the non-restart crashers)?  sec-crit that's going to be active in 41 or maybe 42...</pre><div class="activity"><div class="change">Flags: needinfo?(gfritzsche)</div></div></div><div class="change-set" id="c8"><div class="comment" data-id="10625478" data-no="8"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-8" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_439671" id="a62489_406194"><img src="https://secure.gravatar.com/avatar/2a3dc7395cc192553d9a8c56fd6c358b?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_439671" id="a62489_406194"><a class="email disabled" href="/user_profile?user_id=439671" > <span class="fna">Georg Fritzsche [:gfritzsche]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-8"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-8" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c8">Comment 8</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-08-17 08:29 PDT" data-time="1439825358">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-8">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-8" data-comment-id="10625478">(In reply to Randell Jesup [:jesup] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - UAF in Telemetry::Accumulate(); code appears to not be thread-safe"
   href="/show_bug.cgi?id=1193038#c2">comment #2</a>)
<span class="quote">&gt; (In reply to Nathan Froyd [:froydnj][:nfroyd] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - UAF in Telemetry::Accumulate(); code appears to not be thread-safe"
   href="/show_bug.cgi?id=1193038#c1">comment #1</a>)
&gt; &gt; Just to confirm: this sort of thing does show up in TSan, cf <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - TSan: data race ipc/chromium/src/base/histogram.cc:730 Accumulate"
   href="/show_bug.cgi?id=1141565">bug 1141565</a>.
&gt; &gt; 
&gt; &gt; That sounds like we're calling into Telemetry *really* late, though;
&gt; &gt; histograms aren't freed until very very late in the shutdown process...or at
&gt; &gt; least they didn't used to be...
&gt; 
&gt; 
&gt; The first one looks to be *early*, perhaps profilemanager?  thread 0 is in
&gt; XRE_main()
&gt; /LaunchChild()/WinLoanchChild()/CreasteProcessW()/CreateProcessInternalW()/
&gt; NtCreateUserProcess().
&gt; 
&gt; The second one I link to is crashing in Add() to the array (and has &gt;70
&gt; active threads).</span >

Can we narrow down where exactly? Somewhere in Histogram::Add()?

This would kill the StatisticsRecorder (which holds histograms) before the |if (appInitiatedRestart)| handling:
<a rel="nofollow" href="https://dxr.mozilla.org/mozilla-central/rev/0876695d1abdeb363a780bda8b6cc84f20ba51c9/toolkit/xre/nsAppRunner.cpp#4416">https://dxr.mozilla.org/mozilla-central/rev/0876695d1abdeb363a780bda8b6cc84f20ba51c9/toolkit/xre/nsAppRunner.cpp#4416</a>
<a rel="nofollow" href="https://dxr.mozilla.org/mozilla-central/rev/0876695d1abdeb363a780bda8b6cc84f20ba51c9/ipc/chromium/src/base/histogram.cc#1200">https://dxr.mozilla.org/mozilla-central/rev/0876695d1abdeb363a780bda8b6cc84f20ba51c9/ipc/chromium/src/base/histogram.cc#1200</a>

If we are not running into any leak detection issues, we should be fine with just leaving the StatisticsRecorder around (at least until we find out why other threads are still writing into it wildly).

Alternatively we could skip histogram writes after shutdown - we are not using the data anymore anyway.</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(gfritzsche)</span></div></div></div><div class="change-set" id="c9"><div class="comment" data-id="10625515" data-no="9"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-9" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_439671" id="a62489_406194"><img src="https://secure.gravatar.com/avatar/2a3dc7395cc192553d9a8c56fd6c358b?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_439671" id="a62489_406194"><a class="email disabled" href="/user_profile?user_id=439671" > <span class="fna">Georg Fritzsche [:gfritzsche]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-9"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-9" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c9">Comment 9</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-08-17 08:36 PDT" data-time="1439825774">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-9">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-9" data-comment-id="10625515">The StatisticsRecorder allocation doesn't explain the very early crash though, this location should be early enough and the StatisticsRecorder seems to handle calls before initialization ok:
<a rel="nofollow" href="https://dxr.mozilla.org/mozilla-central/rev/0876695d1abdeb363a780bda8b6cc84f20ba51c9/toolkit/xre/nsAppRunner.cpp#4350">https://dxr.mozilla.org/mozilla-central/rev/0876695d1abdeb363a780bda8b6cc84f20ba51c9/toolkit/xre/nsAppRunner.cpp#4350</a></pre></div><div class="change-set" id="c10"><div class="comment" data-id="10625732" data-no="10"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-10" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_11539" id="a62489_406194"><img src="https://secure.gravatar.com/avatar/ae002109ba1cfbb7f5ad990cc5d9fbaf?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_11539" id="a62489_406194"><a class="email " href="/user_profile?user_id=11539" > <span class="fna">Randell Jesup [:jesup] (needinfo me)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-10"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-10" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c10">Comment 10</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-08-17 09:17 PDT" data-time="1439828266">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-10">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-10" data-comment-id="10625732">(In reply to Georg Fritzsche [:gfritzsche] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - UAF in Telemetry::Accumulate(); code appears to not be thread-safe"
   href="/show_bug.cgi?id=1193038#c9">comment #9</a>)
<span class="quote">&gt; The StatisticsRecorder allocation doesn't explain the very early crash
&gt; though, this location should be early enough and the StatisticsRecorder
&gt; seems to handle calls before initialization ok:
&gt; <a rel="nofollow" href="https://dxr.mozilla.org/mozilla-central/rev/">https://dxr.mozilla.org/mozilla-central/rev/</a>
&gt; 0876695d1abdeb363a780bda8b6cc84f20ba51c9/toolkit/xre/nsAppRunner.cpp#4350</span >

Later analysis showed that the &quot;early&quot; crashes really are &quot;restart&quot; crashes, while trying to start the new process, and after shutting down/exiting XRE_main.  At least some of those are tied to threads still trying to log Telemetry *after* XRE_main has exited (i.e. thread leaks) - but it shows that the telemetry framework is vulnerable to stuff getting freed and used later.

The other group (non-restart) are more concerning, since the restart ones are likely *very* hard to attack.  But never say never...</pre></div><div class="change-set" id="c11"><div class="comment" data-id="10626483" data-no="11"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-11" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_439671" id="a62489_406194"><img src="https://secure.gravatar.com/avatar/2a3dc7395cc192553d9a8c56fd6c358b?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_439671" id="a62489_406194"><a class="email disabled" href="/user_profile?user_id=439671" > <span class="fna">Georg Fritzsche [:gfritzsche]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-11"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-11" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c11">Comment 11</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-08-17 11:40 PDT" data-time="1439836811">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-11">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-11" data-comment-id="10626483">These ones look like they may not be startup or shutdown related:
<a rel="nofollow" href="https://crash-stats.mozilla.com/report/index/586a840f-94a5-4699-b978-5214c2150816#allthreads">https://crash-stats.mozilla.com/report/index/586a840f-94a5-4699-b978-5214c2150816#allthreads</a>
<a rel="nofollow" href="https://crash-stats.mozilla.com/report/index/c3fed497-7244-4607-9115-0fd132150817#allthreads">https://crash-stats.mozilla.com/report/index/c3fed497-7244-4607-9115-0fd132150817#allthreads</a></pre></div><div class="change-set" id="c12"><div class="comment" data-id="10626507" data-no="12"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-12" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_439671" id="a62489_406194"><img src="https://secure.gravatar.com/avatar/2a3dc7395cc192553d9a8c56fd6c358b?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_439671" id="a62489_406194"><a class="email disabled" href="/user_profile?user_id=439671" > <span class="fna">Georg Fritzsche [:gfritzsche]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-12"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-12" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c12">Comment 12</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-08-17 11:46 PDT" data-time="1439837181">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-12">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-12" data-comment-id="10626507">(In reply to Georg Fritzsche [:gfritzsche] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - UAF in Telemetry::Accumulate(); code appears to not be thread-safe"
   href="/show_bug.cgi?id=1193038#c8">comment #8</a>)
<span class="quote">&gt; This would kill the StatisticsRecorder (which holds histograms) before the
&gt; |if (appInitiatedRestart)| handling:
&gt; <a rel="nofollow" href="https://dxr.mozilla.org/mozilla-central/rev/">https://dxr.mozilla.org/mozilla-central/rev/</a>
&gt; 0876695d1abdeb363a780bda8b6cc84f20ba51c9/toolkit/xre/nsAppRunner.cpp#4416
&gt; <a rel="nofollow" href="https://dxr.mozilla.org/mozilla-central/rev/">https://dxr.mozilla.org/mozilla-central/rev/</a>
&gt; 0876695d1abdeb363a780bda8b6cc84f20ba51c9/ipc/chromium/src/base/histogram.
&gt; cc#1200</span >

So those seem pretty clear.

I don't really see what the exact issue is with the other ones, e.g. <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - UAF in Telemetry::Accumulate(); code appears to not be thread-safe"
   href="/show_bug.cgi?id=1193038#c11">comment 11</a> - dmajor, do you have any tips/input on the issue here?</pre><div class="activity"><div class="change">Flags: needinfo?(dmajor)</div></div></div><div class="change-set" id="c13"><div class="comment" data-id="10626603" data-no="13"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-13" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_439671" id="a62489_406194"><img src="https://secure.gravatar.com/avatar/2a3dc7395cc192553d9a8c56fd6c358b?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_439671" id="a62489_406194"><a class="email disabled" href="/user_profile?user_id=439671" > <span class="fna">Georg Fritzsche [:gfritzsche]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-13"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-13" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c13">Comment 13</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-08-17 12:06 PDT" data-time="1439838366">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-13">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-13" data-comment-id="10626603">(In reply to Georg Fritzsche [:gfritzsche] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - UAF in Telemetry::Accumulate(); code appears to not be thread-safe"
   href="/show_bug.cgi?id=1193038#c12">comment #12</a>)
<span class="quote">&gt; (In reply to Georg Fritzsche [:gfritzsche] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - UAF in Telemetry::Accumulate(); code appears to not be thread-safe"
   href="/show_bug.cgi?id=1193038#c8">comment #8</a>)
&gt; &gt; This would kill the StatisticsRecorder (which holds histograms) before the
&gt; &gt; |if (appInitiatedRestart)| handling:
&gt; &gt; <a rel="nofollow" href="https://dxr.mozilla.org/mozilla-central/rev/">https://dxr.mozilla.org/mozilla-central/rev/</a>
&gt; &gt; 0876695d1abdeb363a780bda8b6cc84f20ba51c9/toolkit/xre/nsAppRunner.cpp#4416
&gt; &gt; <a rel="nofollow" href="https://dxr.mozilla.org/mozilla-central/rev/">https://dxr.mozilla.org/mozilla-central/rev/</a>
&gt; &gt; 0876695d1abdeb363a780bda8b6cc84f20ba51c9/ipc/chromium/src/base/histogram.
&gt; &gt; cc#1200
&gt; 
&gt; So those seem pretty clear.
&gt; 
&gt; I don't really see what the exact issue is with the other ones, e.g. comment
&gt; 11 - dmajor, do you have any tips/input on the issue here?</span >

E.g. i'm wondering:
* whether we can pinpoint more exactly what we are crashing on and
* whether we have something to reason that the others are during shutdown too</pre></div><div class="change-set" id="c14"><div class="comment" data-id="10627024" data-no="14"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-14" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_477892" id="a62489_406194"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_477892" id="a62489_406194"><a class="email " href="/user_profile?user_id=477892" > <span class="fna">(Away)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-14"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-14" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c14">Comment 14</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-08-17 13:29 PDT" data-time="1439843362">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-14">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-14" data-comment-id="10627024"><span class="quote">&gt; <a rel="nofollow" href="https://crash-stats.mozilla.com/report/index/586a840f-94a5-4699-b978-5214c2150816#allthreads">https://crash-stats.mozilla.com/report/index/586a840f-94a5-4699-b978-5214c2150816#allthreads</a></span >

There's nothing wrong with that one. (It was the other process that failed, and we just happened to be in Telemetry::Accumulate at the time that we snapshotted both processes.)

<span class="quote">&gt; <a rel="nofollow" href="https://crash-stats.mozilla.com/report/index/c3fed497-7244-4607-9115-0fd132150817#allthreads">https://crash-stats.mozilla.com/report/index/c3fed497-7244-4607-9115-0fd132150817#allthreads</a></span >

This one has a dead Histogram object. The crash happens when trying to access the vtable for the BucketIndex call inside Histogram::Add. 

The main thread is in LaunchChild. Perhaps the comment &quot;// Restart the app after XPCOM has been shut down cleanly.&quot; is relevant? Do we shut down telemetry as part of that? <a rel="nofollow" href="http://hg.mozilla.org/releases/mozilla-beta/annotate/cc69ace5aa5b/toolkit/xre/nsAppRunner.cpp#l4208">http://hg.mozilla.org/releases/mozilla-beta/annotate/cc69ace5aa5b/toolkit/xre/nsAppRunner.cpp#l4208</a></pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(dmajor)</span></div></div></div><div class="change-set" id="c15"><div class="comment" data-id="10627209" data-no="15"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-15" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_451704" id="a62489_406194"><img src="https://secure.gravatar.com/avatar/6168ea97fda0cefa449331e59b24e8f7?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_451704" id="a62489_406194"><a class="email " href="/user_profile?user_id=451704" > <span class="fna">Liz Henry (:lizzard Please n-i to RyanVM, jcristau, or pascal)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-15"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-15" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c15">Comment 15</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-08-17 14:13 PDT" data-time="1439846000">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-15">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-15" data-comment-id="10627209">Tracking for 41+;leaving 40 for Sylvestre to decide.</pre><div class="activity"><div class="change">
          <a href="/buglist.cgi?f1=cf_tracking_firefox40&amp;o1=isnotempty">tracking-firefox40</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_tracking_firefox40&amp;o1=equals&amp;v1=%3F">?</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_tracking_firefox41&amp;o1=isnotempty">tracking-firefox41</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_tracking_firefox41&amp;o1=equals&amp;v1=%2B">+</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_tracking_firefox42&amp;o1=isnotempty">tracking-firefox42</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_tracking_firefox42&amp;o1=equals&amp;v1=%2B">+</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_tracking_firefox43&amp;o1=isnotempty">tracking-firefox43</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_tracking_firefox43&amp;o1=equals&amp;v1=%2B">+</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_tracking_firefox_esr31&amp;o1=isnotempty">tracking-firefox-esr31</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_tracking_firefox_esr31&amp;o1=equals&amp;v1=%3F">?</a></div></div></div><div class="change-set" id="c16"><div class="comment" data-id="10630779" data-no="16"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-16" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_11539" id="a62489_406194"><img src="https://secure.gravatar.com/avatar/ae002109ba1cfbb7f5ad990cc5d9fbaf?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_11539" id="a62489_406194"><a class="email " href="/user_profile?user_id=11539" > <span class="fna">Randell Jesup [:jesup] (needinfo me)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-16"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-16" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c16">Comment 16</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-08-18 09:04 PDT" data-time="1439913874">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-16">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-16" data-comment-id="10630779">(In reply to David Major [:dmajor] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - UAF in Telemetry::Accumulate(); code appears to not be thread-safe"
   href="/show_bug.cgi?id=1193038#c14">comment #14</a>)
<span class="quote">&gt; &gt; <a rel="nofollow" href="https://crash-stats.mozilla.com/report/index/586a840f-94a5-4699-b978-5214c2150816#allthreads">https://crash-stats.mozilla.com/report/index/586a840f-94a5-4699-b978-5214c2150816#allthreads</a>
&gt; 
&gt; There's nothing wrong with that one. (It was the other process that failed,
&gt; and we just happened to be in Telemetry::Accumulate at the time that we
&gt; snapshotted both processes.)</span >

Is there a way to separate those out?  I'll note we have a bunch of crashes in this vsync code (perhaps it's hitting that code *a lot*.

<span class="quote">&gt; &gt; <a rel="nofollow" href="https://crash-stats.mozilla.com/report/index/c3fed497-7244-4607-9115-0fd132150817#allthreads">https://crash-stats.mozilla.com/report/index/c3fed497-7244-4607-9115-0fd132150817#allthreads</a>
&gt; 
&gt; This one has a dead Histogram object. The crash happens when trying to
&gt; access the vtable for the BucketIndex call inside Histogram::Add. 
&gt; 
&gt; The main thread is in LaunchChild. Perhaps the comment &quot;// Restart the app
&gt; after XPCOM has been shut down cleanly.&quot; is relevant? Do we shut down
&gt; telemetry as part of that?
&gt; <a rel="nofollow" href="http://hg.mozilla.org/releases/mozilla-beta/annotate/cc69ace5aa5b/toolkit/">http://hg.mozilla.org/releases/mozilla-beta/annotate/cc69ace5aa5b/toolkit/</a>
&gt; xre/nsAppRunner.cpp#l4208</span >

Yes; we've clearly found a case where update-and-restart can UAF (these are ~50% of the telemetry crashes).  This would be the StatisticsRecorder stuff mentioned above; however it also highlights we have some cases where threads (HostResolver for example) are escaping getting shut down properly (perhaps due to the 1-second sleep timers).

Others to check for validity:
<a rel="nofollow" href="https://crash-stats.mozilla.com/report/index/dcb8cc99-a601-4d61-81a9-0d72e2150815#allthreads">https://crash-stats.mozilla.com/report/index/dcb8cc99-a601-4d61-81a9-0d72e2150815#allthreads</a>
(<a rel="nofollow" href="https://crash-stats.mozilla.com/report/index/8723432f-f927-4e7d-9f4d-5a4d52150811">https://crash-stats.mozilla.com/report/index/8723432f-f927-4e7d-9f4d-5a4d52150811</a>)

<a rel="nofollow" href="https://crash-stats.mozilla.com/search/?signature=~Telemetry%3A%3A&amp;_facets=signature&amp;_columns=date&amp;_columns=signature&amp;_columns=product&amp;_columns=version&amp;_columns=build_id&amp;_columns=platform#facet-signature">https://crash-stats.mozilla.com/search/?signature=~Telemetry%3A%3A&amp;_facets=signature&amp;_columns=date&amp;_columns=signature&amp;_columns=product&amp;_columns=version&amp;_columns=build_id&amp;_columns=platform#facet-signature</a>
is a search for all that crashed in Telemetry::

/me wishes for a &quot;search crashstats for X in the crashing thread's backtrace&quot;</pre><div class="activity"><div class="change">Flags: needinfo?(dmajor)</div></div></div><div class="change-set" id="c17"><div class="comment" data-id="10631254" data-no="17"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-17" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_439671" id="a62489_406194"><img src="https://secure.gravatar.com/avatar/2a3dc7395cc192553d9a8c56fd6c358b?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_439671" id="a62489_406194"><a class="email disabled" href="/user_profile?user_id=439671" > <span class="fna">Georg Fritzsche [:gfritzsche]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-17"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-17" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c17">Comment 17</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-08-18 10:25 PDT" data-time="1439918743">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-17">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-17" data-comment-id="10631254">Try push to see if just leaking the StatisticsRecorder triggers anything on try:
<a rel="nofollow" href="https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=6ae61a71843c">https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=6ae61a71843c</a></pre></div><div class="change-set" id="c18"><div class="comment" data-id="10631467" data-no="18"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-18" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_439671" id="a62489_406194"><img src="https://secure.gravatar.com/avatar/2a3dc7395cc192553d9a8c56fd6c358b?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_439671" id="a62489_406194"><a class="email disabled" href="/user_profile?user_id=439671" > <span class="fna">Georg Fritzsche [:gfritzsche]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-18"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-18" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c18">Comment 18</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-08-18 11:00 PDT" data-time="1439920842">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-18">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-18" data-comment-id="10631467">(In reply to Randell Jesup [:jesup] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - UAF in Telemetry::Accumulate(); code appears to not be thread-safe"
   href="/show_bug.cgi?id=1193038#c16">comment #16</a>)
<span class="quote">&gt; Yes; we've clearly found a case where update-and-restart can UAF (these are
&gt; ~50% of the telemetry crashes).  This would be the StatisticsRecorder stuff
&gt; mentioned above; however it also highlights we have some cases where threads
&gt; (HostResolver for example) are escaping getting shut down properly (perhaps
&gt; due to the 1-second sleep timers).</span >

Do we actually have a defined time where those should be shutdown?
Should any of those still be active after XRE_mainRun() [0]?
If not we will just make those Telemetry crashes go away and they might still run into undefined behavior elsewhere.

0: <a rel="nofollow" href="https://dxr.mozilla.org/mozilla-central/rev/0876695d1abdeb363a780bda8b6cc84f20ba51c9/toolkit/xre/nsAppRunner.cpp#4389">https://dxr.mozilla.org/mozilla-central/rev/0876695d1abdeb363a780bda8b6cc84f20ba51c9/toolkit/xre/nsAppRunner.cpp#4389</a></pre></div><div class="change-set" id="c19"><div class="comment" data-id="10632480" data-no="19"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-19" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_11539" id="a62489_406194"><img src="https://secure.gravatar.com/avatar/ae002109ba1cfbb7f5ad990cc5d9fbaf?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_11539" id="a62489_406194"><a class="email " href="/user_profile?user_id=11539" > <span class="fna">Randell Jesup [:jesup] (needinfo me)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-19"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-19" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c19">Comment 19</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-08-18 14:21 PDT" data-time="1439932885">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-19">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-19" data-comment-id="10632480">(In reply to Georg Fritzsche [:gfritzsche] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - UAF in Telemetry::Accumulate(); code appears to not be thread-safe"
   href="/show_bug.cgi?id=1193038#c18">comment #18</a>)
<span class="quote">&gt; (In reply to Randell Jesup [:jesup] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - UAF in Telemetry::Accumulate(); code appears to not be thread-safe"
   href="/show_bug.cgi?id=1193038#c16">comment #16</a>)
&gt; &gt; Yes; we've clearly found a case where update-and-restart can UAF (these are
&gt; &gt; ~50% of the telemetry crashes).  This would be the StatisticsRecorder stuff
&gt; &gt; mentioned above; however it also highlights we have some cases where threads
&gt; &gt; (HostResolver for example) are escaping getting shut down properly (perhaps
&gt; &gt; due to the 1-second sleep timers).
&gt; 
&gt; Do we actually have a defined time where those should be shutdown?
&gt; Should any of those still be active after XRE_mainRun() [0]?
&gt; If not we will just make those Telemetry crashes go away and they might
&gt; still run into undefined behavior elsewhere.</span >

nsThreads should be all gone by end of xpcom-shutdown-threads, certainly before this.  I have a patch (unlanded) that asserts on leaked nsThreads I need to un-bitrot; bsmedberg wasn't ready to land it a while back, but we used it to flag a bunch of leaks and kill them.  <a class="bz_bug_link
          bz_status_ASSIGNED"
   title="ASSIGNED - Flag threads that aren't shut down before nsThreadManager::Shutdown()"
   href="/show_bug.cgi?id=988464">Bug 988464</a>; I have an un-birotted version (not on the bug right now) I'm going to push through another Try run.

pthreads can leak past there, but need to make sure that they shouldn't do anything...  especially when we return from main().  Best not to leak them either...  In the past there were webrtc pthread leaks that did periodic processing that would occasionally hit a null vtable entry during post-main atexit processing (just because a timer woke them up).</pre></div><div class="change-set" id="c20"><div class="comment" data-id="10632621" data-no="20"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-20" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_477892" id="a62489_406194"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_477892" id="a62489_406194"><a class="email " href="/user_profile?user_id=477892" > <span class="fna">(Away)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-20"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-20" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c20">Comment 20</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-08-18 14:49 PDT" data-time="1439934554">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-20">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-20" data-comment-id="10632621">(In reply to Randell Jesup [:jesup] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - UAF in Telemetry::Accumulate(); code appears to not be thread-safe"
   href="/show_bug.cgi?id=1193038#c16">comment #16</a>)
<span class="quote">&gt; (In reply to David Major [:dmajor] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - UAF in Telemetry::Accumulate(); code appears to not be thread-safe"
   href="/show_bug.cgi?id=1193038#c14">comment #14</a>)
&gt; &gt; &gt; <a rel="nofollow" href="https://crash-stats.mozilla.com/report/index/586a840f-94a5-4699-b978-5214c2150816#allthreads">https://crash-stats.mozilla.com/report/index/586a840f-94a5-4699-b978-5214c2150816#allthreads</a>
&gt; &gt; 
&gt; &gt; There's nothing wrong with that one. (It was the other process that failed,
&gt; &gt; and we just happened to be in Telemetry::Accumulate at the time that we
&gt; &gt; snapshotted both processes.)
&gt; 
&gt; Is there a way to separate those out?  I'll note we have a bunch of crashes
&gt; in this vsync code (perhaps it's hitting that code *a lot*.</span >

I guess you can ignore anything with an ipc_channel_error annotation. <a class="bz_bug_link
          bz_status_NEW"
   title="NEW - IPC channel errors should report the parent process's stack"
   href="/show_bug.cgi?id=1186092">Bug 1186092</a> may make things better eventually.</pre></div><div class="change-set" id="c21"><div class="comment" data-id="10632760" data-no="21"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-21" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_477892" id="a62489_406194"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_477892" id="a62489_406194"><a class="email " href="/user_profile?user_id=477892" > <span class="fna">(Away)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-21"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-21" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c21">Comment 21</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-08-18 15:28 PDT" data-time="1439936904">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-21">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-21" data-comment-id="10632760"><span class="quote">&gt; Others to check for validity:
&gt; <a rel="nofollow" href="https://crash-stats.mozilla.com/report/index/dcb8cc99-a601-4d61-81a9">https://crash-stats.mozilla.com/report/index/dcb8cc99-a601-4d61-81a9</a>-
&gt; 0d72e2150815#allthreads</span >
That one I don't understand; the registers in the minidump don't agree with the reported exception address.

I don't think looking at this across a bunch of different variations is going to give you anything actionable. It's entirely possible that there are random unrelated crashes mixed in. I'd say find a couple stacks that are most prominent and go after those.</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(dmajor)</span></div></div></div><div class="change-set" id="c22"><div class="comment" data-id="10632829" data-no="22"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-22" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_11539" id="a62489_406194"><img src="https://secure.gravatar.com/avatar/ae002109ba1cfbb7f5ad990cc5d9fbaf?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_11539" id="a62489_406194"><a class="email " href="/user_profile?user_id=11539" > <span class="fna">Randell Jesup [:jesup] (needinfo me)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-22"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-22" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c22">Comment 22</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-08-18 15:51 PDT" data-time="1439938284">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-22">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-22" data-comment-id="10632829">This one has no ipc_channel_error annotation, it's an illegal instruction, and no indication it's in shutdown:

<a rel="nofollow" href="https://crash-stats.mozilla.com/report/index/58ace115-56f3-4ebf-b8f2-3a4bb2150813#allthreads">https://crash-stats.mozilla.com/report/index/58ace115-56f3-4ebf-b8f2-3a4bb2150813#allthreads</a>

I do think some sort of fix for the statisticsrecorder issue is a big part of the answer here.  I have a try running for <a class="bz_bug_link
          bz_status_ASSIGNED"
   title="ASSIGNED - Flag threads that aren't shut down before nsThreadManager::Shutdown()"
   href="/show_bug.cgi?id=988464">bug 988464</a>, which may help with other aspects.  We should work to land some sort of fix for the primary crash here, and also probably address the HostResolver running-that-late issue (which can spin to a separate bug).

I do suspect from the set of crashes we see (such as the one above) that there are some more bugs here (as dmajor suggests), but if not, great.  I *do* want us to carefully document and vet the thread-safety aspects of this code!  If we don't (even if it's &quot;all safe&quot; today), we've left a grenade under the furniture that the next person to rearrange it will uncover.</pre></div><div class="change-set" id="c23"><div class="comment" data-id="10635054" data-no="23"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-23" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_439671" id="a62489_406194"><img src="https://secure.gravatar.com/avatar/2a3dc7395cc192553d9a8c56fd6c358b?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_439671" id="a62489_406194"><a class="email disabled" href="/user_profile?user_id=439671" > <span class="fna">Georg Fritzsche [:gfritzsche]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-23"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-23" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c23">Comment 23</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-08-19 06:04 PDT" data-time="1439989477">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-23">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-23" data-comment-id="10635054">So, the try push is fine, except some leaks that we can annotate/suppress.

However, the StatisticsRecorder had issues with crashes late in shutdown too per <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Intermittent WinXP mochitest PROCESS-CRASH | Main app process exited normally | application crashed [&#64; moz_abort] with base::StatisticsRecorder::~StatisticsRecorder() on the stack"
   href="/show_bug.cgi?id=1100501">bug 1100501</a>.
We need to avoid what <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Intermittent WinXP mochitest PROCESS-CRASH | Main app process exited normally | application crashed [&#64; moz_abort] with base::StatisticsRecorder::~StatisticsRecorder() on the stack"
   href="/show_bug.cgi?id=1100501#c135">bug 1100501, comment 135</a> describes.
To temporarily fix this issue (until the run-away threads are fixed), we'd need to find a point where those runaway threads should be done, but before jemalloc enters a shutdown state.

Alternatively public Telemetry accumulation functions should all be protected by checks on sTelemetry [0], but nulling that still leaves race potential.

0: <a rel="nofollow" href="https://dxr.mozilla.org/mozilla-central/rev/d5cf4e7900df6b2351bf3677b49fb70bedf68b99/toolkit/components/telemetry/Telemetry.cpp#744">https://dxr.mozilla.org/mozilla-central/rev/d5cf4e7900df6b2351bf3677b49fb70bedf68b99/toolkit/components/telemetry/Telemetry.cpp#744</a></pre></div><div class="change-set" id="a747636_439671"><div class="change" id="aa747636_439671">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_439671" id="a747636_439671"><img src="https://secure.gravatar.com/avatar/2a3dc7395cc192553d9a8c56fd6c358b?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_439671" id="a747636_439671"><a class="email disabled" href="/user_profile?user_id=439671" > <span class="fna">Georg Fritzsche [:gfritzsche]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a747636_439671"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a747636_439671">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#a747636_439671">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-08-19 06:17 PDT" data-time="1439990242">6 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Blocks: <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - nsHostResolver thread is still running late in shutdown"
   href="/show_bug.cgi?id=1196237">1196237</a></div></div></div><div class="change-set" id="c24"><div class="comment" data-id="10635080" data-no="24"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-24" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_439671" id="a747636_439671"><img src="https://secure.gravatar.com/avatar/2a3dc7395cc192553d9a8c56fd6c358b?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_439671" id="a747636_439671"><a class="email disabled" href="/user_profile?user_id=439671" > <span class="fna">Georg Fritzsche [:gfritzsche]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-24"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-24" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c24">Comment 24</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-08-19 06:18 PDT" data-time="1439990298">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-24">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-24" data-comment-id="10635080">(In reply to Randell Jesup [:jesup] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - UAF in Telemetry::Accumulate(); code appears to not be thread-safe"
   href="/show_bug.cgi?id=1193038#c22">comment #22</a>)
<span class="quote">&gt; and also probably address the HostResolver running-that-late
&gt; issue (which can spin to a separate bug).</span >

I filed <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - nsHostResolver thread is still running late in shutdown"
   href="/show_bug.cgi?id=1196237">bug 1196237</a> for the HostResolver.</pre></div><div class="change-set" id="a762661_452604"><div class="change" id="aa762661_452604">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_452604" id="a762661_452604"><img src="https://secure.gravatar.com/avatar/7bb698c4991c5af83adabe3c3b8ee8aa?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_452604" id="a762661_452604"><a class="email disabled" href="/user_profile?user_id=452604" > <span class="fna">Matt Wobensmith [:mwobensmith][:matt:]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a762661_452604"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a762661_452604">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#a762661_452604">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-08-19 10:27 PDT" data-time="1440005267">6 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox39&amp;o1=isnotempty">status-firefox39</a>:
          <a href="/buglist.cgi?f1=cf_status_firefox39&amp;o1=equals&amp;v1=affected">affected</a> &rarr; <a href="/buglist.cgi?f1=cf_status_firefox39&amp;o1=equals&amp;v1=wontfix">wontfix</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox40&amp;o1=isnotempty">status-firefox40</a>:
          <a href="/buglist.cgi?f1=cf_status_firefox40&amp;o1=equals&amp;v1=affected">affected</a> &rarr; <a href="/buglist.cgi?f1=cf_status_firefox40&amp;o1=equals&amp;v1=wontfix">wontfix</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_tracking_firefox40&amp;o1=isnotempty">tracking-firefox40</a>:
          <a href="/buglist.cgi?f1=cf_tracking_firefox40&amp;o1=equals&amp;v1=%3F">?</a> &rarr; ---</div></div></div><div class="change-set" id="c25"><div class="comment" data-id="10637543" data-no="25"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-25" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_423812" id="a762661_452604"><img src="https://secure.gravatar.com/avatar/4e89302ebf9ef099702b533596835f84?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_423812" id="a762661_452604"><a class="email " href="/user_profile?user_id=423812" > <span class="fna">Vladan Djeric (:vladan)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-25"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-25" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c25">Comment 25</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-08-19 15:20 PDT" data-time="1440022836">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-25">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-25" data-comment-id="10637543">Sorry guys, I'm late to this bug, my mail filters were hiding bugmail form this bug.
I agree we need to document and verify Telemetry threading behaviour. My team is really busy right now but I could document threading next week. Someone else will need to head up fixing the issues found so far, I'll help as much as I can.</pre></div><div class="change-set" id="c26"><div class="comment" data-id="10647301" data-no="26"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-26" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_1689" id="a762661_452604"><img src="https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_1689" id="a762661_452604"><a class="email " href="/user_profile?user_id=1689" > <span class="fna">Daniel Veditz [:dveditz]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-26"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-26" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c26">Comment 26</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-08-22 10:28 PDT" data-time="1440264519">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-26">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-26" data-comment-id="10647301">Lowering severity slightly because races at startup or shutdown--the majority of these--would be very hard to turn into a useful exploit. With e10s and workers and telemetry leaking into Release it's still quite plausible there's an exploit lurking.</pre><div class="activity"><div class="change">Keywords: <a href="/buglist.cgi?keywords=sec-critical&amp;resolution=---">sec-critical</a> &rarr; <a href="/buglist.cgi?keywords=sec-high&amp;resolution=---">sec-high</a></div></div></div><div class="change-set" id="c27"><div class="comment" data-id="10647314" data-no="27"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-27" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_1689" id="a762661_452604"><img src="https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_1689" id="a762661_452604"><a class="email " href="/user_profile?user_id=1689" > <span class="fna">Daniel Veditz [:dveditz]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-27"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-27" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c27">Comment 27</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-08-22 10:54 PDT" data-time="1440266098">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-27">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-27" data-comment-id="10647314">(In reply to Randell Jesup [:jesup] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - UAF in Telemetry::Accumulate(); code appears to not be thread-safe"
   href="/show_bug.cgi?id=1193038#c6">comment #6</a>)
<span class="quote">&gt; Sure, but it'd be hard to be sure none of them can trigger the UAFs.  Also,
&gt; as mentioned, some of these are EXEC crashes not-at-shutdown, which can be
&gt; especially dangerous.</span >

These appear to be the same crash. EXCEPTION_ACCESS_VIOLATION_READ at 0x5a5a5a8e is the UAF while the memory has been poisoned and not yet re-used, EXCEPTION_ACCESS_VIOLATION_EXEC is when the UAF points at memory that _has_ been reused and we're interpreting part of it as a function pointer. From my POV they're the same (that is, potentially exploitable). This kind of poisoning is good for us because it forces more crashes so we can find and fix the UAFs, but it's not protecting the user.</pre></div><div class="change-set" id="c28"><div class="comment" data-id="10648146" data-no="28"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-28" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_11539" id="a762661_452604"><img src="https://secure.gravatar.com/avatar/ae002109ba1cfbb7f5ad990cc5d9fbaf?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_11539" id="a762661_452604"><a class="email " href="/user_profile?user_id=11539" > <span class="fna">Randell Jesup [:jesup] (needinfo me)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-28"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-28" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c28">Comment 28</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-08-23 11:26 PDT" data-time="1440354399">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-28">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-28" data-comment-id="10648146">While likely a separate issue from the shutdown crash which this is mostly about, some of the signatures pulled up by this are definitely non-shutdown crashes with writes to non-nullptr addresses in ::Accumulate():

cec7adac-303a-4e6f-9e78-fce142150820
(<a rel="nofollow" href="https://crash-stats.mozilla.com/report/index/cec7adac-303a-4e6f-9e78-fce142150820#allthreads">https://crash-stats.mozilla.com/report/index/cec7adac-303a-4e6f-9e78-fce142150820#allthreads</a>)
and 
c05545b5-cc4f-47f7-bb89-129782150817
(<a rel="nofollow" href="https://crash-stats.mozilla.com/report/index/c05545b5-cc4f-47f7-bb89-129782150817#allthreads">https://crash-stats.mozilla.com/report/index/c05545b5-cc4f-47f7-bb89-129782150817#allthreads</a>)

and there are more.  These do not appear to be IPC-shutdown-invoked crashes (no indication in the metadata about ipc failure).

A close look at how those crashed *might* give clues to what's clearly another hole in the Telemetry code here, and one that's hit (though not often) during normal operation (not shutdown).  Likely those should spin off to a separate bug and leave this one on the shutdown issue, though I suspect both are fallout from running this multithreaded code lock-free (and Atomic-free)</pre></div><div class="change-set" id="a1114631_11539"><div class="change" id="aa1114631_11539">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_11539" id="a1114631_11539"><img src="https://secure.gravatar.com/avatar/ae002109ba1cfbb7f5ad990cc5d9fbaf?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_11539" id="a1114631_11539"><a class="email " href="/user_profile?user_id=11539" > <span class="fna">Randell Jesup [:jesup] (needinfo me)</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a1114631_11539"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a1114631_11539">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#a1114631_11539">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-08-23 12:13 PDT" data-time="1440357237">6 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">See Also:  &rarr; <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED DUPLICATE - crash (on write, non-shutdown) in mozilla::Telemetry::Accumulate(mozilla::Telemetry::ID, unsigned int)"
   href="/show_bug.cgi?id=1197616">1197616</a></div></div></div><div class="change-set" id="c29"><div class="comment" data-id="10672284" data-no="29"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-29" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_451704" id="a1114631_11539"><img src="https://secure.gravatar.com/avatar/6168ea97fda0cefa449331e59b24e8f7?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_451704" id="a1114631_11539"><a class="email " href="/user_profile?user_id=451704" > <span class="fna">Liz Henry (:lizzard Please n-i to RyanVM, jcristau, or pascal)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-29"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-29" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c29">Comment 29</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-08-28 12:28 PDT" data-time="1440790107">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-29">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-29" data-comment-id="10672284">Benjamin, can you help find an owner for this bug (and its potential spin-off)? Thanks.</pre><div class="activity"><div class="change">Flags: needinfo?(benjamin)</div></div></div><div class="change-set" id="c30"><div class="comment" data-id="10672840" data-no="30"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-30" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_11539" id="a1114631_11539"><img src="https://secure.gravatar.com/avatar/ae002109ba1cfbb7f5ad990cc5d9fbaf?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_11539" id="a1114631_11539"><a class="email " href="/user_profile?user_id=11539" > <span class="fna">Randell Jesup [:jesup] (needinfo me)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-30"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-30" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c30">Comment 30</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-08-28 14:29 PDT" data-time="1440797344">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-30">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-30" data-comment-id="10672840">gfritzsche - You seem to have a patch for the base portion of this.  Can you take it?</pre><div class="activity"><div class="change">Flags: needinfo?(gfritzsche)</div></div></div><div class="change-set" id="a1935624_546015"><div class="change" id="aa1935624_546015">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_546015" id="a1935624_546015"><img src="https://secure.gravatar.com/avatar/d0465b8931b44330f542efbeeae855da?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_546015" id="a1935624_546015"><a class="email " href="/user_profile?user_id=546015" > <span class="fna">BMO Automation</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a1935624_546015"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a1935624_546015">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#a1935624_546015">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-09-02 00:17 PDT" data-time="1441178230">6 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Group: core-security &rarr; toolkit-core-security</div></div></div><div class="change-set" id="c31"><div class="comment" data-id="10691523" data-no="31"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-31" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_439671" id="a1935624_546015"><img src="https://secure.gravatar.com/avatar/2a3dc7395cc192553d9a8c56fd6c358b?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_439671" id="a1935624_546015"><a class="email disabled" href="/user_profile?user_id=439671" > <span class="fna">Georg Fritzsche [:gfritzsche]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-31"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-31" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c31">Comment 31</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-09-03 05:35 PDT" data-time="1441283715">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-31">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-31" data-comment-id="10691523">(In reply to Randell Jesup [:jesup] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - UAF in Telemetry::Accumulate(); code appears to not be thread-safe"
   href="/show_bug.cgi?id=1193038#c30">comment #30</a>)
<span class="quote">&gt; gfritzsche - You seem to have a patch for the base portion of this.  Can you
&gt; take it?</span >

The patch doesn't take it all the way, otherwise i'd be happy to get this going.
See <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - UAF in Telemetry::Accumulate(); code appears to not be thread-safe"
   href="/show_bug.cgi?id=1193038#c23">comment 23</a> for the issue against this patch.

The other problem is that - for the shutdown path - it only moves the whole issue to a later time.
If we still have runaway threads then they might trigger undefined behavior elsewhere too.

So i'm torn on this bug here. Anyone have a good/clear idea on this?</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(gfritzsche)</span></div></div></div><div class="change-set" id="c32"><div class="comment" data-id="10691623" data-no="32"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-32" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_11539" id="a1935624_546015"><img src="https://secure.gravatar.com/avatar/ae002109ba1cfbb7f5ad990cc5d9fbaf?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_11539" id="a1935624_546015"><a class="email " href="/user_profile?user_id=11539" > <span class="fna">Randell Jesup [:jesup] (needinfo me)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-32"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-32" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c32">Comment 32</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-09-03 06:06 PDT" data-time="1441285562">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-32">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-32" data-comment-id="10691623">IIRC Patrick fixed the nsHostResolver thread problem that caused most of the crashes when we freed this, but there are other leaked threads (I'm slowly nailing them in another set of bugs, so I can land a patch to make nsThread leakage assert).

Note that the biggest crash cause is restart, and we crash while sitting launching the new process.  That shouldn't run afoul of jemalloc shutdown.

I'd say let's go ahead with this.  It certainly won't hurt.</pre></div><div class="change-set" id="c33"><div class="comment" data-id="10692447" data-no="33"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-33" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_439671" id="a1935624_546015"><img src="https://secure.gravatar.com/avatar/2a3dc7395cc192553d9a8c56fd6c358b?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_439671" id="a1935624_546015"><a class="email disabled" href="/user_profile?user_id=439671" > <span class="fna">Georg Fritzsche [:gfritzsche]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-33"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-33" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c33">Comment 33</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-09-03 08:50 PDT" data-time="1441295458">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-33">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-33" data-comment-id="10692447">(In reply to Randell Jesup [:jesup] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - UAF in Telemetry::Accumulate(); code appears to not be thread-safe"
   href="/show_bug.cgi?id=1193038#c32">comment #32</a>)
<span class="quote">&gt; IIRC Patrick fixed the nsHostResolver thread problem that caused most of the
&gt; crashes when we freed this, but there are other leaked threads (I'm slowly
&gt; nailing them in another set of bugs, so I can land a patch to make nsThread
&gt; leakage assert).</span >

Great, that sounds good.

<span class="quote">&gt; Note that the biggest crash cause is restart, and we crash while sitting
&gt; launching the new process.  That shouldn't run afoul of jemalloc shutdown.</span >

Ah, you're thinking of keeping that storage alive past that launch point?
Sure, that's no problem.</pre></div><div class="change-set" id="c34"><div class="comment" data-id="10692797" data-no="34"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-34" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_439671" id="a1935624_546015"><img src="https://secure.gravatar.com/avatar/2a3dc7395cc192553d9a8c56fd6c358b?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_439671" id="a1935624_546015"><a class="email disabled" href="/user_profile?user_id=439671" > <span class="fna">Georg Fritzsche [:gfritzsche]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-34"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-34" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c34">Comment 34</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-09-03 09:55 PDT" data-time="1441299355">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-34">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8656664"
         class="attachment patch"
         data-id="8656664" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="statisticsrecorder">
      <meta itemprop="contentSize" content="1543">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8656664">
          <a class="link" href="attachment.cgi?id=8656664&amp;action=diff">
        <span id="att-8656664-description" itemprop="description">Move StatisticsRecorder cleanup after app relaunch</span></a>
        — <a href="attachment.cgi?id=8656664&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1193038&attachment=8656664">Splinter Review</a>
      </div>
    </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8656664&amp;action=edit"
           title="Move StatisticsRecorder cleanup after app relaunch"
           class=""
        >Attachment #8656664</a> -
        Flags: review?(rjesup)</div></div></div><div class="change-set" id="a2056753_439671"><div class="change" id="aa2056753_439671">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_439671" id="a2056753_439671"><img src="https://secure.gravatar.com/avatar/2a3dc7395cc192553d9a8c56fd6c358b?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_439671" id="a2056753_439671"><a class="email disabled" href="/user_profile?user_id=439671" > <span class="fna">Georg Fritzsche [:gfritzsche]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a2056753_439671"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a2056753_439671">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#a2056753_439671">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-09-03 09:55 PDT" data-time="1441299359">6 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Assignee: nobody &rarr; gfritzsche</div><div class="change">Status: NEW &rarr; ASSIGNED</div></div></div><div class="change-set" id="c35"><div class="comment" data-id="10692832" data-no="35"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-35" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_439671" id="a2056753_439671"><img src="https://secure.gravatar.com/avatar/2a3dc7395cc192553d9a8c56fd6c358b?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_439671" id="a2056753_439671"><a class="email disabled" href="/user_profile?user_id=439671" > <span class="fna">Georg Fritzsche [:gfritzsche]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-35"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-35" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c35">Comment 35</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-09-03 10:04 PDT" data-time="1441299880">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-35">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-35" data-comment-id="10692832"><a rel="nofollow" href="https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=ea8415e524ed">https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=ea8415e524ed</a>

Note that i'm out on PTO from tomorrow afternoon.</pre></div><div class="change-set" id="c36"><div class="comment" data-id="10693314" data-no="36"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-36" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_11539" id="a2056753_439671"><img src="https://secure.gravatar.com/avatar/ae002109ba1cfbb7f5ad990cc5d9fbaf?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_11539" id="a2056753_439671"><a class="email " href="/user_profile?user_id=11539" > <span class="fna">Randell Jesup [:jesup] (needinfo me)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-36"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-36" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c36">Comment 36</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-09-03 10:50 PDT" data-time="1441302637">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-36">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-36" data-comment-id="10693314">(In reply to Georg Fritzsche [:gfritzsche] [away Sep 5 - 13] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - UAF in Telemetry::Accumulate(); code appears to not be thread-safe"
   href="/show_bug.cgi?id=1193038#c33">comment #33</a>)
<span class="quote">&gt; (In reply to Randell Jesup [:jesup] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - UAF in Telemetry::Accumulate(); code appears to not be thread-safe"
   href="/show_bug.cgi?id=1193038#c32">comment #32</a>)
&gt; &gt; Note that the biggest crash cause is restart, and we crash while sitting
&gt; &gt; launching the new process.  That shouldn't run afoul of jemalloc shutdown.
&gt; 
&gt; Ah, you're thinking of keeping that storage alive past that launch point?
&gt; Sure, that's no problem.</span >

So moving it to after the relaunch wasn't exactly my suggestion (though it will certainly help); I was responding to your comment that we need to deal with <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - UAF in Telemetry::Accumulate(); code appears to not be thread-safe"
   href="/show_bug.cgi?id=1193038#c23">comment 23</a>, which links to a comment about use after jemalloc-shutdown.  I was suggesting we do what you had mentioned earlier - leak the object and add it to suppressions.  I'd add a &quot;and add some debug MOZ_ASSERTS if possible to flag use of Accumulate/etc in late shutdown (check a global if need be).&quot; to the wish-list</pre></div><div class="change-set" id="c37"><div class="comment" data-id="10693382" data-no="37"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-37" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_11539" id="a2056753_439671"><img src="https://secure.gravatar.com/avatar/ae002109ba1cfbb7f5ad990cc5d9fbaf?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_11539" id="a2056753_439671"><a class="email " href="/user_profile?user_id=11539" > <span class="fna">Randell Jesup [:jesup] (needinfo me)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-37"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-37" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c37">Comment 37</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-09-03 11:07 PDT" data-time="1441303649">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-37">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-37" data-comment-id="10693382">Comment on <span class=""><a href="/attachment.cgi?id=8656664" name="attach_8656664" title="Move StatisticsRecorder cleanup after app relaunch">attachment 8656664</a> <a href="/attachment.cgi?id=8656664&amp;action=edit" title="Move StatisticsRecorder cleanup after app relaunch">[details]</a> <a href="/attachment.cgi?id=8656664&amp;action=diff" title="Move StatisticsRecorder cleanup after app relaunch">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1193038&amp;attachment=8656664'>[review]</a>
Move StatisticsRecorder cleanup after app relaunch

Review of <span class=""><a href="/attachment.cgi?id=8656664" name="attach_8656664" title="Move StatisticsRecorder cleanup after app relaunch">attachment 8656664</a> <a href="/attachment.cgi?id=8656664&amp;action=edit" title="Move StatisticsRecorder cleanup after app relaunch">[details]</a> <a href="/attachment.cgi?id=8656664&amp;action=diff" title="Move StatisticsRecorder cleanup after app relaunch">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1193038&amp;attachment=8656664'>[review]</a>:
-----------------------------------------------------------------

r+ because it's an improvement.

::: toolkit/xre/nsAppRunner.cpp
&#64;&#64; +4449,5 &#64;&#64;
<span class="quote">&gt;      return rv == NS_ERROR_LAUNCHED_CHILD_PROCESS ? 0 : 1;
&gt;    }
&gt;  
&gt; +  mStatisticsRecorder = nullptr;
&gt; +</span >

better than what we have, for sure.  But still we should look at just removing this and suppressing the leak.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8656664&amp;action=edit"
           title="Move StatisticsRecorder cleanup after app relaunch"
           class=""
        >Attachment #8656664</a> -
        Flags: review?(rjesup) &rarr; review+</div></div></div><div class="change-set" id="c38"><div class="comment" data-id="10695511" data-no="38"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-38" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_439671" id="a2056753_439671"><img src="https://secure.gravatar.com/avatar/2a3dc7395cc192553d9a8c56fd6c358b?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_439671" id="a2056753_439671"><a class="email disabled" href="/user_profile?user_id=439671" > <span class="fna">Georg Fritzsche [:gfritzsche]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-38"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-38" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c38">Comment 38</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-09-03 22:29 PDT" data-time="1441344547">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-38">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-38" data-comment-id="10695511">(In reply to Randell Jesup [:jesup] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - UAF in Telemetry::Accumulate(); code appears to not be thread-safe"
   href="/show_bug.cgi?id=1193038#c36">comment #36</a>)
<span class="quote">&gt; (In reply to Georg Fritzsche [:gfritzsche] [away Sep 5 - 13] from comment
&gt; #33)
&gt; &gt; (In reply to Randell Jesup [:jesup] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - UAF in Telemetry::Accumulate(); code appears to not be thread-safe"
   href="/show_bug.cgi?id=1193038#c32">comment #32</a>)
&gt; &gt; &gt; Note that the biggest crash cause is restart, and we crash while sitting
&gt; &gt; &gt; launching the new process.  That shouldn't run afoul of jemalloc shutdown.
&gt; &gt; 
&gt; &gt; Ah, you're thinking of keeping that storage alive past that launch point?
&gt; &gt; Sure, that's no problem.
&gt; 
&gt; So moving it to after the relaunch wasn't exactly my suggestion (though it
&gt; will certainly help); I was responding to your comment that we need to deal
&gt; with <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - UAF in Telemetry::Accumulate(); code appears to not be thread-safe"
   href="/show_bug.cgi?id=1193038#c23">comment 23</a>, which links to a comment about use after jemalloc-shutdown.
&gt; I was suggesting we do what you had mentioned earlier - leak the object and
&gt; add it to suppressions.  I'd add a &quot;and add some debug MOZ_ASSERTS if
&gt; possible to flag use of Accumulate/etc in late shutdown (check a global if
&gt; need be).&quot; to the wish-list</span >

Ok, i guess the straight leaking would work. Sorry, i don't have time for figuring out the suppressions anymore before i leave, could look into that when i'm back.

What about landing the reviewed patch here, should we be stealthy about landing it?</pre></div><div class="change-set" id="c39"><div class="comment" data-id="10695553" data-no="39"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-39" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_439671" id="a2056753_439671"><img src="https://secure.gravatar.com/avatar/2a3dc7395cc192553d9a8c56fd6c358b?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_439671" id="a2056753_439671"><a class="email disabled" href="/user_profile?user_id=439671" > <span class="fna">Georg Fritzsche [:gfritzsche]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-39"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-39" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c39">Comment 39</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-09-03 22:59 PDT" data-time="1441346366">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-39">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-39" data-comment-id="10695553">FWIW, a trivial leaking version without supressions was in this try push:
<a rel="nofollow" href="https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=6ae61a71843c">https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=6ae61a71843c</a></pre></div><div class="change-set" id="c40"><div class="comment" data-id="10711899" data-no="40"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-40" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_538805" id="a2056753_439671"><img src="https://secure.gravatar.com/avatar/9bd092443d615af36b31b04e81ad7806?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_538805" id="a2056753_439671"><a class="email disabled" href="/user_profile?user_id=538805" > <span class="fna">Ritu Kothari (:ritu) (Inactive, please n-i to RyanVM, jcristau, or pascal)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-40"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-40" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c40">Comment 40</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-09-09 12:14 PDT" data-time="1441826096">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-40">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-40" data-comment-id="10711899">Seems too late to take a fix in 41 for this. If a patch is ready for uplift in the next 24 hrs, please let me know and we can reconsider.</pre><div class="activity"><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox41&amp;o1=isnotempty">status-firefox41</a>:
          <a href="/buglist.cgi?f1=cf_status_firefox41&amp;o1=equals&amp;v1=affected">affected</a> &rarr; <a href="/buglist.cgi?f1=cf_status_firefox41&amp;o1=equals&amp;v1=wontfix">wontfix</a></div></div></div><div class="change-set" id="c41"><div class="comment" data-id="10713972" data-no="41"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-41" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_11539" id="a2056753_439671"><img src="https://secure.gravatar.com/avatar/ae002109ba1cfbb7f5ad990cc5d9fbaf?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_11539" id="a2056753_439671"><a class="email " href="/user_profile?user_id=11539" > <span class="fna">Randell Jesup [:jesup] (needinfo me)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-41"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-41" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c41">Comment 41</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-09-09 23:58 PDT" data-time="1441868302">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-41">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-41" data-comment-id="10713972"><a rel="nofollow" href="https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=9da814562fe6">https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=9da814562fe6</a> looks good, with the leak suppressed (a 1-byte leak...)</pre></div><div class="change-set" id="c42"><div class="comment" data-id="10713999" data-no="42"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-42" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_11539" id="a2056753_439671"><img src="https://secure.gravatar.com/avatar/ae002109ba1cfbb7f5ad990cc5d9fbaf?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_11539" id="a2056753_439671"><a class="email " href="/user_profile?user_id=11539" > <span class="fna">Randell Jesup [:jesup] (needinfo me)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-42"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-42" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c42">Comment 42</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-09-10 00:08 PDT" data-time="1441868896">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-42">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8659078"
         class="attachment patch obsolete"
         data-id="8659078" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="leak">
      <meta itemprop="contentSize" content="2872">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8659078">
          <a class="link" href="attachment.cgi?id=8659078&amp;action=diff">
        <span id="att-8659078-description" itemprop="description">Purposely leak StatisticsReport object and suppress the leak report</span></a> (obsolete)
        — <a href="attachment.cgi?id=8659078&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1193038&attachment=8659078">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-42" data-comment-id="10713999">gfritzche's patch, r=jesup.  I added the suppression</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8659078&amp;action=edit"
           title="Purposely leak StatisticsReport object and suppress the leak report"
           class=""
        >Attachment #8659078</a> -
        Flags: review+</div></div></div><div class="change-set" id="c43"><div class="comment" data-id="10714012" data-no="43"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-43" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_11539" id="a2056753_439671"><img src="https://secure.gravatar.com/avatar/ae002109ba1cfbb7f5ad990cc5d9fbaf?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_11539" id="a2056753_439671"><a class="email " href="/user_profile?user_id=11539" > <span class="fna">Randell Jesup [:jesup] (needinfo me)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-43"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-43" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c43">Comment 43</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-09-10 00:15 PDT" data-time="1441869357">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-43">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-43" data-comment-id="10714012">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8659078" name="attach_8659078" title="Purposely leak StatisticsReport object and suppress the leak report">attachment 8659078</a> <a href="/attachment.cgi?id=8659078&amp;action=edit" title="Purposely leak StatisticsReport object and suppress the leak report">[details]</a> <a href="/attachment.cgi?id=8659078&amp;action=diff" title="Purposely leak StatisticsReport object and suppress the leak report">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1193038&amp;attachment=8659078'>[review]</a>
Purposely leak StatisticsReport object and suppress the leak report

Does this suppress everything allocated by XRE_main only, or stuff allocated by anything called from it?  (Hopefully the first -- and I presume this suppresses all leaks directly allocated in that function, so in theory it could suppress other real leaks, not that I care in this case.)</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8659078&amp;action=edit"
           title="Purposely leak StatisticsReport object and suppress the leak report"
           class=""
        >Attachment #8659078</a> -
        Flags: review?(continuation)</div></div></div><div class="change-set" id="c44"><div class="comment" data-id="10714066" data-no="44"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-44" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_47192" id="a2056753_439671"><img src="https://secure.gravatar.com/avatar/5d5f37905f36ca9989f88861a702cff3?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_47192" id="a2056753_439671"><a class="email " href="/user_profile?user_id=47192" > <span class="fna">Mike Hommey [:glandium]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-44"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-44" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c44">Comment 44</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-09-10 00:41 PDT" data-time="1441870865">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-44">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-44" data-comment-id="10714066">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8659078" name="attach_8659078" title="Purposely leak StatisticsReport object and suppress the leak report">attachment 8659078</a> <a href="/attachment.cgi?id=8659078&amp;action=edit" title="Purposely leak StatisticsReport object and suppress the leak report">[details]</a> <a href="/attachment.cgi?id=8659078&amp;action=diff" title="Purposely leak StatisticsReport object and suppress the leak report">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1193038&amp;attachment=8659078'>[review]</a>
Purposely leak StatisticsReport object and suppress the leak report

Review of <span class="bz_obsolete"><a href="/attachment.cgi?id=8659078" name="attach_8659078" title="Purposely leak StatisticsReport object and suppress the leak report">attachment 8659078</a> <a href="/attachment.cgi?id=8659078&amp;action=edit" title="Purposely leak StatisticsReport object and suppress the leak report">[details]</a> <a href="/attachment.cgi?id=8659078&amp;action=diff" title="Purposely leak StatisticsReport object and suppress the leak report">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1193038&amp;attachment=8659078'>[review]</a>:
-----------------------------------------------------------------

::: toolkit/xre/nsAppRunner.cpp
&#64;&#64; +3090,5 &#64;&#64;
<span class="quote">&gt;    nsCOMPtr&lt;nsIRemoteService&gt; mRemoteService;
&gt;  #endif
&gt;  
&gt;    UniquePtr&lt;ScopedXPCOMStartup&gt; mScopedXPCOM;
&gt; +  base::StatisticsRecorder* mStatisticsRecorder;</span >

Considering nothing is actually reading mStatisticsRecorder, you could make it a local variable in XRE_main (*not* XREMain::XRE_main), would would allow you to leak it and limit the effects of the lsan suppression, since it would then apply to XRE_main, not XREMain::XRE_main.</pre></div><div class="change-set" id="c45"><div class="comment" data-id="10714132" data-no="45"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-45" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_11539" id="a2056753_439671"><img src="https://secure.gravatar.com/avatar/ae002109ba1cfbb7f5ad990cc5d9fbaf?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_11539" id="a2056753_439671"><a class="email " href="/user_profile?user_id=11539" > <span class="fna">Randell Jesup [:jesup] (needinfo me)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-45"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-45" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c45">Comment 45</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-09-10 00:52 PDT" data-time="1441871544">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-45">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8659095"
         class="attachment patch obsolete"
         data-id="8659095" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="foo">
      <meta itemprop="contentSize" content="3562">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8659095">
          <a class="link" href="attachment.cgi?id=8659095&amp;action=diff">
        <span id="att-8659095-description" itemprop="description">Purposely leak StatisticsReport object and suppress the leak report</span></a> (obsolete)
        — <a href="attachment.cgi?id=8659095&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1193038&attachment=8659095">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-45" data-comment-id="10714132">Alternative
<a rel="nofollow" href="https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=e39ae201963f">https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=e39ae201963f</a></pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8659095&amp;action=edit"
           title="Purposely leak StatisticsReport object and suppress the leak report"
           class=""
        >Attachment #8659095</a> -
        Flags: review?(mh+mozilla)</div><div class="change">
        <a href="/attachment.cgi?id=8659095&amp;action=edit"
           title="Purposely leak StatisticsReport object and suppress the leak report"
           class=""
        >Attachment #8659095</a> -
        Flags: review?(continuation)</div></div></div><div class="change-set" id="c46"><div class="comment" data-id="10714168" data-no="46"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-46" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_47192" id="a2056753_439671"><img src="https://secure.gravatar.com/avatar/5d5f37905f36ca9989f88861a702cff3?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_47192" id="a2056753_439671"><a class="email " href="/user_profile?user_id=47192" > <span class="fna">Mike Hommey [:glandium]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-46"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-46" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c46">Comment 46</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-09-10 00:59 PDT" data-time="1441871972">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-46">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-46" data-comment-id="10714168">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8659095" name="attach_8659095" title="Purposely leak StatisticsReport object and suppress the leak report">attachment 8659095</a> <a href="/attachment.cgi?id=8659095&amp;action=edit" title="Purposely leak StatisticsReport object and suppress the leak report">[details]</a> <a href="/attachment.cgi?id=8659095&amp;action=diff" title="Purposely leak StatisticsReport object and suppress the leak report">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1193038&amp;attachment=8659095'>[review]</a>
Purposely leak StatisticsReport object and suppress the leak report

Review of <span class="bz_obsolete"><a href="/attachment.cgi?id=8659095" name="attach_8659095" title="Purposely leak StatisticsReport object and suppress the leak report">attachment 8659095</a> <a href="/attachment.cgi?id=8659095&amp;action=edit" title="Purposely leak StatisticsReport object and suppress the leak report">[details]</a> <a href="/attachment.cgi?id=8659095&amp;action=diff" title="Purposely leak StatisticsReport object and suppress the leak report">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1193038&amp;attachment=8659095'>[review]</a>:
-----------------------------------------------------------------

copy/paste from irc:
<span class="quote">&gt; that's what I was suggesting, yes
&gt; although, I just had a new nasty idea, which may of may not be worth if we have more of this &quot;intentionally leak&quot; scheme
&gt; my nasty idea being something like UniquePtr, but that would be LeakedPtr. There would be a MakeLeaked&lt;&gt; template like there is MakeUnique, and then we could possily generically lsan-suppress all things leaked from MakeLeaked&lt;*&gt;</span ></pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8659095&amp;action=edit"
           title="Purposely leak StatisticsReport object and suppress the leak report"
           class=""
        >Attachment #8659095</a> -
        Flags: review?(mh+mozilla) &rarr; review+</div></div></div><div class="change-set" id="a2654973_406194"><div class="change" id="aa2654973_406194">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_406194" id="a2654973_406194"><img src="https://secure.gravatar.com/avatar/0a70c84cd33dba0151fe15f2f8773137?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_406194" id="a2654973_406194"><a class="email " href="/user_profile?user_id=406194" > <span class="fna">Andrew McCreight [:mccr8]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a2654973_406194"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a2654973_406194">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#a2654973_406194">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-09-10 08:06 PDT" data-time="1441897579">6 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8659095&amp;action=edit"
           title="Purposely leak StatisticsReport object and suppress the leak report"
           class=""
        >Attachment #8659095</a> -
        Flags: review?(continuation) &rarr; review-</div></div></div><div class="change-set" id="a2654981_406194"><div class="change" id="aa2654981_406194">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_406194" id="a2654981_406194"><img src="https://secure.gravatar.com/avatar/0a70c84cd33dba0151fe15f2f8773137?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_406194" id="a2654981_406194"><a class="email " href="/user_profile?user_id=406194" > <span class="fna">Andrew McCreight [:mccr8]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a2654981_406194"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a2654981_406194">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#a2654981_406194">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-09-10 08:06 PDT" data-time="1441897587">6 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8659078&amp;action=edit"
           title="Purposely leak StatisticsReport object and suppress the leak report"
           class=""
        >Attachment #8659078</a> -
        Flags: review?(continuation) &rarr; review-</div></div></div><div class="change-set" id="c47"><div class="comment" data-id="10715813" data-no="47"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-47" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_406194" id="a2654981_406194"><img src="https://secure.gravatar.com/avatar/0a70c84cd33dba0151fe15f2f8773137?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_406194" id="a2654981_406194"><a class="email " href="/user_profile?user_id=406194" > <span class="fna">Andrew McCreight [:mccr8]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-47"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-47" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c47">Comment 47</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-09-10 08:07 PDT" data-time="1441897643">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-47">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-47" data-comment-id="10715813">That will match any stack that contains XRE_main in any frame. What you want is to call MOZ_LSAN_INTENTIONALLY_LEAK_OBJECT on the object you are intentionally leaking, which is what is described in <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - UAF in Telemetry::Accumulate(); code appears to not be thread-safe"
   href="/show_bug.cgi?id=1193038#c46">comment 46</a>.</pre></div><div class="change-set" id="c48"><div class="comment" data-id="10715900" data-no="48"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-48" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_11539" id="a2654981_406194"><img src="https://secure.gravatar.com/avatar/ae002109ba1cfbb7f5ad990cc5d9fbaf?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_11539" id="a2654981_406194"><a class="email " href="/user_profile?user_id=11539" > <span class="fna">Randell Jesup [:jesup] (needinfo me)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-48"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-48" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c48">Comment 48</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-09-10 08:33 PDT" data-time="1441899194">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-48">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8659304"
         class="attachment patch obsolete"
         data-id="8659304" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="foo">
      <meta itemprop="contentSize" content="3155">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8659304">
          <a class="link" href="attachment.cgi?id=8659304&amp;action=diff">
        <span id="att-8659304-description" itemprop="description">fooPurposely leak StatisticsReport object and suppress the leak report</span></a> (obsolete)
        — <a href="attachment.cgi?id=8659304&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1193038&attachment=8659304">Splinter Review</a>
      </div>
    </div><div class="activity"><div class="change">Assignee: gfritzsche &rarr; rjesup</div><div class="change">
        <a href="/attachment.cgi?id=8659078&amp;action=edit"
           title="Purposely leak StatisticsReport object and suppress the leak report"
           class=""
        >Attachment #8659078</a> -
        Attachment is obsolete: true</div><div class="change">
        <a href="/attachment.cgi?id=8659095&amp;action=edit"
           title="Purposely leak StatisticsReport object and suppress the leak report"
           class=""
        >Attachment #8659095</a> -
        Attachment is obsolete: true</div><div class="change">
        <a href="/attachment.cgi?id=8659304&amp;action=edit"
           title="fooPurposely leak StatisticsReport object and suppress the leak report"
           class=""
        >Attachment #8659304</a> -
        Flags: review?(continuation)</div></div></div><div class="change-set" id="c49"><div class="comment" data-id="10715919" data-no="49"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-49" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_406194" id="a2654981_406194"><img src="https://secure.gravatar.com/avatar/0a70c84cd33dba0151fe15f2f8773137?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_406194" id="a2654981_406194"><a class="email " href="/user_profile?user_id=406194" > <span class="fna">Andrew McCreight [:mccr8]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-49"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-49" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c49">Comment 49</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-09-10 08:35 PDT" data-time="1441899350">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-49">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-49" data-comment-id="10715919">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8659304" name="attach_8659304" title="fooPurposely leak StatisticsReport object and suppress the leak report">attachment 8659304</a> <a href="/attachment.cgi?id=8659304&amp;action=edit" title="fooPurposely leak StatisticsReport object and suppress the leak report">[details]</a> <a href="/attachment.cgi?id=8659304&amp;action=diff" title="fooPurposely leak StatisticsReport object and suppress the leak report">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1193038&amp;attachment=8659304'>[review]</a>
fooPurposely leak StatisticsReport object and suppress the leak report

Review of <span class="bz_obsolete"><a href="/attachment.cgi?id=8659304" name="attach_8659304" title="fooPurposely leak StatisticsReport object and suppress the leak report">attachment 8659304</a> <a href="/attachment.cgi?id=8659304&amp;action=edit" title="fooPurposely leak StatisticsReport object and suppress the leak report">[details]</a> <a href="/attachment.cgi?id=8659304&amp;action=diff" title="fooPurposely leak StatisticsReport object and suppress the leak report">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1193038&amp;attachment=8659304'>[review]</a>:
-----------------------------------------------------------------

r=me for the LEAK_OBJECT stuff.

::: toolkit/xre/nsAppRunner.cpp
&#64;&#64; +4471,5 &#64;&#64;
<span class="quote">&gt; +  // A initializer to initialize histogram collection, a chromium
&gt; +  // thing used by Telemetry (and effectively a global; it's all static).
&gt; +  // Note: purposely leaked
&gt; +  base::StatisticsRecorder* statistics_recorder = new base::StatisticsRecorder();
&gt; +  MOZ_LSAN_INTENTIONALLY_LEAK_OBJECT(statistics_recorder);</span >

You should #include mozilla/MemoryChecking.h explicitly in this file, if it isn't there already.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8659304&amp;action=edit"
           title="fooPurposely leak StatisticsReport object and suppress the leak report"
           class=""
        >Attachment #8659304</a> -
        Flags: review?(continuation) &rarr; review+</div></div></div><div class="change-set" id="c50"><div class="comment" data-id="10716204" data-no="50"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-50" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_11539" id="a2654981_406194"><img src="https://secure.gravatar.com/avatar/ae002109ba1cfbb7f5ad990cc5d9fbaf?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_11539" id="a2654981_406194"><a class="email " href="/user_profile?user_id=11539" > <span class="fna">Randell Jesup [:jesup] (needinfo me)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-50"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-50" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c50">Comment 50</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-09-10 09:46 PDT" data-time="1441903607">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-50">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-50" data-comment-id="10716204">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8659304" name="attach_8659304" title="fooPurposely leak StatisticsReport object and suppress the leak report">attachment 8659304</a> <a href="/attachment.cgi?id=8659304&amp;action=edit" title="fooPurposely leak StatisticsReport object and suppress the leak report">[details]</a> <a href="/attachment.cgi?id=8659304&amp;action=diff" title="fooPurposely leak StatisticsReport object and suppress the leak report">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1193038&amp;attachment=8659304'>[review]</a>
fooPurposely leak StatisticsReport object and suppress the leak report

Approval Request Comment
[Feature/regressing bug #]: N/A

[User impact if declined]: longer exposure (though low risk of that being exploited)

[Describe test coverage new/current, TreeHerder]: Shutdown is tested.

[Risks and why]: very low risk

[String/UUID change made/needed]: none

[Security approval request comment]
How easily could an exploit be constructed based on the patch?  Highly unlikely

Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?  Somewhat - clear we're leaking, so one could look for why that's important.

Which older supported branches are affected by this flaw? all

If not all supported branches, which bug introduced the flaw?

Do you have backports for the affected branches? If not, how different, hard to create, and risky will they be?  Trivial backporting.

How likely is this patch to cause regressions; how much testing does it need?  No likelihood of regressions.  No significant testing needed.  At most, do some update-and-restarts.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8659304&amp;action=edit"
           title="fooPurposely leak StatisticsReport object and suppress the leak report"
           class=""
        >Attachment #8659304</a> -
        Flags: sec-approval?</div><div class="change">
        <a href="/attachment.cgi?id=8659304&amp;action=edit"
           title="fooPurposely leak StatisticsReport object and suppress the leak report"
           class=""
        >Attachment #8659304</a> -
        Flags: approval-mozilla-aurora?</div></div></div><div class="change-set" id="c51"><div class="comment" data-id="10716461" data-no="51"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-51" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_1689" id="a2654981_406194"><img src="https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_1689" id="a2654981_406194"><a class="email " href="/user_profile?user_id=1689" > <span class="fna">Daniel Veditz [:dveditz]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-51"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-51" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c51">Comment 51</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-09-10 10:28 PDT" data-time="1441906121">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-51">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-51" data-comment-id="10716461">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8659304" name="attach_8659304" title="fooPurposely leak StatisticsReport object and suppress the leak report">attachment 8659304</a> <a href="/attachment.cgi?id=8659304&amp;action=edit" title="fooPurposely leak StatisticsReport object and suppress the leak report">[details]</a> <a href="/attachment.cgi?id=8659304&amp;action=diff" title="fooPurposely leak StatisticsReport object and suppress the leak report">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1193038&amp;attachment=8659304'>[review]</a>
fooPurposely leak StatisticsReport object and suppress the leak report

a=dveditz for sec-approval and aurora landing.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8659304&amp;action=edit"
           title="fooPurposely leak StatisticsReport object and suppress the leak report"
           class=""
        >Attachment #8659304</a> -
        Flags: <span class="activity-deleted">sec-approval?</span></div><div class="change">
        <a href="/attachment.cgi?id=8659304&amp;action=edit"
           title="fooPurposely leak StatisticsReport object and suppress the leak report"
           class=""
        >Attachment #8659304</a> -
        Flags: sec-approval+</div><div class="change">
        <a href="/attachment.cgi?id=8659304&amp;action=edit"
           title="fooPurposely leak StatisticsReport object and suppress the leak report"
           class=""
        >Attachment #8659304</a> -
        Flags: <span class="activity-deleted">approval-mozilla-aurora?</span></div><div class="change">
        <a href="/attachment.cgi?id=8659304&amp;action=edit"
           title="fooPurposely leak StatisticsReport object and suppress the leak report"
           class=""
        >Attachment #8659304</a> -
        Flags: approval-mozilla-aurora+</div></div></div><div class="change-set" id="c52"><div class="comment" data-id="10716505" data-no="52"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-52" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_11539" id="a2654981_406194"><img src="https://secure.gravatar.com/avatar/ae002109ba1cfbb7f5ad990cc5d9fbaf?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_11539" id="a2654981_406194"><a class="email " href="/user_profile?user_id=11539" > <span class="fna">Randell Jesup [:jesup] (needinfo me)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-52"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-52" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c52">Comment 52</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-09-10 10:37 PDT" data-time="1441906644">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-52">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-52" data-comment-id="10716505"><a rel="nofollow" href="https://hg.mozilla.org/integration/mozilla-inbound/rev/2c9fe69fd9b4">https://hg.mozilla.org/integration/mozilla-inbound/rev/2c9fe69fd9b4</a></pre></div><div class="change-set" id="c53"><div class="comment" data-id="10716516" data-no="53"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-53" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_11539" id="a2654981_406194"><img src="https://secure.gravatar.com/avatar/ae002109ba1cfbb7f5ad990cc5d9fbaf?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_11539" id="a2654981_406194"><a class="email " href="/user_profile?user_id=11539" > <span class="fna">Randell Jesup [:jesup] (needinfo me)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-53"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-53" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c53">Comment 53</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-09-10 10:38 PDT" data-time="1441906694">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-53">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-53" data-comment-id="10716516">Note: this code is still a mess thread-safety-wise, at least documenting it and TSAN.</pre></div><div class="change-set" id="c54"><div class="comment" data-id="10716618" data-no="54"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-54" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_11539" id="a2654981_406194"><img src="https://secure.gravatar.com/avatar/ae002109ba1cfbb7f5ad990cc5d9fbaf?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_11539" id="a2654981_406194"><a class="email " href="/user_profile?user_id=11539" > <span class="fna">Randell Jesup [:jesup] (needinfo me)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-54"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-54" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c54">Comment 54</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-09-10 11:02 PDT" data-time="1441908132">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-54">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-54" data-comment-id="10716618"><a rel="nofollow" href="https://hg.mozilla.org/integration/mozilla-inbound/rev/9a09b707e39b">https://hg.mozilla.org/integration/mozilla-inbound/rev/9a09b707e39b</a> (needed unused &lt;&lt; statistics_recorder)</pre></div><div class="change-set" id="c55"><div class="comment" data-id="10716983" data-no="55"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-55" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_135518" id="a2654981_406194"><img src="https://secure.gravatar.com/avatar/2b6c1ba0915a97a81d59ca1e101e6d74?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_135518" id="a2654981_406194"><a class="email " href="/user_profile?user_id=135518" > <span class="fna">Phil Ringnalda (:philor)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-55"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-55" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c55">Comment 55</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-09-10 12:27 PDT" data-time="1441913262">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-55">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-55" data-comment-id="10716983">Backed out in <a rel="nofollow" href="https://hg.mozilla.org/integration/mozilla-inbound/rev/56f6468c7e60">https://hg.mozilla.org/integration/mozilla-inbound/rev/56f6468c7e60</a> because suppressing the very generic leak in Valgrind made us nervous.</pre></div><div class="change-set" id="c56"><div class="comment" data-id="10725129" data-no="56"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-56" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_11539" id="a2654981_406194"><img src="https://secure.gravatar.com/avatar/ae002109ba1cfbb7f5ad990cc5d9fbaf?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_11539" id="a2654981_406194"><a class="email " href="/user_profile?user_id=11539" > <span class="fna">Randell Jesup [:jesup] (needinfo me)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-56"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-56" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c56">Comment 56</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-09-12 22:47 PDT" data-time="1442123239">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-56">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8660398"
         class="attachment patch"
         data-id="8660398" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="valgrind">
      <meta itemprop="contentSize" content="967">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8660398">
          <a class="link" href="attachment.cgi?id=8660398&amp;action=diff">
        <span id="att-8660398-description" itemprop="description">Suppress leak in valgrind as well</span></a>
        — <a href="attachment.cgi?id=8660398&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1193038&attachment=8660398">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-56" data-comment-id="10725129">Tested with this patch (<a rel="nofollow" href="https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=cf91734da97f">https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=cf91734da97f</a>), and with a patch to introduce a leak in something called from a deeper function to ensure reporting is still working (<a rel="nofollow" href="https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=7cac87e190aa">https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=7cac87e190aa</a>)</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8660398&amp;action=edit"
           title="Suppress leak in valgrind as well"
           class=""
        >Attachment #8660398</a> -
        Flags: review?(n.nethercote)</div></div></div><div class="change-set" id="c57"><div class="comment" data-id="10725130" data-no="57"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-57" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_11539" id="a2654981_406194"><img src="https://secure.gravatar.com/avatar/ae002109ba1cfbb7f5ad990cc5d9fbaf?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_11539" id="a2654981_406194"><a class="email " href="/user_profile?user_id=11539" > <span class="fna">Randell Jesup [:jesup] (needinfo me)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-57"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-57" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c57">Comment 57</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-09-12 22:49 PDT" data-time="1442123391">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-57">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8660399"
         class="attachment patch"
         data-id="8660399" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="leak">
      <meta itemprop="contentSize" content="3743">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8660399">
          <a class="link" href="attachment.cgi?id=8660399&amp;action=diff">
        <span id="att-8660399-description" itemprop="description">Purposely leak StatisticsReport object and suppress the leak report</span></a>
        — <a href="attachment.cgi?id=8660399&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1193038&attachment=8660399">Splinter Review</a>
      </div>
    </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8659304&amp;action=edit"
           title="fooPurposely leak StatisticsReport object and suppress the leak report"
           class=""
        >Attachment #8659304</a> -
        Attachment is obsolete: true</div><div class="change">
        <a href="/attachment.cgi?id=8660399&amp;action=edit"
           title="Purposely leak StatisticsReport object and suppress the leak report"
           class=""
        >Attachment #8660399</a> -
        Flags: review+</div></div></div><div class="change-set" id="c58"><div class="comment" data-id="10725216" data-no="58"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-58" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_334849" id="a2654981_406194"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_334849" id="a2654981_406194"><a class="email " href="/user_profile?user_id=334849" > <span class="fna">Nicholas Nethercote [inactive]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-58"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-58" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c58">Comment 58</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-09-13 03:51 PDT" data-time="1442141510">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-58">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-58" data-comment-id="10725216">Comment on <span class=""><a href="/attachment.cgi?id=8660398" name="attach_8660398" title="Suppress leak in valgrind as well">attachment 8660398</a> <a href="/attachment.cgi?id=8660398&amp;action=edit" title="Suppress leak in valgrind as well">[details]</a> <a href="/attachment.cgi?id=8660398&amp;action=diff" title="Suppress leak in valgrind as well">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1193038&amp;attachment=8660398'>[review]</a>
Suppress leak in valgrind as well

Review of <span class=""><a href="/attachment.cgi?id=8660398" name="attach_8660398" title="Suppress leak in valgrind as well">attachment 8660398</a> <a href="/attachment.cgi?id=8660398&amp;action=edit" title="Suppress leak in valgrind as well">[details]</a> <a href="/attachment.cgi?id=8660398&amp;action=diff" title="Suppress leak in valgrind as well">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1193038&amp;attachment=8660398'>[review]</a>:
-----------------------------------------------------------------

::: build/valgrind/cross-architecture.sup
&#64;&#64; +39,5 &#64;&#64;
<span class="quote">&gt; +   Memcheck:Leak
&gt; +   fun:malloc
&gt; +   fun:moz_xmalloc
&gt; +   fun:operator new
&gt; +   fun:XRE_main</span >

I have no context but this is a worryingly generic suppression. I suggest you create a separate function that does nothing but allocate the StatisticsReporter and call it from main(). That way there would be, for example, a &quot;fun:LeakyStatisticsReporterAllocator&quot; entry between the &quot;fun:operator new&quot; and the &quot;fun:XRE_main&quot;, which would make things clearer and less generic.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8660398&amp;action=edit"
           title="Suppress leak in valgrind as well"
           class=""
        >Attachment #8660398</a> -
        Flags: <span class="activity-deleted">review?(n.nethercote)</span></div></div></div><div class="change-set" id="c59"><div class="comment" data-id="10725535" data-no="59"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-59" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_11539" id="a2654981_406194"><img src="https://secure.gravatar.com/avatar/ae002109ba1cfbb7f5ad990cc5d9fbaf?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_11539" id="a2654981_406194"><a class="email " href="/user_profile?user_id=11539" > <span class="fna">Randell Jesup [:jesup] (needinfo me)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-59"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-59" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c59">Comment 59</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-09-13 11:52 PDT" data-time="1442170334">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-59">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-59" data-comment-id="10725535">This suppression should only over allocations directly from XRE_main(), which is a very simple function.  Before the change it was basically:
int XRE_main(int argc, char* argv[], const nsXREAppData* aAppData, uint32_t aFlags)
{
  XREMain main;
  int result = main.XRE_main(argc, argv, aAppData);
  mozilla::RecordShutdownEndTimeStamp();
  return result;
}

The suppression is limited to allocations with new call directly from XRE_main.  I tested that a leak in main.XRE_main() is reported.  And I was hesitant to do the stub-function trick (though I coded that as well) because the compiler might inline it given how simple it is.  

All that said, it's trivial to dump it into a stub function if you prefer.</pre></div><div class="change-set" id="c60"><div class="comment" data-id="10726245" data-no="60"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-60" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_334849" id="a2654981_406194"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_334849" id="a2654981_406194"><a class="email " href="/user_profile?user_id=334849" > <span class="fna">Nicholas Nethercote [inactive]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-60"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-60" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c60">Comment 60</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-09-13 21:36 PDT" data-time="1442205391">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-60">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-60" data-comment-id="10726245">(In reply to Randell Jesup [:jesup] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - UAF in Telemetry::Accumulate(); code appears to not be thread-safe"
   href="/show_bug.cgi?id=1193038#c59">comment #59</a>)
<span class="quote">&gt; All that said, it's trivial to dump it into a stub function if you prefer.</span >

That would save a future person looking at the valgrind suppressions from having the same reaction as me :)  Thank you.</pre></div><div class="change-set" id="a2962812_334849"><div class="change" id="aa2962812_334849">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_334849" id="a2962812_334849"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_334849" id="a2962812_334849"><a class="email " href="/user_profile?user_id=334849" > <span class="fna">Nicholas Nethercote [inactive]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a2962812_334849"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a2962812_334849">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#a2962812_334849">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-09-13 21:36 PDT" data-time="1442205418">6 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8660398&amp;action=edit"
           title="Suppress leak in valgrind as well"
           class=""
        >Attachment #8660398</a> -
        Flags: review+</div></div></div><div class="change-set" id="c61"><div class="comment" data-id="10726368" data-no="61"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-61" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_11539" id="a2962812_334849"><img src="https://secure.gravatar.com/avatar/ae002109ba1cfbb7f5ad990cc5d9fbaf?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_11539" id="a2962812_334849"><a class="email " href="/user_profile?user_id=11539" > <span class="fna">Randell Jesup [:jesup] (needinfo me)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-61"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-61" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c61">Comment 61</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-09-13 23:32 PDT" data-time="1442212353">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-61">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-61" data-comment-id="10726368">Green try with separate stub: <a rel="nofollow" href="https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=23cab817081b">https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=23cab817081b</a>
and a red one with a deliberate leak elsewhere; carrying forward r=njn</pre></div><div class="change-set" id="c62"><div class="comment" data-id="10726376" data-no="62"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-62" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_11539" id="a2962812_334849"><img src="https://secure.gravatar.com/avatar/ae002109ba1cfbb7f5ad990cc5d9fbaf?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_11539" id="a2962812_334849"><a class="email " href="/user_profile?user_id=11539" > <span class="fna">Randell Jesup [:jesup] (needinfo me)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-62"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-62" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c62">Comment 62</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-09-13 23:35 PDT" data-time="1442212524">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-62">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-62" data-comment-id="10726376"><a rel="nofollow" href="https://hg.mozilla.org/integration/mozilla-inbound/rev/346b9ee524d1">https://hg.mozilla.org/integration/mozilla-inbound/rev/346b9ee524d1</a></pre></div><div class="change-set" id="c63"><div class="comment" data-id="10727593" data-no="63"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-63" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_495955" id="a2962812_334849"><img src="https://secure.gravatar.com/avatar/5aa2e382197a147b42d020b6878f8623?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_495955" id="a2962812_334849"><a class="email " href="/user_profile?user_id=495955" > <span class="fna">Sylvestre Ledru [:Sylvestre]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-63"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-63" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c63">Comment 63</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-09-14 07:14 PDT" data-time="1442240055">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-63">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-63" data-comment-id="10727593">Georg, are you planning to request an uplift to 42? Thanks</pre><div class="activity"><div class="change">Flags: needinfo?(gfritzsche)</div></div></div><div class="change-set" id="c64"><div class="comment" data-id="10727776" data-no="64"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-64" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_439671" id="a2962812_334849"><img src="https://secure.gravatar.com/avatar/2a3dc7395cc192553d9a8c56fd6c358b?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_439671" id="a2962812_334849"><a class="email disabled" href="/user_profile?user_id=439671" > <span class="fna">Georg Fritzsche [:gfritzsche]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-64"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-64" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c64">Comment 64</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-09-14 07:44 PDT" data-time="1442241876">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-64">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-64" data-comment-id="10727776">Moving to jesup who should have a better overview here now :)</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(gfritzsche)</span></div></div></div><div class="change-set" id="c65"><div class="comment" data-id="10727822" data-no="65"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-65" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_11539" id="a2962812_334849"><img src="https://secure.gravatar.com/avatar/ae002109ba1cfbb7f5ad990cc5d9fbaf?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_11539" id="a2962812_334849"><a class="email " href="/user_profile?user_id=11539" > <span class="fna">Randell Jesup [:jesup] (needinfo me)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-65"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-65" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c65">Comment 65</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-09-14 07:53 PDT" data-time="1442242423">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-65">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-65" data-comment-id="10727822">Comment on <span class=""><a href="/attachment.cgi?id=8660399" name="attach_8660399" title="Purposely leak StatisticsReport object and suppress the leak report">attachment 8660399</a> <a href="/attachment.cgi?id=8660399&amp;action=edit" title="Purposely leak StatisticsReport object and suppress the leak report">[details]</a> <a href="/attachment.cgi?id=8660399&amp;action=diff" title="Purposely leak StatisticsReport object and suppress the leak report">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1193038&amp;attachment=8660399'>[review]</a>
Purposely leak StatisticsReport object and suppress the leak report

Approval Request Comment
[Feature/regressing bug #]: N/A

[User impact if declined]: hard-to-exploit UAF in shutdown, typically when doing a restart installing an update.

[Describe test coverage new/current, TreeHerder]: extremely hard repeating the bug to test in automation, or even manually.  Normal shutdown is well tested.

[Risks and why]: Almost none.  Just leaks what is effectively a global.

[String/UUID change made/needed]: none</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8660399&amp;action=edit"
           title="Purposely leak StatisticsReport object and suppress the leak report"
           class=""
        >Attachment #8660399</a> -
        Flags: approval-mozilla-aurora?</div></div></div><div class="change-set" id="c66"><div class="comment" data-id="10730438" data-no="66"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-66" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_308534" id="a2962812_334849"><img src="https://secure.gravatar.com/avatar/bb55b2a8c34fd29f570ca139f13d46b8?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_308534" id="a2962812_334849"><a class="email " href="/user_profile?user_id=308534" > <span class="fna">Wes Kocher (:KWierso) (Not reading bugmail; email directly if needed)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-66"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-66" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c66">Comment 66</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-09-14 17:19 PDT" data-time="1442276341">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-66">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-66" data-comment-id="10730438"><a rel="nofollow" href="https://hg.mozilla.org/mozilla-central/rev/346b9ee524d1">https://hg.mozilla.org/mozilla-central/rev/346b9ee524d1</a></pre><div class="activity"><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox43&amp;o1=isnotempty">status-firefox43</a>:
          <a href="/buglist.cgi?f1=cf_status_firefox43&amp;o1=equals&amp;v1=affected">affected</a> &rarr; <a href="/buglist.cgi?f1=cf_status_firefox43&amp;o1=equals&amp;v1=fixed">fixed</a></div></div></div><div class="change-set" id="a3033761_308534"><div class="change" id="aa3033761_308534">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_308534" id="a3033761_308534"><img src="https://secure.gravatar.com/avatar/bb55b2a8c34fd29f570ca139f13d46b8?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_308534" id="a3033761_308534"><a class="email " href="/user_profile?user_id=308534" > <span class="fna">Wes Kocher (:KWierso) (Not reading bugmail; email directly if needed)</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a3033761_308534"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a3033761_308534">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#a3033761_308534">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-09-14 17:19 PDT" data-time="1442276367">6 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Status: ASSIGNED &rarr; RESOLVED</div><div class="change">Closed: <span class="rel-time" title="2015-09-14 17:19 PDT" data-time="1442276367">6 years ago</span></div><div class="change">Resolution: --- &rarr; FIXED</div></div></div><div class="change-set" id="a3091224_1689"><div class="change" id="aa3091224_1689">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_1689" id="a3091224_1689"><img src="https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_1689" id="a3091224_1689"><a class="email " href="/user_profile?user_id=1689" > <span class="fna">Daniel Veditz [:dveditz]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a3091224_1689"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a3091224_1689">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#a3091224_1689">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-09-15 09:17 PDT" data-time="1442333830">6 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Group: toolkit-core-security &rarr; core-security-release</div></div></div><div class="change-set" id="c67"><div class="comment" data-id="10733345" data-no="67"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-67" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_495955" id="a3091224_1689"><img src="https://secure.gravatar.com/avatar/5aa2e382197a147b42d020b6878f8623?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_495955" id="a3091224_1689"><a class="email " href="/user_profile?user_id=495955" > <span class="fna">Sylvestre Ledru [:Sylvestre]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-67"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-67" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c67">Comment 67</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-09-15 09:19 PDT" data-time="1442333993">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-67">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-67" data-comment-id="10733345">Comment on <span class=""><a href="/attachment.cgi?id=8660399" name="attach_8660399" title="Purposely leak StatisticsReport object and suppress the leak report">attachment 8660399</a> <a href="/attachment.cgi?id=8660399&amp;action=edit" title="Purposely leak StatisticsReport object and suppress the leak report">[details]</a> <a href="/attachment.cgi?id=8660399&amp;action=diff" title="Purposely leak StatisticsReport object and suppress the leak report">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1193038&amp;attachment=8660399'>[review]</a>
Purposely leak StatisticsReport object and suppress the leak report

Let's take it.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8660399&amp;action=edit"
           title="Purposely leak StatisticsReport object and suppress the leak report"
           class=""
        >Attachment #8660399</a> -
        Flags: approval-mozilla-aurora? &rarr; approval-mozilla-aurora+</div></div></div><div class="change-set" id="a4275989_495955"><div class="change" id="aa4275989_495955">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_495955" id="a4275989_495955"><img src="https://secure.gravatar.com/avatar/5aa2e382197a147b42d020b6878f8623?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_495955" id="a4275989_495955"><a class="email " href="/user_profile?user_id=495955" > <span class="fna">Sylvestre Ledru [:Sylvestre]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a4275989_495955"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a4275989_495955">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#a4275989_495955">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-09-29 02:23 PDT" data-time="1443518595">6 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
          <a href="/buglist.cgi?f1=cf_tracking_firefox_esr31&amp;o1=isnotempty">tracking-firefox-esr31</a>:
          <a href="/buglist.cgi?f1=cf_tracking_firefox_esr31&amp;o1=equals&amp;v1=%3F">?</a> &rarr; ---</div></div></div><div class="change-set" id="c68"><div class="comment" data-id="10787667" data-no="68"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-68" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_495955" id="a4275989_495955"><img src="https://secure.gravatar.com/avatar/5aa2e382197a147b42d020b6878f8623?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_495955" id="a4275989_495955"><a class="email " href="/user_profile?user_id=495955" > <span class="fna">Sylvestre Ledru [:Sylvestre]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-68"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-68" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c68">Comment 68</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-09-29 02:24 PDT" data-time="1443518671">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-68">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-68" data-comment-id="10787667">Comment on <span class=""><a href="/attachment.cgi?id=8660399" name="attach_8660399" title="Purposely leak StatisticsReport object and suppress the leak report">attachment 8660399</a> <a href="/attachment.cgi?id=8660399&amp;action=edit" title="Purposely leak StatisticsReport object and suppress the leak report">[details]</a> <a href="/attachment.cgi?id=8660399&amp;action=diff" title="Purposely leak StatisticsReport object and suppress the leak report">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1193038&amp;attachment=8660399'>[review]</a>
Purposely leak StatisticsReport object and suppress the leak report

[Triage Comment]
42 is now in beta.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8660399&amp;action=edit"
           title="Purposely leak StatisticsReport object and suppress the leak report"
           class=""
        >Attachment #8660399</a> -
        Flags: approval-mozilla-aurora+ &rarr; approval-mozilla-beta+</div></div></div><div class="change-set" id="c69"><div class="comment" data-id="10787861" data-no="69"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-69" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_277293" id="a4275989_495955"><img src="https://secure.gravatar.com/avatar/8378311bf1bd5e9eddc7896a07688876?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_277293" id="a4275989_495955"><a class="email disabled" href="/user_profile?user_id=277293" > <span class="fna">Carsten Book [:Tomcat]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-69"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-69" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c69">Comment 69</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-09-29 03:06 PDT" data-time="1443521210">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-69">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-69" data-comment-id="10787861"><a rel="nofollow" href="https://hg.mozilla.org/releases/mozilla-beta/rev/48b17faad125">https://hg.mozilla.org/releases/mozilla-beta/rev/48b17faad125</a></pre><div class="activity"><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox42&amp;o1=isnotempty">status-firefox42</a>:
          <a href="/buglist.cgi?f1=cf_status_firefox42&amp;o1=equals&amp;v1=affected">affected</a> &rarr; <a href="/buglist.cgi?f1=cf_status_firefox42&amp;o1=equals&amp;v1=fixed">fixed</a></div><div class="change">Target Milestone: --- &rarr; mozilla43</div></div></div><div class="change-set" id="a4468797_7044"><div class="change" id="aa4468797_7044">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_7044" id="a4468797_7044"><img src="https://secure.gravatar.com/avatar/3301a62f3707d6bcef9542d316fb587f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_7044" id="a4468797_7044"><a class="email " href="/user_profile?user_id=7044" > <span class="fna">Benjamin Smedberg</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a4468797_7044"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a4468797_7044">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#a4468797_7044">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-10-01 07:56 PDT" data-time="1443711403">6 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(benjamin)</span></div></div></div><div class="change-set" id="a6307514_452604"><div class="change" id="aa6307514_452604">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_452604" id="a6307514_452604"><img src="https://secure.gravatar.com/avatar/7bb698c4991c5af83adabe3c3b8ee8aa?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_452604" id="a6307514_452604"><a class="email disabled" href="/user_profile?user_id=452604" > <span class="fna">Matt Wobensmith [:mwobensmith][:matt:]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a6307514_452604"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a6307514_452604">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#a6307514_452604">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-10-22 14:42 PDT" data-time="1445550120">6 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Whiteboard: [post-critsmash-triage]</div></div></div><div class="change-set" id="c70"><div class="comment" data-id="10869460" data-no="70"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-70" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_451704" id="a6307514_452604"><img src="https://secure.gravatar.com/avatar/6168ea97fda0cefa449331e59b24e8f7?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_451704" id="a6307514_452604"><a class="email " href="/user_profile?user_id=451704" > <span class="fna">Liz Henry (:lizzard Please n-i to RyanVM, jcristau, or pascal)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-70"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-70" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c70">Comment 70</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-10-23 16:49 PDT" data-time="1445644189">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-70">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-70" data-comment-id="10869460">Randell, do you want to request uplift for this to ESR? Thanks.</pre><div class="activity"><div class="change">Flags: needinfo?(rjesup)</div></div></div><div class="change-set" id="c71"><div class="comment" data-id="10869785" data-no="71"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-71" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_11539" id="a6307514_452604"><img src="https://secure.gravatar.com/avatar/ae002109ba1cfbb7f5ad990cc5d9fbaf?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_11539" id="a6307514_452604"><a class="email " href="/user_profile?user_id=11539" > <span class="fna">Randell Jesup [:jesup] (needinfo me)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-71"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-71" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c71">Comment 71</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-10-24 01:39 PDT" data-time="1445675978">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-71">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-71" data-comment-id="10869785">Comment on <span class=""><a href="/attachment.cgi?id=8660399" name="attach_8660399" title="Purposely leak StatisticsReport object and suppress the leak report">attachment 8660399</a> <a href="/attachment.cgi?id=8660399&amp;action=edit" title="Purposely leak StatisticsReport object and suppress the leak report">[details]</a> <a href="/attachment.cgi?id=8660399&amp;action=diff" title="Purposely leak StatisticsReport object and suppress the leak report">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1193038&amp;attachment=8660399'>[review]</a>
Purposely leak StatisticsReport object and suppress the leak report

See Aurora approval request</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(rjesup)</span></div><div class="change">
        <a href="/attachment.cgi?id=8660399&amp;action=edit"
           title="Purposely leak StatisticsReport object and suppress the leak report"
           class=""
        >Attachment #8660399</a> -
        Flags: approval-mozilla-esr38?</div></div></div><div class="change-set" id="c72"><div class="comment" data-id="10870202" data-no="72"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-72" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_451704" id="a6307514_452604"><img src="https://secure.gravatar.com/avatar/6168ea97fda0cefa449331e59b24e8f7?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_451704" id="a6307514_452604"><a class="email " href="/user_profile?user_id=451704" > <span class="fna">Liz Henry (:lizzard Please n-i to RyanVM, jcristau, or pascal)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-72"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-72" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c72">Comment 72</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-10-24 12:28 PDT" data-time="1445714925">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-72">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-72" data-comment-id="10870202">Comment on <span class=""><a href="/attachment.cgi?id=8660399" name="attach_8660399" title="Purposely leak StatisticsReport object and suppress the leak report">attachment 8660399</a> <a href="/attachment.cgi?id=8660399&amp;action=edit" title="Purposely leak StatisticsReport object and suppress the leak report">[details]</a> <a href="/attachment.cgi?id=8660399&amp;action=diff" title="Purposely leak StatisticsReport object and suppress the leak report">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1193038&amp;attachment=8660399'>[review]</a>
Purposely leak StatisticsReport object and suppress the leak report

Fix for shutdown and restart leak. Approved for esr-38</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8660399&amp;action=edit"
           title="Purposely leak StatisticsReport object and suppress the leak report"
           class=""
        >Attachment #8660399</a> -
        Flags: approval-mozilla-esr38? &rarr; approval-mozilla-esr38+</div></div></div><div class="change-set" id="c73"><div class="comment" data-id="10871915" data-no="73"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-73" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_277293" id="a6307514_452604"><img src="https://secure.gravatar.com/avatar/8378311bf1bd5e9eddc7896a07688876?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_277293" id="a6307514_452604"><a class="email disabled" href="/user_profile?user_id=277293" > <span class="fna">Carsten Book [:Tomcat]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-73"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-73" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#c73">Comment 73</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-10-26 02:12 PDT" data-time="1445850778">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-73">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-73" data-comment-id="10871915"><a rel="nofollow" href="https://hg.mozilla.org/releases/mozilla-esr38/rev/9f88a1fdc112">https://hg.mozilla.org/releases/mozilla-esr38/rev/9f88a1fdc112</a></pre><div class="activity"><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox_esr38&amp;o1=isnotempty">status-firefox-esr38</a>:
          <a href="/buglist.cgi?f1=cf_status_firefox_esr38&amp;o1=equals&amp;v1=affected">affected</a> &rarr; <a href="/buglist.cgi?f1=cf_status_firefox_esr38&amp;o1=equals&amp;v1=fixed">fixed</a></div></div></div><div class="change-set" id="a6737219_280903"><div class="change" id="aa6737219_280903">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_280903" id="a6737219_280903"><img src="https://secure.gravatar.com/avatar/58211442c4cece862d7a7850637c4edc?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_280903" id="a6737219_280903"><a class="email " href="/user_profile?user_id=280903" > <span class="fna">Al Billings [:abillings - ex-MoCo]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a6737219_280903"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a6737219_280903">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#a6737219_280903">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-10-27 14:03 PDT" data-time="1445979825">6 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Whiteboard: [post-critsmash-triage] &rarr; [post-critsmash-triage][adv-main42+][adv-esr38.4+]</div></div></div><div class="change-set" id="a28240918_1689"><div class="change" id="aa28240918_1689">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_1689" id="a28240918_1689"><img src="https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_1689" id="a28240918_1689"><a class="email " href="/user_profile?user_id=1689" > <span class="fna">Daniel Veditz [:dveditz]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a28240918_1689"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a28240918_1689">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1193038#a28240918_1689">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-07-02 11:18 PDT" data-time="1467483524">5 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Group: <span class="activity-deleted">core-security-release</span></div></div></div><div id="new-comment-notice">
          You need to <a href="/show_bug.cgi?id=1193038&amp;GoAheadAndLogIn=1">log in</a>
          before you can comment on or make changes to this bug.
        </div>



<div id="bottom-actions">
  <div id="bottom-right-actions">
    <button type="button" id="top-btn" class="secondary" aria-label="Go to Page Top">Top &uarr;</button>
  </div>
</div></div> 
</main> 
</div> 


</body>
</html>